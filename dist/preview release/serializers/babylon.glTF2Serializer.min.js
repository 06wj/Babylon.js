var BABYLON;!(function(e){var t=(function(){function t(){}return t.GLTF=function(t,r){var s=r.replace(/\.[^\/.]+$/,"");return new e._GLTF2Exporter(t)._generateGLTF(s)},t.GLB=function(t,r){var s=r.replace(/\.[^\/.]+$/,"");return new e._GLTF2Exporter(t)._generateGLB(s)},t.downloadFiles=function(e){function t(e,t){return-1!==e.indexOf(t,e.length-t.length)}for(var r in e){var s=document.createElement("a");document.body.appendChild(s),s.setAttribute("type","hidden"),s.download=r;var i=e[r],n=void 0;t(r,".glb")?n={type:"model/gltf-binary"}:t(r,".bin")?n={type:"application/octet-stream"}:t(r,".gltf")&&(n={type:"model/gltf+json"}),s.href=window.URL.createObjectURL(new Blob([i],n)),s.click()}},t})();e.GLTF2Export=t})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){var t=(function(){function t(e){this.asset={generator:"BabylonJS",version:"2.0"},this.babylonScene=e,this.bufferViews=new Array,this.accessors=new Array,this.meshes=new Array,this.scenes=new Array,this.nodes=new Array;var t=0;t=this.createScene(this.babylonScene,t),this.totalByteLength=t}return t.prototype.createBufferView=function(e,t,r){var s={buffer:e,byteLength:r};return t>0&&(s.byteOffset=t),s},t.prototype.createAccessor=function(e,t,r,s,i,n,a){var o={name:t,bufferView:e,componentType:s,count:i,type:r};return n&&(o.min=n),a&&(o.max=a),o},t.prototype.calculateMinMax=function(e,t,r,s,i){var n=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0],o=t+r;if(r>0)for(var f=t;f<o;++f)for(var c=i*f,u=0;u<i;++u)e[c]<n[u]&&(n[u]=e[c]),e[c]>a[u]&&(a[u]=e[c]),++c;return{min:n,max:a}},t.prototype.writeAttributeData=function(t,r,s,i,n,a,o){var f=n,c=r.verticesStart+r.verticesCount,u=0;switch(t){case e.VertexBuffer.PositionKind:case e.VertexBuffer.NormalKind:for(var h=r.verticesStart;h<c;++h){var l=h*i;a.setFloat32(f,s[l],!0),f+=4,a.setFloat32(f,s[l+1],!0),f+=4,o?a.setFloat32(f,s[l+2],!0):a.setFloat32(f,-s[l+2],!0),f+=4}u=12*r.verticesCount;break;case e.VertexBuffer.TangentKind:for(var h=r.indexStart;h<c;++h){var l=h*i;a.setFloat32(f,s[l],!0),f+=4,a.setFloat32(f,s[l+1],!0),f+=4,o?a.setFloat32(f,s[l+2],!0):a.setFloat32(f,-s[l+2],!0),f+=4,a.setFloat32(f,s[l+3],!0),f+=4}u=16*r.verticesCount;break;case e.VertexBuffer.ColorKind:for(var h=r.verticesStart;h<c;++h){var l=h*i;a.setFloat32(f,s[l],!0),f+=4,a.setFloat32(f,s[l+1],!0),f+=4,a.setFloat32(f,s[l+2],!0),f+=4,a.setFloat32(f,s[l+3],!0),f+=4}u=16*r.verticesCount;break;case e.VertexBuffer.UVKind:case e.VertexBuffer.UV2Kind:for(var h=r.verticesStart;h<c;++h){var l=h*i;a.setFloat32(f,s[l],!0),f+=4,a.setFloat32(f,s[l+1],!0),f+=4}u=8*r.verticesCount;break;default:throw new Error("Unsupported vertex buffer type: "+t)}return u},t.prototype.generateJSON=function(e,t,r){var s={byteLength:this.totalByteLength},i={buffers:[s],asset:this.asset,meshes:this.meshes,scenes:this.scenes,nodes:this.nodes,bufferViews:this.bufferViews,accessors:this.accessors};return this.scenes.length>0&&(i.scene=0),e||(s.uri=t+".bin"),r?JSON.stringify(i,null,2):JSON.stringify(i)},t.prototype._generateGLTF=function(e){var t=this.generateJSON(!1,e,!0),r=this.generateBinary(),s=new Blob([r],{type:"application/octet-stream"}),i=e+".gltf",n=e+".bin";return a={},a[i]=t,a[n]=s,a;var a},t.prototype.generateBinary=function(){var e=0,t=new ArrayBuffer(this.totalByteLength),r=new DataView(t);return e=this.createScene(this.babylonScene,e,r),t},t.prototype._generateGLB=function(e){var t=this.generateJSON(!0),r=this.generateBinary(),s=e+".glb",i=t.length,n=i%4,a=r.byteLength%4,o=0===n?n:4-n,f=0===a?a:4-a,c=28+i+o+r.byteLength+f,u=new ArrayBuffer(12),h=new DataView(u);h.setUint32(0,1179937895,!0),h.setUint32(4,2,!0),h.setUint32(8,c,!0);var l=new ArrayBuffer(8+i+o),v=new DataView(l);v.setUint32(0,i+o,!0),v.setUint32(4,1313821514,!0);for(var g=new Uint8Array(l,8),V=0;V<i;++V)g[V]=t.charCodeAt(V);for(var p=new Uint8Array(l,8+i),V=0;V<o;++V)p[V]=32;var d=new ArrayBuffer(8),w=new DataView(d);w.setUint32(0,r.byteLength,!0),w.setUint32(4,5130562,!0);for(var b=new ArrayBuffer(f),B=new Uint8Array(b),V=0;V<f;++V)B[V]=0;var y=new Blob([u,l,d,r,b],{type:"application/octet-stream"});return x={},x[s]=y,x;var x},t.prototype.setNodeTransformation=function(t,r,s){0===r.position.x&&0===r.position.y&&0===r.position.z||(t.translation=s?r.position.asArray():[r.position.x,r.position.y,-r.position.z]),1===r.scaling.x&&1===r.scaling.y&&1===r.scaling.z||(t.scale=s?r.scaling.asArray():[r.scaling.x,r.scaling.y,-r.scaling.z]);var i=e.Quaternion.RotationYawPitchRoll(r.rotation.y,r.rotation.x,r.rotation.z);r.rotationQuaternion&&(i=i.multiply(r.rotationQuaternion)),0===i.x&&0===i.y&&0===i.z&&1===i.w||(t.rotation=s?i.asArray():[-i.x,-i.y,i.z,i.w])},t.prototype.setPrimitiveAttributes=function(t,r,s,i,n){for(var a=0;a<r.subMeshes.length;++a){var o=null,f=r.subMeshes[a],c={attributes:{}};if(r instanceof e.Mesh?o=r:r instanceof e.InstancedMesh&&(o=r.sourceMesh),o.isVerticesDataPresent(e.VertexBuffer.PositionKind)){var u=o.getVertexBuffer(e.VertexBuffer.PositionKind),h=u.getOffset(),l=u.getData(),v=u.getStrideSize();if(n)s+=this.writeAttributeData(e.VertexBuffer.PositionKind,f,l,v,s,n,i);else{var g=12*f.verticesCount,V=this.createBufferView(0,s,g);s+=g,this.bufferViews.push(V);var p=this.calculateMinMax(l,f.verticesStart,f.verticesCount,h,v),d=this.createAccessor(this.bufferViews.length-1,"Position","VEC3",5126,f.verticesCount,p.min,p.max);this.accessors.push(d),c.attributes.POSITION=this.accessors.length-1}}if(o.isVerticesDataPresent(e.VertexBuffer.NormalKind)){var w=o.getVertexBuffer(e.VertexBuffer.NormalKind),b=w.getData(),B=w.getStrideSize();if(n)s+=this.writeAttributeData(e.VertexBuffer.NormalKind,f,b,B,s,n,i);else{var g=12*f.verticesCount,V=this.createBufferView(0,s,g);s+=g,this.bufferViews.push(V);var d=this.createAccessor(this.bufferViews.length-1,"Normal","VEC3",5126,f.verticesCount);this.accessors.push(d),c.attributes.NORMAL=this.accessors.length-1}}if(o.isVerticesDataPresent(e.VertexBuffer.TangentKind)){var y=o.getVertexBuffer(e.VertexBuffer.TangentKind),x=y.getData(),A=y.getStrideSize();if(n)s+=this.writeAttributeData(e.VertexBuffer.TangentKind,f,x,A,s,n,i);else{var g=16*f.verticesCount,V=this.createBufferView(0,s,g);s+=g,this.bufferViews.push(V);var d=this.createAccessor(this.bufferViews.length-1,"Tangent","VEC4",5126,f.verticesCount);this.accessors.push(d),c.attributes.TANGENT=this.accessors.length-1}}if(o.isVerticesDataPresent(e.VertexBuffer.ColorKind)){var m=o.getVertexBuffer(e.VertexBuffer.ColorKind),C=m.getData(),S=m.getStrideSize();if(n)s+=this.writeAttributeData(e.VertexBuffer.ColorKind,f,C,S,s,n,i);else{var g=16*f.verticesCount,V=this.createBufferView(0,s,g);s+=g,this.bufferViews.push(V);var d=this.createAccessor(this.bufferViews.length-1,"Color","VEC4",5126,f.verticesCount);this.accessors.push(d),c.attributes.COLOR_0=this.accessors.length-1}}if(o.isVerticesDataPresent(e.VertexBuffer.UVKind)){var L=o.getVertexBuffer(e.VertexBuffer.UVKind),D=L.getData(),K=L.getStrideSize();if(n)s+=this.writeAttributeData(e.VertexBuffer.UVKind,f,D,K,s,n,i);else{var g=8*f.verticesCount,V=this.createBufferView(0,s,g);s+=g,this.bufferViews.push(V);var d=this.createAccessor(this.bufferViews.length-1,"Texture Coords","VEC2",5126,f.verticesCount);this.accessors.push(d),c.attributes.TEXCOORD_0=this.accessors.length-1}}if(o.isVerticesDataPresent(e.VertexBuffer.UV2Kind)){var O=o.getVertexBuffer(e.VertexBuffer.UV2Kind),U=O.getData(),F=O.getStrideSize();if(n)s+=this.writeAttributeData(e.VertexBuffer.UV2Kind,f,U,F,s,n,i);else{var g=8*f.verticesCount,V=this.createBufferView(0,s,g);s+=g,this.bufferViews.push(V);var d=this.createAccessor(this.bufferViews.length-1,"Texture Coords","VEC2",5126,f.verticesCount);this.accessors.push(d),c.attributes.TEXCOORD_1=this.accessors.length-1}}if(o.getTotalIndices()>0)if(n){for(var T=o.getIndices(),N=f.indexStart,E=f.indexCount+N,P=s,z=N;z<E;z+=3)n.setUint32(P,T[z],!0),P+=4,n.setUint32(P,T[z+1],!0),P+=4,n.setUint32(P,T[z+2],!0),P+=4;var g=4*f.indexCount;s+=g}else{var G=f.indexCount,g=4*G,V=this.createBufferView(0,s,g);s+=g,this.bufferViews.push(V);var d=this.createAccessor(this.bufferViews.length-1,"Indices","SCALAR",5125,G);this.accessors.push(d),c.indices=this.accessors.length-1}o.material,t.primitives.push(c)}return s},t.prototype.createScene=function(e,t,r){if(e.meshes.length>0){for(var s=e.meshes,i={nodes:new Array},n=0;n<s.length;++n){var a={mesh:-1},o=s[n],f=o.getScene().useRightHandedSystem;this.setNodeTransformation(a,o,f);var c={primitives:new Array};c.primitives=[],t=this.setPrimitiveAttributes(c,o,t,f,r),this.meshes.push(c),a.mesh=this.meshes.length-1,o.name&&(a.name=o.name),this.nodes.push(a),i.nodes.push(this.nodes.length-1)}this.scenes.push(i)}return t},t})();e._GLTF2Exporter=t})(BABYLON||(BABYLON={}));