var BABYLON;!(function(e){var r=(function(){function r(){this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}}}return r.prototype.importMeshAsync=function(e,t,n,o,a,i){var s=r._parse(n),l=this._getLoader(s);return!!l&&l.importMeshAsync(e,t,s,o,a,i)},r.prototype.loadAsync=function(e,t,n,o,a){var i=r._parse(t),s=this._getLoader(i);return!!s&&s.loadAsync(e,i,n,o,a)},r._parse=function(e){return e instanceof ArrayBuffer?r._parseBinary(e):{json:JSON.parse(e),bin:null}},r.prototype._getLoader=function(t){var n={major:2,minor:0},o=t.json.asset||{},a=r._parseVersion(o.version);if(!a)return e.Tools.Error("Invalid version"),null;var i=r._parseVersion(o.minVersion);if(i&&r._compareVersion(i,n)>0)return e.Tools.Error("Incompatible version"),null;var s={1:r.GLTFLoaderV1,2:r.GLTFLoaderV2},l=s[a.major];return void 0===l?(e.Tools.Error("Unsupported version"),null):null===l?(e.Tools.Error("v"+a.major+" loader is not available"),null):l},r._parseBinary=function(n){var o={Magic:1179937895},a=new t(n),i=a.readUint32();if(i!==o.Magic)return e.Tools.Error("Unexpected magic: "+i),null;var s=a.readUint32();switch(s){case 1:return r._parseV1(a);case 2:return r._parseV2(a)}return e.Tools.Error("Unsupported version: "+s),null},r._parseV1=function(t){var n={JSON:0},o=t.readUint32();if(o!=t.getLength())return e.Tools.Error("Length in header does not match actual data length: "+o+" != "+t.getLength()),null;var a,i=t.readUint32(),s=t.readUint32();switch(s){case n.JSON:a=JSON.parse(r._decodeBufferToText(t.readUint8Array(i)));break;default:return e.Tools.Error("Unexpected content format: "+s),null}var l=t.getLength()-t.getPosition();return{json:a,bin:t.readUint8Array(l)}},r._parseV2=function(t){var n={JSON:1313821514,BIN:5130562},o=t.readUint32();if(o!==t.getLength())return e.Tools.Error("Length in header does not match actual data length: "+o+" != "+t.getLength()),null;var a=t.readUint32(),i=t.readUint32();if(i!==n.JSON)return e.Tools.Error("First chunk format is not JSON"),null;for(var s=JSON.parse(r._decodeBufferToText(t.readUint8Array(a))),l=null;t.getPosition()<t.getLength();)switch(a=t.readUint32(),i=t.readUint32()){case n.JSON:return e.Tools.Error("Unexpected JSON chunk"),null;case n.BIN:l=t.readUint8Array(a);break;default:t.skipBytes(a)}return{json:s,bin:l}},r._parseVersion=function(e){if(!e)return null;var r=e.split(".");if(0===r.length)return null;var t=parseInt(r[0]);if(t>1&&2!=r.length)return null;parseInt(r[1]);return{major:t,minor:parseInt(r[0])}},r._compareVersion=function(e,r){return e.major>r.major?1:e.major<r.major?-1:e.minor>r.minor?1:e.minor<r.minor?-1:0},r._decodeBufferToText=function(e){for(var r="",t=e.byteLength,n=0;n<t;++n)r+=String.fromCharCode(e[n]);return r},r})();r.GLTFLoaderV1=null,r.GLTFLoaderV2=null,r.HomogeneousCoordinates=!1,r.IncrementalLoading=!0,e.GLTFFileLoader=r;var t=(function(){function e(e){this._arrayBuffer=e,this._dataView=new DataView(e),this._byteOffset=0}return e.prototype.getPosition=function(){return this._byteOffset},e.prototype.getLength=function(){return this._arrayBuffer.byteLength},e.prototype.readUint32=function(){var e=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,e},e.prototype.readUint8Array=function(e){var r=new Uint8Array(this._arrayBuffer,this._byteOffset,e);return this._byteOffset+=e,r},e.prototype.skipBytes=function(e){this._byteOffset+=e},e})();e.SceneLoader.RegisterPlugin(new r)})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(e){!(function(e){e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(e.EBufferViewTarget||(e.EBufferViewTarget={}));!(function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.FLOAT=5126]="FLOAT"})(e.EComponentType||(e.EComponentType={}));!(function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(e.EMeshPrimitiveMode||(e.EMeshPrimitiveMode={}));!(function(e){e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D"})(e.EParameterType||(e.EParameterType={}));!(function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9728]="LINEAR"})(e.ETextureMagFilter||(e.ETextureMagFilter={}));!(function(e){e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9728]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(e.ETextureMinFilter||(e.ETextureMinFilter={}));!(function(e){e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"})(e.ETextureFormat||(e.ETextureFormat={}));!(function(e){e[e.TEXTURE_2D=3553]="TEXTURE_2D"})(e.ETextureTarget||(e.ETextureTarget={}));!(function(e){e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1"})(e.ETextureType||(e.ETextureType={}));!(function(e){e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.REPEAT=10497]="REPEAT"})(e.ETextureWrapMode||(e.ETextureWrapMode={}))})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(r){var t=["translation","rotation","scale"],n=["position","rotationQuaternion","scaling"],o=function(e){if(e)for(var r=0;r<e.length/2;r++)e[2*r+1]=1-e[2*r+1]},a=function(e){return"node"+e},i=function(o){var i=o.gltf.animations;if(i)for(var s=0;s<i.length;s++){var l=i[s];if(l&&l.channels&&l.samplers)for(var u=null,f=0;f<l.channels.length;f++){var c=l.channels[f];if(c){var T=l.samplers[c.sampler];if(T){var d=T.input,E=T.output,A=r.GLTFUtils.GetBufferFromAccessor(o,o.gltf.accessors[d]),b=r.GLTFUtils.GetBufferFromAccessor(o,o.gltf.accessors[E]),m=c.target.node,h=o.babylonScene.getNodeByID(a(m));if(null!==h){var y=h instanceof e.Bone,L=c.target.path,g=t.indexOf(L);g!==-1&&(L=n[g]);var p=e.Animation.ANIMATIONTYPE_MATRIX;y||("rotationQuaternion"===L?(p=e.Animation.ANIMATIONTYPE_QUATERNION,h.rotationQuaternion=new e.Quaternion):p=e.Animation.ANIMATIONTYPE_VECTOR3);var M=null,v=[],_=0,N=!1;if(y&&u&&u.getKeys().length===A.length&&(M=u,N=!0),!N){var F=l.name||"anim"+s;M=new e.Animation(F,y?"_matrix":L,1,p,e.Animation.ANIMATIONLOOPMODE_CYCLE)}for(var x=0;x<A.length;x++){var R=null;if("rotationQuaternion"===L?(R=e.Quaternion.FromArray([b[_],b[_+1],b[_+2],b[_+3]]),_+=4):(R=e.Vector3.FromArray([b[_],b[_+1],b[_+2]]),_+=3),y){var I=h,O=e.Vector3.Zero(),S=new e.Quaternion,B=e.Vector3.Zero(),G=I.getBaseMatrix();N&&(G=u.getKeys()[x].value),G.decompose(B,S,O),"position"===L?O=R:"rotationQuaternion"===L?S=R:B=R,R=e.Matrix.Compose(B,S,O)}N?u.getKeys()[x].value=R:v.push({frame:A[x],value:R})}N||(M.setKeys(v),h.animations.push(M)),u=M,o.babylonScene.stopAnimation(h),o.babylonScene.beginAnimation(h,0,A[A.length-1],!0,1)}else e.Tools.Warn("Creating animation index "+s+" but cannot find node index "+m+" to attach to")}}}}},s=function(r){var t=null;if(r.translation||r.rotation||r.scale){var n=e.Vector3.FromArray(r.scale||[1,1,1]),o=e.Quaternion.FromArray(r.rotation||[0,0,0,1]),a=e.Vector3.FromArray(r.translation||[0,0,0]);t=e.Matrix.Compose(n,o,a)}else t=r.matrix?e.Matrix.FromArray(r.matrix):e.Matrix.Identity();return t},l=function(r,t,n,o){for(var i=a(n),u=0;u<o.bones.length;u++)if(o.bones[u].id===i)return o.bones[u].getParent();for(var f=t.joints,T=0;T<f.length;T++)for(var d=f[T],E=r.gltf.nodes[d],A=E.children,u=0;u<A.length;u++){var b=A[u];r.gltf.nodes[b];if(c(t,b)&&b===n){var m=s(E),h=new e.Bone(E.name||a(d),o,l(r,t,d,o),m);return h.id=a(d),h}}return null},u=function(e,r){for(var t=0;t<e.length;t++){var n=e[t];if(n.node.children)for(var o=0;o<n.node.children.length;o++){var a=n.node.children[o];if(a===r)return n.bone}}return null},f=function(e,r){var t=e.gltf.nodes[r];return t?{node:t,index:r}:null},c=function(e,r){for(var t=0;t<e.joints.length;t++)if(e.joints[t]===r)return!0;return!1},T=function(r,t,n,o){for(var i=0;i<r.gltf.nodes.length;i++){var l=r.gltf.nodes[i];if(!c(n,i)){var u=s(l),f=new e.Bone(l.name||a(i),t,null,u);f.id=a(i),o.push({bone:f,node:l,index:i})}}for(var i=0;i<o.length;i++){var T=o[i],d=T.node.children;if(d)for(var E=0;E<d.length;E++){for(var A=null,b=0;b<o.length;b++)if(o[b].index===d[E]){A=o[b];break}A&&(A.bone._parent=T.bone,T.bone.children.push(A.bone))}}},d=function(t,n,o){var i=o.name||"skin"+n.skin,c=o.babylonSkeleton;if(c||(c=new e.Skeleton(i,"skin"+n.skin,t.babylonScene)),!o.babylonSkeleton)return c;var d=t.gltf.accessors[o.inverseBindMatrices],E=(r.GLTFUtils.GetBufferFromAccessor(t,d),[]),A=[];T(t,c,o,E),c.bones=[];for(var b=0;b<o.joints.length;b++){var m=f(t,o.joints[b]),h=m.node;if(h){var y=m.index,L=a(y),g=t.babylonScene.getBoneByID(L);if(g)c.bones.push(g);else{for(var p=!1,M=null,v=0;v<b;v++){var _=f(t,o.joints[v]).node;if(_){var N=_.children;p=!1;for(var F=0;F<N.length;F++)if(N[F]===y){M=l(t,o,o.joints[v],c),p=!0;break}if(p)break}else e.Tools.Warn("Joint index "+o.joints[v]+" does not exist when looking for parent")}var x=s(h);!M&&E.length>0&&(M=u(E,y))&&A.indexOf(M)===-1&&A.push(M);new e.Bone(h.name||L,c,M,x).id=L}}else e.Tools.Warn("Joint index "+o.joints[b]+" does not exist")}var R=c.bones;c.bones=[];for(var b=0;b<o.joints.length;b++){var m=f(t,o.joints[b]);if(m)for(var I=a(m.index),v=0;v<R.length;v++)if(R[v].id===I){c.bones.push(R[v]);break}}c.prepare();for(var b=0;b<A.length;b++)c.bones.push(A[b]);return c},E=function(t,n){if(void 0===n)return r.GLTFUtils.GetDefaultMaterial(t);var o=t.gltf.materials;if(!o||n<0||n>=o.length)return e.Tools.Error("Invalid material index"),r.GLTFUtils.GetDefaultMaterial(t);var a=t.gltf.materials[n].babylonMaterial;return a||r.GLTFUtils.GetDefaultMaterial(t)},A=function(t,n,a){var i=a.name||n.name||"mesh"+n.mesh,s=n.babylonNode;if(s||(s=new e.Mesh(i,t.babylonScene)),!n.babylonNode)return s;var l=new e.MultiMaterial(i,t.babylonScene);s.material||(s.material=l);for(var u=new e.VertexData,f=new e.Geometry(i,t.babylonScene,u,!1,s),c=[],T=[],d=[],A=[],b=0;b<a.primitives.length;b++){var m=new e.VertexData,h=a.primitives[b];h.mode,r.EMeshPrimitiveMode.TRIANGLES;var y=h.attributes,L=null,g=null;for(var p in y)if(L=t.gltf.accessors[y[p]],g=r.GLTFUtils.GetBufferFromAccessor(t,L),"NORMAL"===p)m.normals=new Float32Array(g.length),m.normals.set(g);else if("POSITION"===p)m.positions=new Float32Array(g.length),m.positions.set(g),T.push(m.positions.length);else if("TANGENT"===p)m.tangents=new Float32Array(g.length),m.tangents.set(g);else if(p.indexOf("TEXCOORD_")!==-1){var M=Number(p.split("_")[1]),v=e.VertexBuffer.UVKind+(0===M?"":M+1),_=new Float32Array(g.length);_.set(g),o(_),m.set(_,v)}else"JOINT"===p?(m.matricesIndices=new Float32Array(g.length),m.matricesIndices.set(g)):"WEIGHT"===p?(m.matricesWeights=new Float32Array(g.length),m.matricesWeights.set(g)):"COLOR_0"===p?(m.colors=new Float32Array(g.length),m.colors.set(g)):e.Tools.Warn("Ignoring unrecognized semantic '"+p+"'");if(L=t.gltf.accessors[h.indices])g=r.GLTFUtils.GetBufferFromAccessor(t,L),m.indices=new Int32Array(g.length),m.indices.set(g),A.push(m.indices.length);else{for(var N=[],F=0;F<m.positions.length/3;F++)N.push(F);m.indices=new Int32Array(N),A.push(m.indices.length)}u.merge(m),m=void 0;var x=E(t,h.material);l.subMaterials.push(x),c.push(0===c.length?0:c[c.length-1]+T[T.length-2]),d.push(0===d.length?0:d[d.length-1]+A[A.length-2])}f.setAllVerticesData(u,!1),s.computeWorldMatrix(!0),s.subMeshes=[];for(var b=0;b<a.primitives.length;b++){a.primitives[b].mode,r.EMeshPrimitiveMode.TRIANGLES;new e.SubMesh(b,c[b],T[b],d[b],A[b],s,s,!0)}return s},b=function(r,t){var n=e.Vector3.Zero(),o=e.Quaternion.Identity(),a=new e.Vector3(1,1,1);if(t.matrix){e.Matrix.FromArray(t.matrix).decompose(a,o,n)}else t.translation&&(n=e.Vector3.FromArray(t.translation)),t.rotation&&(o=e.Quaternion.FromArray(t.rotation)),t.scale&&(a=e.Vector3.FromArray(t.scale));if(r.position=n,r.rotationQuaternion=o,r instanceof e.Mesh){r.scaling=a}},m=function(r,t){var n=null;if(r.importOnlyMeshes&&(void 0!==t.skin||void 0!==t.mesh)&&r.importMeshesNames.length>0&&r.importMeshesNames.indexOf(t.name)===-1)return null;if(void 0!==t.skin){if(void 0!==t.mesh){var o=r.gltf.skins[t.skin],a=A(r,t,r.gltf.meshes[t.mesh]),i=d(r,t,o);i&&(a.skeleton=i,o.babylonSkeleton=i),n=a}}else if(void 0!==t.mesh)n=A(r,t,r.gltf.meshes[t.mesh]);else if(void 0!==t.camera&&!t.babylonNode&&!r.importOnlyMeshes){var s=r.gltf.cameras[t.camera];if(void 0!==s)if("orthographic"===s.type){var l=(s.orthographic,new e.FreeCamera(t.name||"camera"+t.camera,e.Vector3.Zero(),r.babylonScene));l.mode=e.Camera.ORTHOGRAPHIC_CAMERA,l.attachControl(r.babylonScene.getEngine().getRenderingCanvas()),n=l}else if("perspective"===s.type){var u=s.perspective,f=new e.FreeCamera(t.name||"camera"+t.camera,e.Vector3.Zero(),r.babylonScene);f.attachControl(r.babylonScene.getEngine().getRenderingCanvas()),u.aspectRatio||(u.aspectRatio=r.babylonScene.getEngine().getRenderWidth()/r.babylonScene.getEngine().getRenderHeight()),u.znear&&u.zfar&&(f.maxZ=u.zfar,f.minZ=u.znear),n=f}}if(t.babylonNode)return t.babylonNode;if(null===n){var c=new e.Mesh(t.name||"mesh"+t.mesh,r.babylonScene);t.babylonNode=c,n=c}return null!==n&&(b(n,t),n.updateCache(!0),t.babylonNode=n),n},h=function(e,r,t,n){var o=e.gltf.nodes[r],i=null;if(n=!(e.importOnlyMeshes&&!n)||(e.importMeshesNames.indexOf(o.name)!==-1||0===e.importMeshesNames.length),n&&null!==(i=m(e,o))&&(i.id=a(r),i.parent=t),o.children)for(var s=0;s<o.children.length;s++)h(e,o.children[s],i,n)},y=function(e){var r=e.gltf.scene||0,t=e.gltf.scenes;if(t)for(var n=t[r].nodes,o=0;o<n.length;o++)h(e,n[o],null);else for(var o=0;o<e.gltf.nodes.length;o++)h(e,o,null)},L=function(e){y(e),i(e);for(var r=0;r<e.babylonScene.skeletons.length;r++){var t=e.babylonScene.skeletons[r];e.babylonScene.beginAnimation(t,0,Number.MAX_VALUE,!0,1)}},g=function(e){if(e.gltf.materials)for(var t=0;t<e.gltf.materials.length;t++)r.GLTFLoaderExtension.LoadMaterial(e,t)},p=(function(){function e(e){this._arrayBuffer=e,this._dataView=new DataView(e),this._byteOffset=0}e.prototype.getPosition=function(){return this._byteOffset},e.prototype.getLength=function(){return this._arrayBuffer.byteLength},e.prototype.readUint32=function(){var e=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,e},e.prototype.readUint8Array=function(e){var r=new Uint8Array(this._arrayBuffer,this._byteOffset,e);return this._byteOffset+=e,r},e.prototype.skipBytes=function(e){this._byteOffset+=e},e}(),(function(){function t(){}return t.RegisterExtension=function(r){if(t.Extensions[r.name])return void e.Tools.Error('Tool with the same name "'+r.name+'" already exists');t.Extensions[r.name]=r},t.LoadMaterial=function(r,t){var n=r.gltf.materials[t];return n?(n.babylonMaterial=new e.PBRMaterial(n.name||"mat"+t,r.babylonScene),n.babylonMaterial.sideOrientation=e.Material.CounterClockWiseSideOrientation,n.babylonMaterial.useScalarInLinearSpace=!0,n):null},t.LoadCommonMaterialProperties=function(r,n){n.normalTexture&&t.LoadTextureAsync(r,n.normalTexture,(function(e){n.babylonMaterial.bumpTexture=e,void 0!==n.normalTexture.scale&&(n.babylonMaterial.bumpTexture.level=n.normalTexture.scale)}),(function(){return e.Tools.Warn("Failed to load normal texture")})),n.occlusionTexture&&t.LoadTextureAsync(r,n.occlusionTexture,(function(e){n.babylonMaterial.ambientTexture=e,n.babylonMaterial.useAmbientInGrayScale=!0,void 0!==n.occlusionTexture.strength&&(n.babylonMaterial.ambientTextureStrength=n.occlusionTexture.strength)}),(function(){return e.Tools.Warn("Failed to load occlusion texture")})),n.babylonMaterial.useEmissiveAsIllumination=!(!n.emissiveFactor&&!n.emissiveTexture),n.babylonMaterial.emissiveColor=n.emissiveFactor?e.Color3.FromArray(n.emissiveFactor):new e.Color3(0,0,0),n.emissiveTexture&&t.LoadTextureAsync(r,n.emissiveTexture,(function(e){n.babylonMaterial.emissiveTexture=e}),(function(){return e.Tools.Warn("Failed to load emissive texture")})),n.doubleSided&&(n.babylonMaterial.backFaceCulling=!1,n.babylonMaterial.twoSidedLighting=!0)},t.LoadAlphaProperties=function(r,t){switch(t.alphaMode||"OPAQUE"){case"OPAQUE":break;case"MASK":t.babylonMaterial.albedoTexture.hasAlpha=!0,t.babylonMaterial.useAlphaFromAlbedoTexture=!1,t.babylonMaterial.alphaMode=e.Engine.ALPHA_DISABLE;break;case"BLEND":t.babylonMaterial.albedoTexture.hasAlpha=!0,t.babylonMaterial.useAlphaFromAlbedoTexture=!0,t.babylonMaterial.alphaMode=e.Engine.ALPHA_COMBINE;break;default:e.Tools.Error("Invalid alpha mode '"+t.alphaMode+"'")}},t.LoadTextureAsync=function(n,o,a,i){var s=n.gltf.textures[o.index];if(!s||void 0===s.source)return void i();if(s.babylonTexture)return void a(s.babylonTexture);var l=n.gltf.images[s.source];if(void 0===l.uri){var u=n.gltf.bufferViews[l.bufferView],f=r.GLTFUtils.GetBufferFromBufferView(n,u,0,u.byteLength,r.EComponentType.UNSIGNED_BYTE);t.CreateTextureAsync(n,o,f,l.mimeType,a,i)}else r.GLTFUtils.IsBase64(l.uri)?t.CreateTextureAsync(n,o,new Uint8Array(r.GLTFUtils.DecodeBase64(l.uri)),l.mimeType,a,i):e.Tools.LoadFile(n.rootUrl+l.uri,(function(e){t.CreateTextureAsync(n,o,new Uint8Array(e),l.mimeType,a,i)}),null,null,!0,i)},t.CreateTextureAsync=function(t,n,o,a,i,s){var l=t.gltf.textures[n.index];if(!l||void 0===l.source)return void s();if(l.babylonTexture)return void i(l.babylonTexture);var u=l.sampler?t.gltf.samplers[l.sampler]:{},f=u.minFilter===r.ETextureMinFilter.NEAREST_MIPMAP_NEAREST||u.minFilter===r.ETextureMinFilter.NEAREST_MIPMAP_LINEAR||u.minFilter===r.ETextureMinFilter.LINEAR_MIPMAP_NEAREST||u.minFilter===r.ETextureMinFilter.LINEAR_MIPMAP_LINEAR,c=e.Texture.BILINEAR_SAMPLINGMODE,T=new Blob([o],{type:a}),d=URL.createObjectURL(T),E=function(){return URL.revokeObjectURL(d)};l.babylonTexture=new e.Texture(d,t.babylonScene,!f,!0,c,E,E),l.babylonTexture.coordinatesIndex=void 0===n.texCoord?0:n.texCoord,l.babylonTexture.wrapU=r.GLTFUtils.GetWrapMode(u.wrapS),l.babylonTexture.wrapV=r.GLTFUtils.GetWrapMode(u.wrapT),l.babylonTexture.name=l.name,i(l.babylonTexture)},t.prototype.importMeshAsync=function(r,t,n,o,a,i){t.useRightHandedSystem=!0;var s=this._createRuntime(t,n,o,!0);if(!s)return void(i&&i());""===r?s.importMeshesNames=[]:"string"==typeof r?s.importMeshesNames=[r]:!r||r instanceof Array?(s.importMeshesNames=[],e.Tools.Warn("Argument meshesNames must be of type string or string[]")):s.importMeshesNames=[r],y(s);for(var l=[],u=[],f=0;f<s.gltf.nodes.length;f++){var c=s.gltf.nodes[f];c.babylonNode instanceof e.AbstractMesh&&l.push(c.babylonNode)}for(var f=0;f<s.gltf.skins.length;f++){var T=s.gltf.skins[f];T.babylonSkeleton instanceof e.Skeleton&&u.push(T.babylonSkeleton)}return this._loadBuffersAsync(s,(function(){g(s),L(s),!e.GLTFFileLoader.IncrementalLoading&&a&&a(l,null,u)}),i),e.GLTFFileLoader.IncrementalLoading&&a&&a(l,null,u),!0},t.prototype.loadAsync=function(r,t,n,o,a){r.useRightHandedSystem=!0;var i=this._createRuntime(r,t,n,!1);return i?(y(i),this._loadBuffersAsync(i,(function(){g(i),L(i),e.GLTFFileLoader.IncrementalLoading||o()}),a),e.GLTFFileLoader.IncrementalLoading&&o(),!0):(a&&a(),!1)},t.prototype._loadBuffersAsync=function(e,r,t){var n=this;if(0==e.gltf.buffers.length)return void r();var o=0;e.gltf.buffers.forEach((function(a,i){n._loadBufferAsync(e,i,(function(){++o>=e.gltf.buffers.length&&r()}),t)}))},t.prototype._loadBufferAsync=function(t,n,o,a){var i=t.gltf.buffers[n];if(void 0===i.uri)o();else if(r.GLTFUtils.IsBase64(i.uri)){var s=r.GLTFUtils.DecodeBase64(i.uri);setTimeout((function(){i.loadedBufferView=new Uint8Array(s),o()}))}else e.Tools.LoadFile(t.rootUrl+i.uri,(function(e){i.loadedBufferView=new Uint8Array(e),o()}),null,null,!0,a)},t.prototype._createRuntime=function(t,n,o,a){var i,s={gltf:n.json,babylonScene:t,rootUrl:o,importOnlyMeshes:a},l=s.gltf.buffers;if(l.length>0&&void 0===l[0].uri&&(i=l[0]),n.bin){if(!i)return e.Tools.Error("Unexpected BIN chunk"),null;if(i.byteLength!=n.bin.byteLength)return e.Tools.Error("Binary buffer length from JSON does not match chunk length"),null;i.loadedBufferView=n.bin}return r.GLTFLoaderExtension.PostCreateRuntime(s),s},t})());p.Extensions={},p.LoadMetallicRoughnessMaterialProperties=function(r,t){var n=t.pbrMetallicRoughness;n&&(t.babylonMaterial.albedoColor=n.baseColorFactor?e.Color3.FromArray(n.baseColorFactor):new e.Color3(1,1,1),t.babylonMaterial.metallic=void 0===n.metallicFactor?1:n.metallicFactor,t.babylonMaterial.roughness=void 0===n.roughnessFactor?1:n.roughnessFactor,n.baseColorTexture&&p.LoadTextureAsync(r,n.baseColorTexture,(function(e){t.babylonMaterial.albedoTexture=e,p.LoadAlphaProperties(r,t)}),(function(){e.Tools.Warn("Failed to load base color texture")})),n.metallicRoughnessTexture&&p.LoadTextureAsync(r,n.metallicRoughnessTexture,(function(e){t.babylonMaterial.metallicTexture=e,t.babylonMaterial.useMetallnessFromMetallicTextureBlue=!0,t.babylonMaterial.useRoughnessFromMetallicTextureGreen=!0,t.babylonMaterial.useRoughnessFromMetallicTextureAlpha=!1}),(function(){e.Tools.Warn("Failed to load metallic roughness texture")})))},r.GLTFLoader=p,e.GLTFFileLoader.GLTFLoaderV2=new p})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(r){var t=(function(){function t(){}return t.IsBase64=function(e){return!(e.length<5)&&"data:"===e.substr(0,5)},t.DecodeBase64=function(e){for(var r=atob(e.split(",")[1]),t=r.length,n=new Uint8Array(new ArrayBuffer(t)),o=0;o<t;o++)n[o]=r.charCodeAt(o);return n.buffer},t.GetWrapMode=function(t){switch(t){case r.ETextureWrapMode.CLAMP_TO_EDGE:return e.Texture.CLAMP_ADDRESSMODE;case r.ETextureWrapMode.MIRRORED_REPEAT:return e.Texture.MIRROR_ADDRESSMODE;case r.ETextureWrapMode.REPEAT:default:return e.Texture.WRAP_ADDRESSMODE}},t.GetByteStrideFromType=function(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},t.GetTextureFilterMode=function(t){switch(t){case r.ETextureMinFilter.LINEAR:case r.ETextureMinFilter.LINEAR_MIPMAP_NEAREST:case r.ETextureMinFilter.LINEAR_MIPMAP_LINEAR:return e.Texture.TRILINEAR_SAMPLINGMODE;case r.ETextureMinFilter.NEAREST:case r.ETextureMinFilter.NEAREST_MIPMAP_NEAREST:return e.Texture.NEAREST_SAMPLINGMODE;default:return e.Texture.BILINEAR_SAMPLINGMODE}},t.GetBufferFromBufferView=function(e,t,n,o,a){var n=t.byteOffset+n,i=e.gltf.buffers[t.buffer].loadedBufferView;if(n+o>i.byteLength)throw new Error("Buffer access is out of range");var s=i.buffer;switch(n+=i.byteOffset,a){case r.EComponentType.BYTE:return new Int8Array(s,n,o);case r.EComponentType.UNSIGNED_BYTE:return new Uint8Array(s,n,o);case r.EComponentType.SHORT:return new Int16Array(s,n,o);case r.EComponentType.UNSIGNED_SHORT:return new Uint16Array(s,n,o);default:return new Float32Array(s,n,o)}},t.GetBufferFromAccessor=function(e,r){var n=e.gltf.bufferViews[r.bufferView],o=r.count*t.GetByteStrideFromType(r);return t.GetBufferFromBufferView(e,n,r.byteOffset,o,r.componentType)},t.DecodeBufferToText=function(e){for(var r="",t=e.byteLength,n=0;n<t;++n)r+=String.fromCharCode(e[n]);return r},t.GetDefaultMaterial=function(r){if(!r.defaultMaterial){var t=new e.PBRMaterial("gltf_default",r.babylonScene);t.sideOrientation=e.Material.CounterClockWiseSideOrientation,t.metallic=1,t.roughness=1,r.defaultMaterial=t}return r.defaultMaterial},t})();r.GLTFUtils=t})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(e){var r=(function(){function r(e){this._name=e}return Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),r.prototype.postCreateRuntime=function(e){},r.prototype.loadMaterial=function(e,r){return!1},r.PostCreateRuntime=function(r){for(var t in e.GLTFLoader.Extensions){e.GLTFLoader.Extensions[t].postCreateRuntime(r)}},r.LoadMaterial=function(r,t){for(var n in e.GLTFLoader.Extensions){if(e.GLTFLoader.Extensions[n].loadMaterial(r,t))return}var o=e.GLTFLoader.LoadMaterial(r,t);o&&(e.GLTFLoader.LoadMetallicRoughnessMaterialProperties(r,o),e.GLTFLoader.LoadCommonMaterialProperties(r,o))},r})();e.GLTFLoaderExtension=r})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));var BABYLON;!(function(e){!(function(r){var t=(function(t){function n(){return t.call(this,"KHR_materials_pbrSpecularGlossiness")||this}return __extends(n,t),n.prototype.loadMaterial=function(t,n){var o=r.GLTFLoader.LoadMaterial(t,n);if(!o||!o.extensions)return!1;var a=o.extensions[this.name];return!!a&&(o.babylonMaterial.albedoColor=a.diffuseFactor?e.Color3.FromArray(a.diffuseFactor):new e.Color3(1,1,1),o.babylonMaterial.reflectivityColor=a.specularFactor?e.Color3.FromArray(a.specularFactor):new e.Color3(1,1,1),o.babylonMaterial.microSurface=void 0===a.glossinessFactor?1:a.glossinessFactor,a.diffuseTexture&&r.GLTFLoader.LoadTextureAsync(t,a.diffuseTexture,(function(e){o.babylonMaterial.albedoTexture=e,r.GLTFLoader.LoadAlphaProperties(t,o)}),(function(){e.Tools.Warn("Failed to load diffuse texture")})),a.specularGlossinessTexture&&r.GLTFLoader.LoadTextureAsync(t,a.specularGlossinessTexture,(function(e){o.babylonMaterial.reflectivityTexture=e,o.babylonMaterial.useMicroSurfaceFromReflectivityMapAlpha=!0}),(function(){e.Tools.Warn("Failed to load metallic roughness texture")})),r.GLTFLoader.LoadCommonMaterialProperties(t,o),!0)},n})(r.GLTFLoaderExtension);r.GLTFMaterialsPbrSpecularGlossinessExtension=t,r.GLTFLoader.RegisterExtension(new t)})(e.GLTF2||(e.GLTF2={}))})(BABYLON||(BABYLON={}));