!(function(i){var e,t,r,n,o;(t=e=i.GLTFLoaderCoordinateSystemMode||(i.GLTFLoaderCoordinateSystemMode={}))[t.AUTO=0]="AUTO",t[t.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED",(n=r=i.GLTFLoaderAnimationStartMode||(i.GLTFLoaderAnimationStartMode={}))[n.NONE=0]="NONE",n[n.FIRST=1]="FIRST",n[n.ALL=2]="ALL",(o=i.GLTFLoaderState||(i.GLTFLoaderState={}))[o.LOADING=0]="LOADING",o[o.READY=1]="READY",o[o.COMPLETE=2]="COMPLETE";var a=(function(){function l(){this.onParsedObservable=new i.Observable,this.coordinateSystemMode=e.AUTO,this.animationStartMode=r.FIRST,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this._normalizeAnimationGroupsToBeginAtZero=!0,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable=new i.Observable,this.onTextureLoadedObservable=new i.Observable,this.onMaterialLoadedObservable=new i.Observable,this.onCameraLoadedObservable=new i.Observable,this.onCompleteObservable=new i.Observable,this.onErrorObservable=new i.Observable,this.onDisposeObservable=new i.Observable,this.onExtensionLoadedObservable=new i.Observable,this._loader=null,this.name="gltf",this.extensions={".gltf":{isBinary:!1},".glb":{isBinary:!0}},this._logIndentLevel=0,this._loggingEnabled=!1,this._log=this._logDisabled,this._capturePerformanceCounters=!1,this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled}return Object.defineProperty(l.prototype,"onParsed",{set:function(e){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),this._onParsedObserver=this.onParsedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onMeshLoaded",{set:function(e){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onTextureLoaded",{set:function(e){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onMaterialLoaded",{set:function(e){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onCameraLoaded",{set:function(e){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onComplete",{set:function(e){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onError",{set:function(e){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onDispose",{set:function(e){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(e)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"onExtensionLoaded",{set:function(e){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(e)},enumerable:!0,configurable:!0}),l.prototype.whenCompleteAsync=function(){var r=this;return new Promise(function(e,t){r.onCompleteObservable.addOnce((function(){e()})),r.onErrorObservable.addOnce((function(e){t(e)}))})},Object.defineProperty(l.prototype,"loaderState",{get:function(){return this._loader?this._loader.state:null},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(e){this._loggingEnabled!==e&&(this._loggingEnabled=e,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!0,configurable:!0}),Object.defineProperty(l.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(e){this._capturePerformanceCounters!==e&&(this._capturePerformanceCounters=e,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!0,configurable:!0}),l.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null),this._clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},l.prototype._clear=function(){this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.onMeshLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear()},l.prototype.importMeshAsync=function(t,r,n,o,a){var i=this;return Promise.resolve().then((function(){var e=i._parse(n);return i._loader=i._getLoader(e),i._loader.importMeshAsync(t,r,e,o,a)}))},l.prototype.loadAsync=function(t,r,n,o){var a=this;return Promise.resolve().then((function(){var e=a._parse(r);return a._loader=a._getLoader(e),a._loader.loadAsync(t,e,n,o)}))},l.prototype.loadAssetContainerAsync=function(r,t,n,o){var a=this;return Promise.resolve().then((function(){var e=a._parse(t);return a._loader=a._getLoader(e),a._loader.importMeshAsync(null,r,e,n,o).then((function(e){var t=new i.AssetContainer(r);return Array.prototype.push.apply(t.meshes,e.meshes),Array.prototype.push.apply(t.particleSystems,e.particleSystems),Array.prototype.push.apply(t.skeletons,e.skeletons),Array.prototype.push.apply(t.animationGroups,e.animationGroups),t.removeAllFromScene(),t}))}))},l.prototype.canDirectLoad=function(e){return-1!==e.indexOf("scene")&&-1!==e.indexOf("node")},l.prototype.createPlugin=function(){return new l},l.prototype._parse=function(e){var t;return this._startPerformanceCounter("Parse"),e instanceof ArrayBuffer?(this._log("Parsing binary"),t=this._parseBinary(e)):(this._log("Parsing JSON"),this._log("JSON length: "+e.length),t={json:JSON.parse(e),bin:null}),this.onParsedObservable.notifyObservers(t),this.onParsedObservable.clear(),this._endPerformanceCounter("Parse"),t},l.prototype._getLoader=function(e){var t=e.json.asset||{};this._log("Asset version: "+t.version),t.minVersion&&this._log("Asset minimum version: "+t.minVersion),t.generator&&this._log("Asset generator: "+t.generator);var r=l._parseVersion(t.version);if(!r)throw new Error("Invalid version: "+t.version);if(void 0!==t.minVersion){var n=l._parseVersion(t.minVersion);if(!n)throw new Error("Invalid minimum version: "+t.minVersion);if(0<l._compareVersion(n,{major:2,minor:0}))throw new Error("Incompatible minimum version: "+t.minVersion)}var o={1:l._CreateGLTFLoaderV1,2:l._CreateGLTFLoaderV2}[r.major];if(!o)throw new Error("Unsupported version: "+t.version);return o(this)},l.prototype._parseBinary=function(e){this._log("Binary length: "+e.byteLength);var t=new s(e),r=t.readUint32();if(1179937895!==r)throw new Error("Unexpected magic: "+r);var n=t.readUint32();switch(this.loggingEnabled&&this._log("Binary version: "+n),n){case 1:return this._parseV1(t);case 2:return this._parseV2(t)}throw new Error("Unsupported version: "+n)},l.prototype._parseV1=function(e){var t=e.readUint32();if(t!=e.getLength())throw new Error("Length in header does not match actual data length: "+t+" != "+e.getLength());var r,n=e.readUint32(),o=e.readUint32();switch(o){case 0:r=JSON.parse(l._decodeBufferToText(e.readUint8Array(n)));break;default:throw new Error("Unexpected content format: "+o)}var a=e.getLength()-e.getPosition();return{json:r,bin:e.readUint8Array(a)}},l.prototype._parseV2=function(e){var t=1313821514,r=5130562,n=e.readUint32();if(n!==e.getLength())throw new Error("Length in header does not match actual data length: "+n+" != "+e.getLength());var o=e.readUint32();if(e.readUint32()!==t)throw new Error("First chunk format is not JSON");for(var a=JSON.parse(l._decodeBufferToText(e.readUint8Array(o))),i=null;e.getPosition()<e.getLength();){var s=e.readUint32();switch(e.readUint32()){case t:throw new Error("Unexpected JSON chunk");case r:i=e.readUint8Array(s);break;default:e.skipBytes(s)}}return{json:a,bin:i}},l._parseVersion=function(e){if("1.0"===e||"1.0.1"===e)return{major:1,minor:0};var t=(e+"").match(/^(\d+)\.(\d+)/);return t?{major:parseInt(t[1]),minor:parseInt(t[2])}:null},l._compareVersion=function(e,t){return e.major>t.major?1:e.major<t.major?-1:e.minor>t.minor?1:e.minor<t.minor?-1:0},l._decodeBufferToText=function(e){for(var t="",r=e.byteLength,n=0;n<r;n++)t+=String.fromCharCode(e[n]);return t},l.prototype._logOpen=function(e){this._log(e),this._logIndentLevel++},l.prototype._logClose=function(){--this._logIndentLevel},l.prototype._logEnabled=function(e){var t=l._logSpaces.substr(0,2*this._logIndentLevel);i.Tools.Log(""+t+e)},l.prototype._logDisabled=function(e){},l.prototype._startPerformanceCounterEnabled=function(e){i.Tools.StartPerformanceCounter(e)},l.prototype._startPerformanceCounterDisabled=function(e){},l.prototype._endPerformanceCounterEnabled=function(e){i.Tools.EndPerformanceCounter(e)},l.prototype._endPerformanceCounterDisabled=function(e){},l.IncrementalLoading=!0,l.HomogeneousCoordinates=!1,l._logSpaces="                                ",l})();i.GLTFFileLoader=a;var s=(function(){function e(e){this._arrayBuffer=e,this._dataView=new DataView(e),this._byteOffset=0}return e.prototype.getPosition=function(){return this._byteOffset},e.prototype.getLength=function(){return this._arrayBuffer.byteLength},e.prototype.readUint32=function(){var e=this._dataView.getUint32(this._byteOffset,!0);return this._byteOffset+=4,e},e.prototype.readUint8Array=function(e){var t=new Uint8Array(this._arrayBuffer,this._byteOffset,e);return this._byteOffset+=e,t},e.prototype.skipBytes=function(e){this._byteOffset+=e},e})();i.SceneLoader&&i.SceneLoader.RegisterPlugin(new a)})(BABYLON||(BABYLON={})),(function(g){!(function(_){var d=(function(){function e(){}return e.Assign=function(e){if(e)for(var t=0;t<e.length;t++)e[t]._index=t},e})();_._ArrayItem=d;var t=(function(){function p(e){this._completePromises=new Array,this._disposed=!1,this._state=null,this._extensions={},this._defaultSampler={},this._defaultBabylonMaterials={},this._requests=new Array,this._parent=e}return p._Register=function(e,t){p._ExtensionFactories[e]?g.Tools.Error("Extension with the name '"+e+"' already exists"):(p._ExtensionFactories[e]=t,p._ExtensionNames.push(e))},Object.defineProperty(p.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),p.prototype.dispose=function(){if(!this._disposed){this._disposed=!0;for(var e=0,t=this._requests;e<t.length;e++){t[e].abort()}for(var r in this._requests.length=0,delete this._gltf,delete this._babylonScene,this._completePromises.length=0,this._extensions)this._extensions[r].dispose();this._extensions={},delete this._rootBabylonMesh,delete this._progressCallback,this._parent._clear()}},p.prototype.importMeshAsync=function(a,i,s,l,u){var c=this;return Promise.resolve().then((function(){c._babylonScene=i,c._rootUrl=l,c._progressCallback=u,c._loadData(s);var e=null;if(a){var r={};if(c._gltf.nodes)for(var t=0,n=c._gltf.nodes;t<n.length;t++){var o=n[t];o.name&&(r[o.name]=o._index)}e=(a instanceof Array?a:[a]).map((function(e){var t=r[e];if(void 0===t)throw new Error("Failed to find node '"+e+"'");return t}))}return c._loadAsync(e).then((function(){return{meshes:c._getMeshes(),particleSystems:[],skeletons:c._getSkeletons(),animationGroups:c._getAnimationGroups()}}))}))},p.prototype.loadAsync=function(e,t,r,n){var o=this;return Promise.resolve().then((function(){return o._babylonScene=e,o._rootUrl=r,o._progressCallback=n,o._loadData(t),o._loadAsync(null)}))},p.prototype._loadAsync=function(a){var i=this;return Promise.resolve().then((function(){i._loadExtensions(),i._checkExtensions();var e=g.GLTFLoaderState[g.GLTFLoaderState.LOADING]+" => "+g.GLTFLoaderState[g.GLTFLoaderState.READY],t=g.GLTFLoaderState[g.GLTFLoaderState.LOADING]+" => "+g.GLTFLoaderState[g.GLTFLoaderState.COMPLETE];i._parent._startPerformanceCounter(e),i._parent._startPerformanceCounter(t),i._setState(g.GLTFLoaderState.LOADING),_.GLTFLoaderExtension._OnLoading(i);var r=new Array;if(a)r.push(i._loadSceneAsync("#/nodes",{nodes:a,_index:-1}));else{var n=p._GetProperty("#/scene",i._gltf.scenes,i._gltf.scene||0);r.push(i._loadSceneAsync("#/scenes/"+n._index,n))}i._parent.compileMaterials&&r.push(i._compileMaterialsAsync()),i._parent.compileShadowGenerators&&r.push(i._compileShadowGeneratorsAsync());var o=Promise.all(r).then((function(){i._setState(g.GLTFLoaderState.READY),_.GLTFLoaderExtension._OnReady(i),i._startAnimations()}));return o.then((function(){i._parent._endPerformanceCounter(e),g.Tools.SetImmediate((function(){i._disposed||Promise.all(i._completePromises).then((function(){i._parent._endPerformanceCounter(t),i._setState(g.GLTFLoaderState.COMPLETE),i._parent.onCompleteObservable.notifyObservers(void 0),i._parent.onCompleteObservable.clear(),i.dispose()}),(function(e){i._parent.onErrorObservable.notifyObservers(e),i._parent.onErrorObservable.clear(),i.dispose()}))}))})),o}),(function(e){if(!i._disposed)throw i._parent.onErrorObservable.notifyObservers(e),i._parent.onErrorObservable.clear(),i.dispose(),e}))},p.prototype._loadData=function(e){if(this._gltf=e.json,this._setupData(),e.bin){var t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){var r=t[0];(r.byteLength<e.bin.byteLength-3||r.byteLength>e.bin.byteLength)&&g.Tools.Warn("Binary buffer length ("+r.byteLength+") from JSON does not match chunk length ("+e.bin.byteLength+")"),r._data=Promise.resolve(e.bin)}else g.Tools.Warn("Unexpected BIN chunk")}},p.prototype._setupData=function(){if(d.Assign(this._gltf.accessors),d.Assign(this._gltf.animations),d.Assign(this._gltf.buffers),d.Assign(this._gltf.bufferViews),d.Assign(this._gltf.cameras),d.Assign(this._gltf.images),d.Assign(this._gltf.materials),d.Assign(this._gltf.meshes),d.Assign(this._gltf.nodes),d.Assign(this._gltf.samplers),d.Assign(this._gltf.scenes),d.Assign(this._gltf.skins),d.Assign(this._gltf.textures),this._gltf.nodes){for(var e={},t=0,r=this._gltf.nodes;t<r.length;t++){if((l=r[t]).children)for(var n=0,o=l.children;n<o.length;n++){e[o[n]]=l._index}}for(var a=this._createRootNode(),i=0,s=this._gltf.nodes;i<s.length;i++){var l,u=e[(l=s[i])._index];l._parent=void 0===u?a:this._gltf.nodes[u]}}},p.prototype._loadExtensions=function(){for(var e=0,t=p._ExtensionNames;e<t.length;e++){var r=t[e],n=p._ExtensionFactories[r](this);this._extensions[r]=n,this._parent.onExtensionLoadedObservable.notifyObservers(n)}this._parent.onExtensionLoadedObservable.clear()},p.prototype._checkExtensions=function(){if(this._gltf.extensionsRequired)for(var e=0,t=this._gltf.extensionsRequired;e<t.length;e++){var r=t[e],n=this._extensions[r];if(!n||!n.enabled)throw new Error("Require extension "+r+" is not available")}},p.prototype._setState=function(e){this._state=e,this._parent._log(g.GLTFLoaderState[this._state])},p.prototype._createRootNode=function(){this._rootBabylonMesh=new g.Mesh("__root__",this._babylonScene);var e={_babylonMesh:this._rootBabylonMesh};switch(this._parent.coordinateSystemMode){case g.GLTFLoaderCoordinateSystemMode.AUTO:this._babylonScene.useRightHandedSystem||(e.rotation=[0,1,0,0],e.scale=[1,1,-1],p._LoadTransform(e,this._rootBabylonMesh));break;case g.GLTFLoaderCoordinateSystemMode.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode ("+this._parent.coordinateSystemMode+")")}return this._parent.onMeshLoadedObservable.notifyObservers(this._rootBabylonMesh),e},p.prototype._loadSceneAsync=function(e,t){var r=_.GLTFLoaderExtension._LoadSceneAsync(this,e,t);if(r)return r;var n=new Array;if(this._parent._logOpen(e+" "+(t.name||"")),t.nodes)for(var o=0,a=t.nodes;o<a.length;o++){var i=a[o],s=p._GetProperty(e+"/nodes/"+i,this._gltf.nodes,i);n.push(this._loadNodeAsync("#/nodes/"+s._index,s))}return n.push(this._loadAnimationsAsync()),this._parent._logClose(),Promise.all(n).then((function(){}))},p.prototype._forEachPrimitive=function(e,t){if(e._primitiveBabylonMeshes)for(var r=0,n=e._primitiveBabylonMeshes;r<n.length;r++){t(n[r])}else t(e._babylonMesh)},p.prototype._getMeshes=function(){var e=new Array;e.push(this._rootBabylonMesh);var t=this._gltf.nodes;if(t)for(var r=0,n=t;r<n.length;r++){var o=n[r];if(o._babylonMesh&&e.push(o._babylonMesh),o._primitiveBabylonMeshes)for(var a=0,i=o._primitiveBabylonMeshes;a<i.length;a++){var s=i[a];e.push(s)}}return e},p.prototype._getSkeletons=function(){var e=new Array,t=this._gltf.skins;if(t)for(var r=0,n=t;r<n.length;r++){var o=n[r];o._babylonSkeleton&&e.push(o._babylonSkeleton)}return e},p.prototype._getAnimationGroups=function(){var e=new Array,t=this._gltf.animations;if(t)for(var r=0,n=t;r<n.length;r++){var o=n[r];o._babylonAnimationGroup&&e.push(o._babylonAnimationGroup)}return e},p.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case g.GLTFLoaderAnimationStartMode.NONE:break;case g.GLTFLoaderAnimationStartMode.FIRST:0!==(e=this._getAnimationGroups()).length&&e[0].start(!0);break;case g.GLTFLoaderAnimationStartMode.ALL:for(var e,t=0,r=e=this._getAnimationGroups();t<r.length;t++){r[t].start(!0)}break;default:return void g.Tools.Error("Invalid animation start mode ("+this._parent.animationStartMode+")")}},p.prototype._loadNodeAsync=function(e,t){var r=_.GLTFLoaderExtension._LoadNodeAsync(this,e,t);if(r)return r;if(t._babylonMesh)throw new Error(e+": Invalid recursive node hierarchy");var n=new Array;this._parent._logOpen(e+" "+(t.name||""));var o=new g.Mesh(t.name||"node"+t._index,this._babylonScene,t._parent?t._parent._babylonMesh:null);if((t._babylonMesh=o).setEnabled(!1),p._LoadTransform(t,o),null!=t.mesh){var a=p._GetProperty(e+"/mesh",this._gltf.meshes,t.mesh);n.push(this._loadMeshAsync("#/meshes/"+a._index,t,a,o))}if(null!=t.camera){var i=p._GetProperty(e+"/camera",this._gltf.cameras,t.camera);this._loadCamera("#/cameras/"+i._index,i,o)}if(t.children)for(var s=0,l=t.children;s<l.length;s++){var u=l[s],c=p._GetProperty(e+"/children/"+u,this._gltf.nodes,u);n.push(this._loadNodeAsync("#/nodes/"+u,c))}return this._parent.onMeshLoadedObservable.notifyObservers(o),this._parent._logClose(),Promise.all(n).then((function(){o.setEnabled(!0)}))},p.prototype._loadMeshAsync=function(e,t,r,n){var o=this,a=new Array;this._parent._logOpen(e+" "+(r.name||""));var i=r.primitives;if(!i||0===i.length)throw new Error(e+": Primitives are missing");if(d.Assign(i),1===i.length){var s=i[0];a.push(this._loadPrimitiveAsync(e+"/primitives/"+s._index,t,r,s,n))}else{t._primitiveBabylonMeshes=[];for(var l=0,u=i;l<u.length;l++){s=u[l];var c=new g.Mesh((r.name||n.name)+"_"+s._index,this._babylonScene,n);t._primitiveBabylonMeshes.push(c),a.push(this._loadPrimitiveAsync(e+"/primitives/"+s._index,t,r,s,c)),this._parent.onMeshLoadedObservable.notifyObservers(n)}}if(null!=t.skin){var _=p._GetProperty(e+"/skin",this._gltf.skins,t.skin);a.push(this._loadSkinAsync("#/skins/"+_._index,t,r,_))}return this._parent._logClose(),Promise.all(a).then((function(){o._forEachPrimitive(t,(function(e){e._refreshBoundingInfo(!0)}))}))},p.prototype._loadPrimitiveAsync=function(t,e,r,n,o){var a=this,i=new Array;this._parent._logOpen(""+t),this._createMorphTargets(t,e,r,n,o),i.push(this._loadVertexDataAsync(t,n,o).then((function(e){return a._loadMorphTargetsAsync(t,n,o,e).then((function(){e.applyToMesh(o)}))})));var s=p._GetDrawMode(t,n.mode);if(null==n.material)o.material=this._getDefaultMaterial(s);else{var l=p._GetProperty(t+"/material}",this._gltf.materials,n.material);i.push(this._loadMaterialAsync("#/materials/"+l._index,l,r,o,s,(function(e){o.material=e})))}return this._parent._logClose(),Promise.all(i).then((function(){}))},p.prototype._loadVertexDataAsync=function(o,e,a){var i=this,t=_.GLTFLoaderExtension._LoadVertexDataAsync(this,o,e,a);if(t)return t;var s=e.attributes;if(!s)throw new Error(o+": Attributes are missing");var l=new Array,u=new g.Geometry(a.name,this._babylonScene);if(null==e.indices)a.isUnIndexed=!0;else{var r=p._GetProperty(o+"/indices",this._gltf.accessors,e.indices);l.push(this._loadIndicesAccessorAsync("#/accessors/"+r._index,r).then((function(e){u.setIndices(e)})))}var n=function(e,t,r){if(null!=s[e]){a._delayInfo=a._delayInfo||[],-1===a._delayInfo.indexOf(t)&&a._delayInfo.push(t);var n=p._GetProperty(o+"/attributes/"+e,i._gltf.accessors,s[e]);l.push(i._loadVertexAccessorAsync("#/accessors/"+n._index,n,t).then((function(e){u.setVerticesBuffer(e,n.count)}))),r&&r(n)}};return n("POSITION",g.VertexBuffer.PositionKind),n("NORMAL",g.VertexBuffer.NormalKind),n("TANGENT",g.VertexBuffer.TangentKind),n("TEXCOORD_0",g.VertexBuffer.UVKind),n("TEXCOORD_1",g.VertexBuffer.UV2Kind),n("JOINTS_0",g.VertexBuffer.MatricesIndicesKind),n("WEIGHTS_0",g.VertexBuffer.MatricesWeightsKind),n("COLOR_0",g.VertexBuffer.ColorKind,(function(e){"VEC4"===e.type&&(a.hasVertexAlpha=!0)})),Promise.all(l).then((function(){return u}))},p.prototype._createMorphTargets=function(e,t,r,n,o){if(n.targets){if(null==t._numMorphTargets)t._numMorphTargets=n.targets.length;else if(n.targets.length!==t._numMorphTargets)throw new Error(e+": Primitives do not have the same number of targets");o.morphTargetManager=new g.MorphTargetManager;for(var a=0;a<n.targets.length;a++){var i=t.weights?t.weights[a]:r.weights?r.weights[a]:0;o.morphTargetManager.addTarget(new g.MorphTarget("morphTarget"+a,i))}}},p.prototype._loadMorphTargetsAsync=function(e,t,r,n){if(!t.targets)return Promise.resolve();for(var o=new Array,a=r.morphTargetManager,i=0;i<a.numTargets;i++){var s=a.getTarget(i);o.push(this._loadMorphTargetVertexDataAsync(e+"/targets/"+i,n,t.targets[i],s))}return Promise.all(o).then((function(){}))},p.prototype._loadMorphTargetVertexDataAsync=function(a,i,s,t){var l=this,u=new Array,e=function(e,t,r){if(null!=s[e]){var n=i.getVertexBuffer(t);if(n){var o=p._GetProperty(a+"/"+e,l._gltf.accessors,s[e]);u.push(l._loadFloatAccessorAsync("#/accessors/"+o._index,o).then((function(e){r(n,e)})))}}};return e("POSITION",g.VertexBuffer.PositionKind,(function(e,r){e.forEach(r.length,(function(e,t){r[t]+=e})),t.setPositions(r)})),e("NORMAL",g.VertexBuffer.NormalKind,(function(e,r){e.forEach(r.length,(function(e,t){r[t]+=e})),t.setNormals(r)})),e("TANGENT",g.VertexBuffer.TangentKind,(function(e,r){var n=0;e.forEach(r.length/3*4,(function(e,t){(t+1)%4!=0&&(r[n++]+=e)})),t.setTangents(r)})),Promise.all(u).then((function(){}))},p._LoadTransform=function(e,t){var r=g.Vector3.Zero(),n=g.Quaternion.Identity(),o=g.Vector3.One();e.matrix?g.Matrix.FromArray(e.matrix).decompose(o,n,r):(e.translation&&(r=g.Vector3.FromArray(e.translation)),e.rotation&&(n=g.Quaternion.FromArray(e.rotation)),e.scale&&(o=g.Vector3.FromArray(e.scale)));t.position=r,t.rotationQuaternion=n,t.scaling=o},p.prototype._loadSkinAsync=function(e,r,t,n){var o=this,a=function(t){o._forEachPrimitive(r,(function(e){e.skeleton=t})),r._babylonMesh.parent=o._rootBabylonMesh,r._babylonMesh.position=g.Vector3.Zero(),r._babylonMesh.rotationQuaternion=g.Quaternion.Identity(),r._babylonMesh.scaling=g.Vector3.One()};if(n._loaded)return n._loaded.then((function(){a(n._babylonSkeleton)}));var i="skeleton"+n._index,s=new g.Skeleton(n.name||i,i,this._babylonScene);return n._babylonSkeleton=s,this._loadBones(e,n),a(s),n._loaded=this._loadSkinInverseBindMatricesDataAsync(e,n).then((function(e){o._updateBoneMatrices(s,e)}))},p.prototype._loadBones=function(e,t){for(var r={},n=0,o=t.joints;n<o.length;n++){var a=o[n],i=p._GetProperty(e+"/joints/"+a,this._gltf.nodes,a);this._loadBone(i,t,r)}},p.prototype._loadBone=function(e,t,r){var n=r[e._index];if(n)return n;var o=null;e._parent&&e._parent._babylonMesh!==this._rootBabylonMesh&&(o=this._loadBone(e._parent,t,r));var a=t.joints.indexOf(e._index);return n=new g.Bone(e.name||"joint"+e._index,t._babylonSkeleton,o,this._getNodeMatrix(e),null,null,a),r[e._index]=n,e._babylonBones=e._babylonBones||[],e._babylonBones.push(n),n},p.prototype._loadSkinInverseBindMatricesDataAsync=function(e,t){if(null==t.inverseBindMatrices)return Promise.resolve(null);var r=p._GetProperty(e+"/inverseBindMatrices",this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync("#/accessors/"+r._index,r)},p.prototype._updateBoneMatrices=function(e,t){for(var r=0,n=e.bones;r<n.length;r++){var o=n[r],a=g.Matrix.Identity(),i=o._index;t&&-1!==i&&(g.Matrix.FromArrayToRef(t,16*i,a),a.invertToRef(a));var s=o.getParent();s&&a.multiplyToRef(s.getInvertedAbsoluteTransform(),a),o.updateMatrix(a,!1,!1),o._updateDifferenceMatrix(void 0,!1)}},p.prototype._getNodeMatrix=function(e){return e.matrix?g.Matrix.FromArray(e.matrix):g.Matrix.Compose(e.scale?g.Vector3.FromArray(e.scale):g.Vector3.One(),e.rotation?g.Quaternion.FromArray(e.rotation):g.Quaternion.Identity(),e.translation?g.Vector3.FromArray(e.translation):g.Vector3.Zero())},p.prototype._loadCamera=function(e,t,r){var n=new g.FreeCamera(t.name||"camera"+t._index,g.Vector3.Zero(),this._babylonScene,!1);switch(n.parent=r,n.rotation=new g.Vector3(0,Math.PI,0),t.type){case"perspective":var o=t.perspective;if(!o)throw new Error(e+": Camera perspective properties are missing");n.fov=o.yfov,n.minZ=o.znear,n.maxZ=o.zfar||Number.MAX_VALUE;break;case"orthographic":if(!t.orthographic)throw new Error(e+": Camera orthographic properties are missing");n.mode=g.Camera.ORTHOGRAPHIC_CAMERA,n.orthoLeft=-t.orthographic.xmag,n.orthoRight=t.orthographic.xmag,n.orthoBottom=-t.orthographic.ymag,n.orthoTop=t.orthographic.ymag,n.minZ=t.orthographic.znear,n.maxZ=t.orthographic.zfar;break;default:throw new Error(e+": Invalid camera type ("+t.type+")")}this._parent.onCameraLoadedObservable.notifyObservers(n)},p.prototype._loadAnimationsAsync=function(){var e=this._gltf.animations;if(!e)return Promise.resolve();for(var t=new Array,r=0;r<e.length;r++){var n=e[r];t.push(this._loadAnimationAsync("#/animations/"+r,n))}return Promise.all(t).then((function(){}))},p.prototype._loadAnimationAsync=function(e,t){var r=this,n=_.GLTFLoaderExtension._LoadAnimationAsync(this,e,t);if(n)return n;var o=new g.AnimationGroup(t.name||"animation"+t._index,this._babylonScene);t._babylonAnimationGroup=o;var a=new Array;d.Assign(t.channels),d.Assign(t.samplers);for(var i=0,s=t.channels;i<s.length;i++){var l=s[i];a.push(this._loadAnimationChannelAsync(e+"/channels/"+l._index,e,t,l,o))}return Promise.all(a).then((function(){o.normalize(r._parent._normalizeAnimationGroupsToBeginAtZero?0:null)}))},p.prototype._loadAnimationChannelAsync=function(h,e,t,y,m){var b=this,v=p._GetProperty(h+"/target/node",this._gltf.nodes,y.target.node);if("weights"===y.target.path&&!v._numMorphTargets||"weights"!==y.target.path&&!v._babylonMesh)return Promise.resolve();if(null!=v.skin&&"weights"!==y.target.path)return Promise.resolve();var r=p._GetProperty(h+"/sampler",t.samplers,y.sampler);return this._loadAnimationSamplerAsync(e+"/samplers/"+y.sampler,r).then((function(r){var t,a;switch(y.target.path){case"translation":t="position",a=g.Animation.ANIMATIONTYPE_VECTOR3;break;case"rotation":t="rotationQuaternion",a=g.Animation.ANIMATIONTYPE_QUATERNION;break;case"scale":t="scaling",a=g.Animation.ANIMATIONTYPE_VECTOR3;break;case"weights":t="influence",a=g.Animation.ANIMATIONTYPE_FLOAT;break;default:throw new Error(h+": Invalid target path ("+y.target.path+")")}var n,e,o=0;switch(t){case"position":n=function(){var e=g.Vector3.FromArray(r.output,o);return o+=3,e};break;case"rotationQuaternion":n=function(){var e=g.Quaternion.FromArray(r.output,o);return o+=4,e};break;case"scaling":n=function(){var e=g.Vector3.FromArray(r.output,o);return o+=3,e};break;case"influence":n=function(){for(var e=new Array(v._numMorphTargets),t=0;t<v._numMorphTargets;t++)e[t]=r.output[o++];return e}}switch(r.interpolation){case"STEP":e=function(e){return{frame:r.input[e],value:n(),interpolation:g.AnimationKeyInterpolation.STEP}};break;case"LINEAR":e=function(e){return{frame:r.input[e],value:n()}};break;case"CUBICSPLINE":e=function(e){return{frame:r.input[e],inTangent:n(),value:n(),outTangent:n()}}}for(var i=new Array(r.input.length),s=0;s<r.input.length;s++)i[s]=e(s);if("influence"===t)for(var l=function(n){var e=m.name+"_channel"+m.targetedAnimations.length,o=new g.Animation(e,t,1,a);o.setKeys(i.map((function(e){return{frame:e.frame,inTangent:e.inTangent?e.inTangent[n]:void 0,value:e.value[n],outTangent:e.outTangent?e.outTangent[n]:void 0}}))),b._forEachPrimitive(v,(function(e){var t=e.morphTargetManager.getTarget(n),r=o.clone();t.animations.push(r),m.addTargetedAnimation(r,t)}))},u=0;u<v._numMorphTargets;u++)l(u);else{var c=m.name+"_channel"+m.targetedAnimations.length,_=new g.Animation(c,t,1,a);if(_.setKeys(i),v._babylonBones){for(var d=[v._babylonMesh].concat(v._babylonBones),f=0,p=d;f<p.length;f++){p[f].animations.push(_)}m.addTargetedAnimation(_,d)}else v._babylonMesh.animations.push(_),m.addTargetedAnimation(_,v._babylonMesh)}}))},p.prototype._loadAnimationSamplerAsync=function(e,t){if(t._data)return t._data;var n=t.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error(e+": Invalid interpolation ("+t.interpolation+")")}var r=p._GetProperty(e+"/input",this._gltf.accessors,t.input),o=p._GetProperty(e+"/output",this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync("#/accessors/"+r._index,r),this._loadFloatAccessorAsync("#/accessors/"+o._index,o)]).then((function(e){var t=e[0],r=e[1];return{input:t,interpolation:n,output:r}})),t._data},p.prototype._loadBufferAsync=function(e,t){if(t._data)return t._data;if(!t.uri)throw new Error(e+": Uri is missing");return t._data=this._loadUriAsync(e,t.uri),t._data},p.prototype._loadBufferViewAsync=function(t,r){if(r._data)return r._data;var e=p._GetProperty(t+"/buffer",this._gltf.buffers,r.buffer);return r._data=this._loadBufferAsync("#/buffers/"+e._index,e).then((function(e){try{return new Uint8Array(e.buffer,e.byteOffset+(r.byteOffset||0),r.byteLength)}catch(e){throw new Error(t+": "+e.message)}})),r._data},p.prototype._loadIndicesAccessorAsync=function(t,r){if("SCALAR"!==r.type)throw new Error(t+": Invalid type "+r.type);if(5121!==r.componentType&&5123!==r.componentType&&5125!==r.componentType)throw new Error(t+": Invalid component type "+r.componentType);if(r._data)return r._data;var e=p._GetProperty(t+"/bufferView",this._gltf.bufferViews,r.bufferView);return r._data=this._loadBufferViewAsync("#/bufferViews/"+e._index,e).then((function(e){return p._GetTypedArray(t,r.componentType,e,r.byteOffset,r.count)})),r._data},p.prototype._loadFloatAccessorAsync=function(c,_){var r=this;if(5126!==_.componentType)throw new Error("Invalid component type "+_.componentType);if(_._data)return _._data;var d=p._GetNumComponents(c,_.type),t=d*_.count;if(null==_.bufferView)_._data=Promise.resolve(new Float32Array(t));else{var e=p._GetProperty(c+"/bufferView",this._gltf.bufferViews,_.bufferView);_._data=this._loadBufferViewAsync("#/bufferViews/"+e._index,e).then((function(e){return p._GetTypedArray(c,_.componentType,e,_.byteOffset,t)}))}if(_.sparse){var f=_.sparse;_._data=_._data.then((function(u){var e=p._GetProperty(c+"/sparse/indices/bufferView",r._gltf.bufferViews,f.indices.bufferView),t=p._GetProperty(c+"/sparse/values/bufferView",r._gltf.bufferViews,f.values.bufferView);return Promise.all([r._loadBufferViewAsync("#/bufferViews/"+e._index,e),r._loadBufferViewAsync("#/bufferViews/"+t._index,t)]).then((function(e){for(var t=e[0],r=e[1],n=p._GetTypedArray(c+"/sparse/indices",f.indices.componentType,t,f.indices.byteOffset,f.count),o=p._GetTypedArray(c+"/sparse/values",_.componentType,r,f.values.byteOffset,d*f.count),a=0,i=0;i<n.length;i++)for(var s=n[i]*d,l=0;l<d;l++)u[s++]=o[a++];return u}))}))}return _._data},p.prototype._loadVertexBufferViewAsync=function(e,t,r){var n=this;return t._babylonBuffer||(t._babylonBuffer=this._loadBufferViewAsync(e,t).then((function(e){return new g.Buffer(n._babylonScene.getEngine(),e,!1)}))),t._babylonBuffer},p.prototype._loadVertexAccessorAsync=function(r,n,o){var a=this;if(n._babylonVertexBuffer)return n._babylonVertexBuffer;if(n.sparse)n._babylonVertexBuffer=this._loadFloatAccessorAsync(r,n).then((function(e){return new g.VertexBuffer(a._babylonScene.getEngine(),e,o,!1)}));else{var i=p._GetProperty(r+"/bufferView",this._gltf.bufferViews,n.bufferView);n._babylonVertexBuffer=this._loadVertexBufferViewAsync("#/bufferViews/"+i._index,i,o).then((function(e){var t=p._GetNumComponents(r,n.type);return new g.VertexBuffer(a._babylonScene.getEngine(),e,o,!1,!1,i.byteStride,!1,n.byteOffset,t,n.componentType,n.normalized,!0)}))}return n._babylonVertexBuffer},p.prototype._getDefaultMaterial=function(e){var t=this._defaultBabylonMaterials[e];return t||((t=this._createMaterial("__gltf_default",e)).transparencyMode=g.PBRMaterial.PBRMATERIAL_OPAQUE,t.metallic=1,t.roughness=1,this._parent.onMaterialLoadedObservable.notifyObservers(t)),t},p.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(e,t,r){var n=new Array;r.metallic=1,r.roughness=1;var o=t.pbrMetallicRoughness;return o&&(o.baseColorFactor?(r.albedoColor=g.Color3.FromArray(o.baseColorFactor),r.alpha=o.baseColorFactor[3]):r.albedoColor=g.Color3.White(),r.metallic=null==o.metallicFactor?1:o.metallicFactor,r.roughness=null==o.roughnessFactor?1:o.roughnessFactor,o.baseColorTexture&&n.push(this._loadTextureInfoAsync(e+"/baseColorTexture",o.baseColorTexture,(function(e){r.albedoTexture=e}))),o.metallicRoughnessTexture&&(n.push(this._loadTextureInfoAsync(e+"/metallicRoughnessTexture",o.metallicRoughnessTexture,(function(e){r.metallicTexture=e}))),r.useMetallnessFromMetallicTextureBlue=!0,r.useRoughnessFromMetallicTextureGreen=!0,r.useRoughnessFromMetallicTextureAlpha=!1)),this._loadMaterialAlphaProperties(e,t,r),Promise.all(n).then((function(){}))},p.prototype._loadMaterialAsync=function(e,t,r,n,o,a){var i=_.GLTFLoaderExtension._LoadMaterialAsync(this,e,t,r,n,o,a);if(i)return i;t._babylonData=t._babylonData||{};var s=t._babylonData[o];if(!s){this._parent._logOpen(e+" "+(t.name||""));var l=t.name||"material"+t._index,u=this._createMaterial(l,o);s={material:u,meshes:[],loaded:this._loadMaterialPropertiesAsync(e,t,u)},t._babylonData[o]=s,this._parent.onMaterialLoadedObservable.notifyObservers(u),this._parent._logClose()}return s.meshes.push(n),n.onDisposeObservable.addOnce((function(){var e=s.meshes.indexOf(n);-1!==e&&s.meshes.splice(e,1)})),a(s.material),s.loaded},p.prototype._loadMaterialPropertiesAsync=function(e,t,r){var n=_.GLTFLoaderExtension._LoadMaterialPropertiesAsync(this,e,t,r);if(n)return n;var o=new Array;return o.push(this._loadMaterialBasePropertiesAsync(e,t,r)),o.push(this._loadMaterialMetallicRoughnessPropertiesAsync(e,t,r)),Promise.all(o).then((function(){}))},p.prototype._createMaterial=function(e,t){var r=new g.PBRMaterial(e,this._babylonScene);return r.sideOrientation=this._babylonScene.useRightHandedSystem?g.Material.CounterClockWiseSideOrientation:g.Material.ClockWiseSideOrientation,r.fillMode=t,r.enableSpecularAntiAliasing=!0,r.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,r.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,r},p.prototype._loadMaterialBasePropertiesAsync=function(e,t,r){var n=new Array;return r.emissiveColor=t.emissiveFactor?g.Color3.FromArray(t.emissiveFactor):new g.Color3(0,0,0),t.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),t.normalTexture&&(n.push(this._loadTextureInfoAsync(e+"/normalTexture",t.normalTexture,(function(e){r.bumpTexture=e}))),r.invertNormalMapX=!this._babylonScene.useRightHandedSystem,r.invertNormalMapY=this._babylonScene.useRightHandedSystem,null!=t.normalTexture.scale&&(r.bumpTexture.level=t.normalTexture.scale)),t.occlusionTexture&&(n.push(this._loadTextureInfoAsync(e+"/occlusionTexture",t.occlusionTexture,(function(e){r.ambientTexture=e}))),r.useAmbientInGrayScale=!0,null!=t.occlusionTexture.strength&&(r.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&n.push(this._loadTextureInfoAsync(e+"/emissiveTexture",t.emissiveTexture,(function(e){r.emissiveTexture=e}))),Promise.all(n).then((function(){}))},p.prototype._loadMaterialAlphaProperties=function(e,t,r){switch(t.alphaMode||"OPAQUE"){case"OPAQUE":r.transparencyMode=g.PBRMaterial.PBRMATERIAL_OPAQUE;break;case"MASK":r.transparencyMode=g.PBRMaterial.PBRMATERIAL_ALPHATEST,r.alphaCutOff=null==t.alphaCutoff?.5:t.alphaCutoff,r.albedoTexture&&(r.albedoTexture.hasAlpha=!0);break;case"BLEND":r.transparencyMode=g.PBRMaterial.PBRMATERIAL_ALPHABLEND,r.albedoTexture&&(r.albedoTexture.hasAlpha=!0,r.useAlphaFromAlbedoTexture=!0);break;default:throw new Error(e+": Invalid alpha mode ("+t.alphaMode+")")}},p.prototype._loadTextureInfoAsync=function(e,t,r){var n=_.GLTFLoaderExtension._LoadTextureInfoAsync(this,e,t,r);if(n)return n;this._parent._logOpen(""+e);var o=p._GetProperty(e+"/index",this._gltf.textures,t.index),a=this._loadTextureAsync("#/textures/"+t.index,o,(function(e){e.coordinatesIndex=t.texCoord||0,r(e)}));return this._parent._logClose(),a},p.prototype._loadTextureAsync=function(r,e,t){var n=this,o=_.GLTFLoaderExtension._LoadTextureAsync(this,r,e,t);if(o)return o;var a=new Array;this._parent._logOpen(r+" "+(e.name||""));var i=null==e.sampler?this._defaultSampler:p._GetProperty(r+"/sampler",this._gltf.samplers,e.sampler),s=this._loadSampler("#/samplers/"+i._index,i),l=new g.Deferred,u=new g.Texture(null,this._babylonScene,s.noMipMaps,!1,s.samplingMode,function(){n._disposed||l.resolve()},function(e,t){n._disposed||l.reject(new Error(r+": "+(t&&t.message?t.message:e||"Failed to load texture")))});a.push(l.promise),u.name=e.name||"texture"+e._index,u.wrapU=s.wrapU,u.wrapV=s.wrapV;var c=p._GetProperty(r+"/source",this._gltf.images,e.source);return a.push(this._loadImageAsync("#/images/"+c._index,c).then((function(e){var t="data:"+n._rootUrl+(c.uri||"image"+c._index);u.updateURL(t,new Blob([e],{type:c.mimeType}))}))),t(u),this._parent.onTextureLoadedObservable.notifyObservers(u),this._parent._logClose(),Promise.all(a).then((function(){}))},p.prototype._loadSampler=function(e,t){return t._data||(t._data={noMipMaps:9728===t.minFilter||9729===t.minFilter,samplingMode:p._GetTextureSamplingMode(e,t.magFilter,t.minFilter),wrapU:p._GetTextureWrapMode(e,t.wrapS),wrapV:p._GetTextureWrapMode(e,t.wrapT)}),t._data},p.prototype._loadImageAsync=function(e,t){if(!t._data){if(this._parent._logOpen(e+" "+(t.name||"")),t.uri)t._data=this._loadUriAsync(e,t.uri);else{var r=p._GetProperty(e+"/bufferView",this._gltf.bufferViews,t.bufferView);t._data=this._loadBufferViewAsync("#/bufferViews/"+r._index,r)}this._parent._logClose()}return t._data},p.prototype._loadUriAsync=function(o,a){var i=this,e=_.GLTFLoaderExtension._LoadUriAsync(this,o,a);if(e)return e;if(!p._ValidateUri(a))throw new Error(o+": Uri '"+a+"' is invalid");if(g.Tools.IsBase64(a)){var t=new Uint8Array(g.Tools.DecodeBase64(a));return this._parent._log("Decoded "+a.substr(0,64)+"... ("+t.length+" bytes)"),Promise.resolve(t)}return this._parent._log("Loading "+a),this._parent.preprocessUrlAsync(this._rootUrl+a).then((function(e){return new Promise(function(r,n){if(!i._disposed){var t=g.Tools.LoadFile(e,(function(e){if(!i._disposed){var t=new Uint8Array(e);i._parent._log("Loaded "+a+" ("+t.length+" bytes)"),r(t)}}),(function(e){if(!i._disposed&&(t&&(t._lengthComputable=e.lengthComputable,t._loaded=e.loaded,t._total=e.total),i._state===g.GLTFLoaderState.LOADING))try{i._onProgress()}catch(e){n(e)}}),i._babylonScene.database,!0,(function(e,t){i._disposed||n(new g.LoadFileError(o+": Failed to load '"+a+"'"+(e?": "+e.status+" "+e.statusText:""),e))}));i._requests.push(t)}})}))},p.prototype._onProgress=function(){if(this._progressCallback){for(var e=!0,t=0,r=0,n=0,o=this._requests;n<o.length;n++){var a=o[n];if(void 0===a._lengthComputable||void 0===a._loaded||void 0===a._total)return;e=e&&a._lengthComputable,t+=a._loaded,r+=a._total}this._progressCallback(new g.SceneLoaderProgressEvent(e,t,e?r:0))}},p._GetProperty=function(e,t,r){if(!t||null==r||!t[r])throw new Error(e+": Failed to find index ("+r+")");return t[r]},p._GetTextureWrapMode=function(e,t){switch(t=null==t?10497:t){case 33071:return g.Texture.CLAMP_ADDRESSMODE;case 33648:return g.Texture.MIRROR_ADDRESSMODE;case 10497:return g.Texture.WRAP_ADDRESSMODE;default:return g.Tools.Warn(e+": Invalid texture wrap mode ("+t+")"),g.Texture.WRAP_ADDRESSMODE}},p._GetTextureSamplingMode=function(e,t,r){if(r=null==r?9987:r,9729===(t=null==t?9729:t))switch(r){case 9728:return g.Texture.LINEAR_NEAREST;case 9729:return g.Texture.LINEAR_LINEAR;case 9984:return g.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return g.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return g.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return g.Texture.LINEAR_LINEAR_MIPLINEAR;default:return g.Tools.Warn(e+": Invalid texture minification filter ("+r+")"),g.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(9728!==t&&g.Tools.Warn(e+": Invalid texture magnification filter ("+t+")"),r){case 9728:return g.Texture.NEAREST_NEAREST;case 9729:return g.Texture.NEAREST_LINEAR;case 9984:return g.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return g.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return g.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return g.Texture.NEAREST_LINEAR_MIPLINEAR;default:return g.Tools.Warn(e+": Invalid texture minification filter ("+r+")"),g.Texture.NEAREST_NEAREST_MIPNEAREST}},p._GetTypedArray=function(t,e,r,n,o){var a=r.buffer;n=r.byteOffset+(n||0);try{switch(e){case 5120:return new Int8Array(a,n,o);case 5121:return new Uint8Array(a,n,o);case 5122:return new Int16Array(a,n,o);case 5123:return new Uint16Array(a,n,o);case 5125:return new Uint32Array(a,n,o);case 5126:return new Float32Array(a,n,o);default:throw new Error("Invalid component type "+e)}}catch(e){throw new Error(t+": "+e)}},p._GetNumComponents=function(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error(e+": Invalid type ("+t+")")},p._ValidateUri=function(e){return g.Tools.IsBase64(e)||-1===e.indexOf("..")},p._GetDrawMode=function(e,t){switch(null==t&&(t=4),t){case 0:return g.Material.PointListDrawMode;case 1:return g.Material.LineListDrawMode;case 2:return g.Material.LineLoopDrawMode;case 3:return g.Material.LineStripDrawMode;case 4:return g.Material.TriangleFillMode;case 5:return g.Material.TriangleStripDrawMode;case 6:return g.Material.TriangleFanDrawMode}throw new Error(e+": Invalid mesh primitive mode ("+t+")")},p.prototype._compileMaterialsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile materials");var t=new Array;if(this._gltf.materials)for(var r=0,n=this._gltf.materials;r<n.length;r++){var o=n[r];if(o._babylonData)for(var a in o._babylonData)for(var i=o._babylonData[a],s=0,l=i.meshes;s<l.length;s++){var u=l[s];u.computeWorldMatrix(!0);var c=i.material;t.push(c.forceCompilationAsync(u)),this._parent.useClipPlane&&t.push(c.forceCompilationAsync(u,{clipPlane:!0}))}}return Promise.all(t).then((function(){e._parent._endPerformanceCounter("Compile materials")}))},p.prototype._compileShadowGeneratorsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var t=new Array,r=0,n=this._babylonScene.lights;r<n.length;r++){var o=n[r].getShadowGenerator();o&&t.push(o.forceCompilationAsync())}return Promise.all(t).then((function(){e._parent._endPerformanceCounter("Compile shadow generators")}))},p.prototype._applyExtensions=function(e){for(var t=0,r=p._ExtensionNames;t<r.length;t++){var n=r[t],o=this._extensions[n];if(o.enabled){var a=e(o);if(a)return a}}return null},p.prototype._forEachExtensions=function(e){for(var t=0,r=p._ExtensionNames;t<r.length;t++){var n=r[t],o=this._extensions[n];o.enabled&&e(o)}},p._ExtensionNames=new Array,p._ExtensionFactories={},p})();_.GLTFLoader=t,g.GLTFFileLoader._CreateGLTFLoaderV2=function(e){return new t(e)}})(g.GLTF2||(g.GLTF2={}))})(BABYLON||(BABYLON={})),(function(e){var t,r;t=e.GLTF2||(e.GLTF2={}),r=(function(){function e(e){this.enabled=!0,this._loader=e}return e.prototype.dispose=function(){delete this._loader},e.prototype._onLoading=function(){},e.prototype._onReady=function(){},e.prototype._loadSceneAsync=function(e,t){return null},e.prototype._loadNodeAsync=function(e,t){return null},e.prototype._loadVertexDataAsync=function(e,t,r){return null},e.prototype._loadMaterialAsync=function(e,t,r,n,o,a){return null},e.prototype._loadMaterialPropertiesAsync=function(e,t,r){return null},e.prototype._loadTextureInfoAsync=function(e,t,r){return null},e.prototype._loadTextureAsync=function(e,t,r){return null},e.prototype._loadUriAsync=function(e,t){return null},e.prototype._loadAnimationAsync=function(e,t){return null},e.prototype._loadExtensionAsync=function(e,t,r){if(!t.extensions)return null;var n=t.extensions,o=n[this.name];if(!o)return null;delete n[this.name];try{return r(e+"/extensions/"+this.name,o)}finally{n[this.name]=o}},e.prototype._loadExtrasValueAsync=function(e,t,r){if(!t.extras)return null;var n=t.extras,o=n[this.name];if(void 0===o)return null;delete n[this.name];try{return r(e+"/extras/"+this.name,o)}finally{n[this.name]=o}},e._OnLoading=function(e){e._forEachExtensions((function(e){return e._onLoading()}))},e._OnReady=function(e){e._forEachExtensions((function(e){return e._onReady()}))},e._LoadSceneAsync=function(e,t,r){return e._applyExtensions((function(e){return e._loadSceneAsync(t,r)}))},e._LoadNodeAsync=function(e,t,r){return e._applyExtensions((function(e){return e._loadNodeAsync(t,r)}))},e._LoadVertexDataAsync=function(e,t,r,n){return e._applyExtensions((function(e){return e._loadVertexDataAsync(t,r,n)}))},e._LoadMaterialAsync=function(e,t,r,n,o,a,i){return e._applyExtensions((function(e){return e._loadMaterialAsync(t,r,n,o,a,i)}))},e._LoadMaterialPropertiesAsync=function(e,t,r,n){return e._applyExtensions((function(e){return e._loadMaterialPropertiesAsync(t,r,n)}))},e._LoadTextureInfoAsync=function(e,t,r,n){return e._applyExtensions((function(e){return e._loadTextureInfoAsync(t,r,n)}))},e._LoadTextureAsync=function(e,t,r,n){return e._applyExtensions((function(e){return e._loadTextureAsync(t,r,n)}))},e._LoadUriAsync=function(e,t,r){return e._applyExtensions((function(e){return e._loadUriAsync(t,r)}))},e._LoadAnimationAsync=function(e,t,r){return e._applyExtensions((function(e){return e._loadAnimationAsync(t,r)}))},e})(),t.GLTFLoaderExtension=r})(BABYLON||(BABYLON={}));var __extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(c){var _,e,d,t;_=c.GLTF2||(c.GLTF2={}),e=_.Extensions||(_.Extensions={}),d="MSFT_audio_emitter",t=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=d,e}return __extends(e,t),e.prototype._loadClipAsync=function(e,t){if(t._objectURL)return t._objectURL;var r;if(t.uri)r=this._loader._loadUriAsync(e,t.uri);else{var n=_.GLTFLoader._GetProperty(e+"/bufferView",this._loader._gltf.bufferViews,t.bufferView);r=this._loader._loadBufferViewAsync("#/bufferViews/"+n._index,n)}return t._objectURL=r.then((function(e){return URL.createObjectURL(new Blob([e],{type:t.mimeType}))})),t._objectURL},e.prototype._loadEmitterAsync=function(e,n){var o=this;if(n._babylonSounds=n._babylonSounds||[],!n._babylonData){var a=new Array,i=n.name||"emitter"+n._index,s={loop:!1,autoplay:!1,volume:null==n.volume?1:n.volume};_._ArrayItem.Assign(this._clips);for(var t=function(r){var e="#/extensions/"+d+"/clips",t=_.GLTFLoader._GetProperty(e,l._clips,n.clips[r].clip);a.push(l._loadClipAsync(e+"/"+n.clips[r].clip,t).then((function(e){var t=n._babylonSounds[r]=new c.Sound(i,e,o._loader._babylonScene,null,s);t.refDistance=n.refDistance||1,t.maxDistance=n.maxDistance||256,t.rolloffFactor=n.rolloffFactor||1,t.distanceModel=n.distanceModel||"exponential",t._positionInEmitterSpace=!0})))},l=this,r=0;r<n.clips.length;r++)t(r);var u=Promise.all(a).then((function(){var e=n.clips.map((function(e){return e.weight||1})),t=new c.WeightedSound(n.loop||!1,n._babylonSounds,e);n.innerAngle&&(t.directionalConeInnerAngle=2*c.Tools.ToDegrees(n.innerAngle)),n.outerAngle&&(t.directionalConeOuterAngle=2*c.Tools.ToDegrees(n.outerAngle)),n.volume&&(t.volume=n.volume),n._babylonData.sound=t}));n._babylonData={loaded:u}}return n._babylonData.loaded},e.prototype._loadSceneAsync=function(e,t){var s=this;return this._loadExtensionAsync(e,t,(function(a,i){return s._loader._loadSceneAsync(e,t).then((function(){var e=new Array;_._ArrayItem.Assign(s._emitters);for(var t=0,r=i.emitters;t<r.length;t++){var n=r[t],o=_.GLTFLoader._GetProperty(a+"/emitters",s._emitters,n);if(null!=o.refDistance||null!=o.maxDistance||null!=o.rolloffFactor||null!=o.distanceModel||null!=o.innerAngle||null!=o.outerAngle)throw new Error(a+": Direction or Distance properties are not allowed on emitters attached to a scene");e.push(s._loadEmitterAsync(a+"/emitters/"+o._index,o))}return Promise.all(e).then((function(){}))}))}))},e.prototype._loadNodeAsync=function(e,i){var s=this;return this._loadExtensionAsync(e,i,(function(o,a){return s._loader._loadNodeAsync(o,i).then((function(){var t=new Array;_._ArrayItem.Assign(s._emitters);for(var e=function(e){var n=_.GLTFLoader._GetProperty(o+"/emitters",s._emitters,e);t.push(s._loadEmitterAsync(o+"/emitters/"+n._index,n).then((function(){if(i._babylonMesh)for(var e=0,t=n._babylonSounds;e<t.length;e++){var r=t[e];r.attachToMesh(i._babylonMesh),null==n.innerAngle&&null==n.outerAngle||(r.setLocalDirectionToMesh(new c.Vector3(0,0,1)),r.setDirectionalCone(2*c.Tools.ToDegrees(null==n.innerAngle?Math.PI:n.innerAngle),2*c.Tools.ToDegrees(null==n.outerAngle?Math.PI:n.outerAngle),0))}})))},r=0,n=a.emitters;r<n.length;r++)e(n[r]);return Promise.all(t).then((function(){}))}))}))},e.prototype._loadAnimationAsync=function(s,l){var u=this;return this._loadExtensionAsync(s,l,(function(a,i){return u._loader._loadAnimationAsync(a,l).then((function(){var e=new Array,t=l._babylonAnimationGroup;_._ArrayItem.Assign(i.events);for(var r=0,n=i.events;r<n.length;r++){var o=n[r];e.push(u._loadAnimationEventAsync(a+"/events/"+o._index,s,l,o,t))}return Promise.all(e).then((function(){}))}))}))},e.prototype._getEventAction=function(e,r,t,n,o){if("play"==t)return function(e){var t=(o||0)+(e-n);r.play(t)};if("stop"==t)return function(e){r.stop()};if("pause"==t)return function(e){r.pause()};throw new Error(e+": Unsupported action "+t)},e.prototype._loadAnimationEventAsync=function(r,e,t,n,o){var a=this;if(0==o.targetedAnimations.length)return Promise.resolve();var i=o.targetedAnimations[0],s=n.emitter,l=_.GLTFLoader._GetProperty("#/extensions/"+d+"/emitters",this._emitters,s);return this._loadEmitterAsync(r,l).then((function(){var e=l._babylonData.sound;if(e){var t=new c.AnimationEvent(n.time,a._getEventAction(r,e,n.action,n.time,n.startOffset));i.animation.addEvent(t),o.onAnimationGroupEndObservable.add((function(){e.stop()})),o.onAnimationGroupPauseObservable.add((function(){e.pause()}))}}))},Object.defineProperty(e.prototype,"_extension",{get:function(){var e=this._loader._gltf.extensions;if(!e||!e[this.name])throw new Error("#/extensions: '"+this.name+"' not found");return e[this.name]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_clips",{get:function(){return this._extension.clips},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_emitters",{get:function(){return this._extension.emitters},enumerable:!0,configurable:!0}),e})(_.GLTFLoaderExtension),e.MSFT_audio_emitter=t,_.GLTFLoader._Register(d,(function(e){return new t(e)}))})(BABYLON||(BABYLON={}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(l){var i,e,r,t;i=l.GLTF2||(l.GLTF2={}),e=i.Extensions||(i.Extensions={}),r="MSFT_lod",t=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=r,e.maxLODsToLoad=Number.MAX_VALUE,e.onNodeLODsLoadedObservable=new l.Observable,e.onMaterialLODsLoadedObservable=new l.Observable,e._nodeIndexLOD=null,e._nodeSignalLODs=new Array,e._nodePromiseLODs=new Array,e._materialIndexLOD=null,e._materialSignalLODs=new Array,e._materialPromiseLODs=new Array,e}return __extends(e,t),e.prototype.dispose=function(){t.prototype.dispose.call(this),this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},e.prototype._onReady=function(){for(var r=this,e=function(e){var t=Promise.all(n._nodePromiseLODs[e]).then((function(){0!==e&&r._loader._parent._endPerformanceCounter("Node LOD "+e),r._loader._parent._log("Loaded node LOD "+e),r.onNodeLODsLoadedObservable.notifyObservers(e),e!==r._nodePromiseLODs.length-1&&(r._loader._parent._startPerformanceCounter("Node LOD "+(e+1)),r._nodeSignalLODs[e]&&r._nodeSignalLODs[e].resolve())}));n._loader._completePromises.push(t)},n=this,t=0;t<this._nodePromiseLODs.length;t++)e(t);var o=function(e){var t=Promise.all(a._materialPromiseLODs[e]).then((function(){0!==e&&r._loader._parent._endPerformanceCounter("Material LOD "+e),r._loader._parent._log("Loaded material LOD "+e),r.onMaterialLODsLoadedObservable.notifyObservers(e),e!==r._materialPromiseLODs.length-1&&(r._loader._parent._startPerformanceCounter("Material LOD "+(e+1)),r._materialSignalLODs[e]&&r._materialSignalLODs[e].resolve())}));a._loader._completePromises.push(t)},a=this;for(t=0;t<this._materialPromiseLODs.length;t++)o(t)},e.prototype._loadNodeAsync=function(e,i){var s=this;return this._loadExtensionAsync(e,i,(function(e,t){var n,o=s._getLODs(e,i,s._loader._gltf.nodes,t.ids);s._loader._parent._logOpen(""+e);for(var r=function(t){var e=o[t];0!==t&&(s._nodeIndexLOD=t,s._nodeSignalLODs[t]=s._nodeSignalLODs[t]||new l.Deferred);var r=s._loader._loadNodeAsync("#/nodes/"+e._index,e).then((function(){if(0!==t){var e=o[t-1];e._babylonMesh&&(e._babylonMesh.dispose(),delete e._babylonMesh,s._disposeUnusedMaterials())}}));0===t?n=r:s._nodeIndexLOD=null,s._nodePromiseLODs[t]=s._nodePromiseLODs[t]||[],s._nodePromiseLODs[t].push(r)},a=0;a<o.length;a++)r(a);return s._loader._parent._logClose(),n}))},e.prototype._loadMaterialAsync=function(e,i,s,l,u,c){var _=this;return this._nodeIndexLOD?null:this._loadExtensionAsync(e,i,(function(e,t){var o,a=_._getLODs(e,i,_._loader._gltf.materials,t.ids);_._loader._parent._logOpen(""+e);for(var r=function(r){var n=a[r];0!==r&&(_._materialIndexLOD=r);var e=_._loader._loadMaterialAsync("#/materials/"+n._index,n,s,l,u,0===r?c:function(){}).then((function(){if(0!==r){var e=n._babylonData;c(e[u].material);var t=a[r-1]._babylonData;t[u]&&(t[u].material.dispose(),delete t[u])}}));0===r?o=e:_._materialIndexLOD=null,_._materialPromiseLODs[r]=_._materialPromiseLODs[r]||[],_._materialPromiseLODs[r].push(e)},n=0;n<a.length;n++)r(n);return _._loader._parent._logClose(),o}))},e.prototype._loadUriAsync=function(e,t){var r=this;if(null!==this._materialIndexLOD){this._loader._parent._log("deferred");var n=this._materialIndexLOD-1;return this._materialSignalLODs[n]=this._materialSignalLODs[n]||new l.Deferred,this._materialSignalLODs[n].promise.then((function(){return r._loader._loadUriAsync(e,t)}))}return null!==this._nodeIndexLOD?(this._loader._parent._log("deferred"),n=this._nodeIndexLOD-1,this._nodeSignalLODs[n]=this._nodeSignalLODs[n]||new l.Deferred,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then((function(){return r._loader._loadUriAsync(e,t)}))):null},e.prototype._getLODs=function(e,t,r,n){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var o=new Array,a=n.length-1;0<=a;a--)if(o.push(i.GLTFLoader._GetProperty(e+"/ids/"+n[a],r,n[a])),o.length===this.maxLODsToLoad)return o;return o.push(t),o},e.prototype._disposeUnusedMaterials=function(){var e=this._loader._gltf.materials;if(e)for(var t=0,r=e;t<r.length;t++){var n=r[t];if(n._babylonData)for(var o in n._babylonData){var a=n._babylonData[o];0===a.meshes.length&&(a.material.dispose(!1,!0),delete n._babylonData[o])}}},e})(i.GLTFLoaderExtension),e.MSFT_lod=t,i.GLTFLoader._Register(r,(function(e){return new t(e)}))})(BABYLON||(BABYLON={}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(e){var t,r,n,o;t=e.GLTF2||(e.GLTF2={}),r=t.Extensions||(t.Extensions={}),n="MSFT_minecraftMesh",o=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=n,e}return __extends(e,t),e.prototype._loadMaterialAsync=function(r,n,o,a,i,s){var l=this;return this._loadExtrasValueAsync(r,o,(function(e,t){return t?l._loader._loadMaterialAsync(r,n,o,a,i,(function(e){e.needAlphaBlending()&&(e.forceDepthWrite=!0,e.separateCullingPass=!0),e.backFaceCulling=e.forceDepthWrite,e.twoSidedLighting=!0,s(e)})):null}))},e})(t.GLTFLoaderExtension),r.MSFT_minecraftMesh=o,t.GLTFLoader._Register(n,(function(e){return new o(e)}))})(BABYLON||(BABYLON={}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(e){var t,r,n,o;t=e.GLTF2||(e.GLTF2={}),r=t.Extensions||(t.Extensions={}),n="MSFT_sRGBFactors",o=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=n,e}return __extends(e,t),e.prototype._loadMaterialPropertiesAsync=function(n,o,a){var i=this;return this._loadExtrasValueAsync(n,o,(function(e,t){if(t){var r=i._loader._loadMaterialPropertiesAsync(n,o,a);return i._convertColorsToLinear(a),r}return null}))},e.prototype._convertColorsToLinear=function(e){e.albedoTexture||e.albedoColor.toLinearSpaceToRef(e.albedoColor),e.reflectivityTexture||e.reflectivityColor.toLinearSpaceToRef(e.reflectivityColor)},e})(t.GLTFLoaderExtension),r.MSFT_sRGBFactors=o,t.GLTFLoader._Register(n,(function(e){return new o(e)}))})(BABYLON||(BABYLON={}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(u){var c,e,n,t;c=u.GLTF2||(u.GLTF2={}),e=c.Extensions||(c.Extensions={}),n="KHR_draco_mesh_compression",t=(function(r){function e(e){var t=r.call(this,e)||this;return t.name=n,t._dracoCompression=null,u.DracoCompression.DecoderAvailable||(t.enabled=!1),t}return __extends(e,r),e.prototype.dispose=function(){this._dracoCompression&&this._dracoCompression.dispose(),r.prototype.dispose.call(this)},e.prototype._loadVertexDataAsync=function(a,i,s){var l=this;return this._loadExtensionAsync(a,i,(function(e,n){if(null!=i.mode){if(5!==i.mode&&4!==i.mode)throw new Error(a+": Unsupported mode "+i.mode);if(5===i.mode)throw new Error(a+": Mode "+i.mode+" is not currently supported")}var o={},t=function(e,t){var r=n.attributes[e];null!=r&&(s._delayInfo=s._delayInfo||[],-1===s._delayInfo.indexOf(t)&&s._delayInfo.push(t),o[t]=r)};t("POSITION",u.VertexBuffer.PositionKind),t("NORMAL",u.VertexBuffer.NormalKind),t("TANGENT",u.VertexBuffer.TangentKind),t("TEXCOORD_0",u.VertexBuffer.UVKind),t("TEXCOORD_1",u.VertexBuffer.UV2Kind),t("JOINTS_0",u.VertexBuffer.MatricesIndicesKind),t("WEIGHTS_0",u.VertexBuffer.MatricesWeightsKind),t("COLOR_0",u.VertexBuffer.ColorKind);var r=c.GLTFLoader._GetProperty(e,l._loader._gltf.bufferViews,n.bufferView);return r._dracoBabylonGeometry||(r._dracoBabylonGeometry=l._loader._loadBufferViewAsync("#/bufferViews/"+r._index,r).then((function(e){return l._dracoCompression||(l._dracoCompression=new u.DracoCompression),l._dracoCompression.decodeMeshAsync(e,o).then((function(e){var t=new u.Geometry(s.name,l._loader._babylonScene);return e.applyToGeometry(t),t})).catch((function(e){throw new Error(a+": "+e.message)}))}))),r._dracoBabylonGeometry}))},e})(c.GLTFLoaderExtension),e.KHR_draco_mesh_compression=t,c.GLTFLoader._Register(n,(function(e){return new t(e)}))})(BABYLON||(BABYLON={}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(a){var e,t,r,n;e=a.GLTF2||(a.GLTF2={}),t=e.Extensions||(e.Extensions={}),r="KHR_materials_pbrSpecularGlossiness",n=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=r,e}return __extends(e,t),e.prototype._loadMaterialPropertiesAsync=function(n,o,a){var i=this;return this._loadExtensionAsync(n,o,(function(e,t){var r=new Array;return r.push(i._loader._loadMaterialBasePropertiesAsync(n,o,a)),r.push(i._loadSpecularGlossinessPropertiesAsync(e,o,t,a)),Promise.all(r).then((function(){}))}))},e.prototype._loadSpecularGlossinessPropertiesAsync=function(e,t,r,n){var o=new Array;return r.diffuseFactor?(n.albedoColor=a.Color3.FromArray(r.diffuseFactor),n.alpha=r.diffuseFactor[3]):n.albedoColor=a.Color3.White(),n.reflectivityColor=r.specularFactor?a.Color3.FromArray(r.specularFactor):a.Color3.White(),n.microSurface=null==r.glossinessFactor?1:r.glossinessFactor,r.diffuseTexture&&o.push(this._loader._loadTextureInfoAsync(e+"/diffuseTexture",r.diffuseTexture,(function(e){n.albedoTexture=e}))),r.specularGlossinessTexture&&(o.push(this._loader._loadTextureInfoAsync(e+"/specularGlossinessTexture",r.specularGlossinessTexture,(function(e){n.reflectivityTexture=e}))),n.reflectivityTexture.hasAlpha=!0,n.useMicroSurfaceFromReflectivityMapAlpha=!0),this._loader._loadMaterialAlphaProperties(e,t,n),Promise.all(o).then((function(){}))},e})(e.GLTFLoaderExtension),t.KHR_materials_pbrSpecularGlossiness=n,e.GLTFLoader._Register(r,(function(e){return new n(e)}))})(BABYLON||(BABYLON={}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(a){var e,t,r,n;e=a.GLTF2||(a.GLTF2={}),t=e.Extensions||(e.Extensions={}),r="KHR_materials_unlit",n=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=r,e}return __extends(e,t),e.prototype._loadMaterialPropertiesAsync=function(e,t,r){var n=this;return this._loadExtensionAsync(e,t,(function(){return n._loadUnlitPropertiesAsync(e,t,r)}))},e.prototype._loadUnlitPropertiesAsync=function(e,t,r){var n=new Array;r.unlit=!0,r.metallic=1,r.roughness=1;var o=t.pbrMetallicRoughness;return o&&(o.baseColorFactor?(r.albedoColor=a.Color3.FromArray(o.baseColorFactor),r.alpha=o.baseColorFactor[3]):r.albedoColor=a.Color3.White(),o.baseColorTexture&&n.push(this._loader._loadTextureInfoAsync(e+"/baseColorTexture",o.baseColorTexture,(function(e){r.albedoTexture=e})))),t.doubleSided&&(r.backFaceCulling=!1,r.twoSidedLighting=!0),this._loader._loadMaterialAlphaProperties(e,t,r),Promise.all(n).then((function(){}))},e})(e.GLTFLoaderExtension),t.KHR_materials_unlit=n,e.GLTFLoader._Register(r,(function(e){return new n(e)}))})(BABYLON||(BABYLON={}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(c){var _;(function(e){var u,t,r="KHR_lights";(t=u||(u={})).AMBIENT="ambient",t.DIRECTIONAL="directional",t.POINT="point",t.SPOT="spot";var n=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=r,e}return __extends(e,t),e.prototype._onLoading=function(){var e=this._loader._gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},e.prototype._loadSceneAsync=function(e,o){var a=this;return this._loadExtensionAsync(e,o,(function(e,t){var r=a._loader._loadSceneAsync(e,o),n=_.GLTFLoader._GetProperty(e,a._lights,t.light);if(n.type!==u.AMBIENT)throw new Error(e+": Only ambient lights are allowed on a scene");return a._loader._babylonScene.ambientColor=n.color?c.Color3.FromArray(n.color):c.Color3.Black(),r}))},e.prototype._loadNodeAsync=function(e,s){var l=this;return this._loadExtensionAsync(e,s,(function(e,t){var r,n=l._loader._loadNodeAsync(e,s),o=_.GLTFLoader._GetProperty(e,l._lights,t.light),a=s._babylonMesh.name;switch(o.type){case u.AMBIENT:throw new Error(e+": Ambient lights are not allowed on a node");case u.DIRECTIONAL:r=new c.DirectionalLight(a,c.Vector3.Forward(),l._loader._babylonScene);break;case u.POINT:r=new c.PointLight(a,c.Vector3.Zero(),l._loader._babylonScene);break;case u.SPOT:var i=o.spot&&o.spot.outerConeAngle||Math.PI/4;r=new c.SpotLight(a,c.Vector3.Zero(),c.Vector3.Forward(),i,2,l._loader._babylonScene);break;default:throw new Error(e+": Invalid light type ("+o.type+")")}return r.diffuse=o.color?c.Color3.FromArray(o.color):c.Color3.White(),r.intensity=null==o.intensity?1:o.intensity,r.parent=s._babylonMesh,n}))},e})(_.GLTFLoaderExtension);e.KHR_lights=n,_.GLTFLoader._Register(r,(function(e){return new n(e)}))})((_=c.GLTF2||(c.GLTF2={})).Extensions||(_.Extensions={}))})(BABYLON||(BABYLON={}));__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(e){var t,r,n,o;t=e.GLTF2||(e.GLTF2={}),r=t.Extensions||(t.Extensions={}),n="KHR_texture_transform",o=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=n,e}return __extends(e,t),e.prototype._loadTextureInfoAsync=function(r,n,o){var a=this;return this._loadExtensionAsync(r,n,(function(e,t){return a._loader._loadTextureInfoAsync(r,n,(function(e){t.offset&&(e.uOffset=t.offset[0],e.vOffset=t.offset[1]),e.uRotationCenter=0,e.vRotationCenter=0,t.rotation&&(e.wAng=-t.rotation),t.scale&&(e.uScale=t.scale[0],e.vScale=t.scale[1]),null!=t.texCoord&&(e.coordinatesIndex=t.texCoord),o(e)}))}))},e})(t.GLTFLoaderExtension),r.KHR_texture_transform=o,t.GLTFLoader._Register(n,(function(e){return new o(e)}))})(BABYLON||(BABYLON={}));var BABYLON;__extends=this&&this.__extends||(function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])};return function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}})();!(function(_){var d,e,r,t;d=_.GLTF2||(_.GLTF2={}),e=d.Extensions||(d.Extensions={}),r="EXT_lights_imageBased",t=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=r,e}return __extends(e,t),e.prototype._onLoading=function(){var e=this._loader._gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},e.prototype._loadSceneAsync=function(o,a){var i=this;return this._loadExtensionAsync(o,a,(function(e,t){var r=new Array;r.push(i._loader._loadSceneAsync(o,a)),i._loader._parent._logOpen(""+e);var n=d.GLTFLoader._GetProperty(e+"/light",i._lights,t.light);return r.push(i._loadLightAsync("#/extensions/"+i.name+"/lights/"+t.light,n).then((function(e){i._loader._babylonScene.environmentTexture=e}))),i._loader._parent._logClose(),Promise.all(r).then((function(){}))}))},e.prototype._loadLightAsync=function(i,s){var a=this;if(!s._loaded){var l=new Array;this._loader._parent._logOpen(""+i);for(var u=new Array(s.specularImages.length),e=function(o){var a=s.specularImages[o];u[o]=new Array(a.length);for(var e=function(t){var e=i+"/specularImages/"+o+"/"+t;c._loader._parent._logOpen(""+e);var r=a[t],n=d.GLTFLoader._GetProperty(e,c._loader._gltf.images,r);l.push(c._loader._loadImageAsync("#/images/"+r,n).then((function(e){u[o][t]=e}))),c._loader._parent._logClose()},t=0;t<a.length;t++)e(t)},c=this,t=0;t<s.specularImages.length;t++)e(t);this._loader._parent._logClose(),s._loaded=Promise.all(l).then((function(){var e=new _.RawCubeTexture(a._loader._babylonScene,null,s.specularImageSize);if(s._babylonTexture=e,null!=s.intensity&&(e.level=s.intensity),s.rotation){var t=_.Quaternion.FromArray(s.rotation);a._loader._babylonScene.useRightHandedSystem||(t=_.Quaternion.Inverse(t)),_.Matrix.FromQuaternionToRef(t,e.getReflectionTextureMatrix())}var r=_.SphericalHarmonics.FromArray(s.irradianceCoefficients);r.scale(s.intensity),r.convertIrradianceToLambertianRadiance();var n=_.SphericalPolynomial.FromHarmonics(r),o=(u.length-1)/_.Scalar.Log2(s.specularImageSize);return e.updateRGBDAsync(u,n,o)}))}return s._loaded.then((function(){return s._babylonTexture}))},e})(d.GLTFLoaderExtension),e.EXT_lights_imageBased=t,d.GLTFLoader._Register(r,(function(e){return new t(e)}))})(BABYLON||(BABYLON={}));