{"version":3,"sources":["webpack://MATLIB/webpack/universalModuleDefinition","webpack://MATLIB/webpack/bootstrap","webpack://MATLIB/external {\"root\":\"BABYLON\",\"commonjs\":\"babylonjs\",\"commonjs2\":\"babylonjs\",\"amd\":\"babylonjs\"}","webpack://MATLIB/./src/index.ts","webpack://MATLIB/./src/legacy.ts","webpack://MATLIB/../Tools/Gulp/node_modules/webpack/buildin/global.js","webpack://MATLIB/./src/cell/index.ts","webpack://MATLIB/./src/cell/cellMaterial.ts","webpack://MATLIB/./src/cell/cell.fragment.fx","webpack://MATLIB/./src/cell/cell.vertex.fx","webpack://MATLIB/./src/custom/index.ts","webpack://MATLIB/./src/custom/customMaterial.ts","webpack://MATLIB/./src/fire/index.ts","webpack://MATLIB/./src/fire/fireMaterial.ts","webpack://MATLIB/./src/fire/fire.fragment.fx","webpack://MATLIB/./src/fire/fire.vertex.fx","webpack://MATLIB/./src/fur/index.ts","webpack://MATLIB/./src/fur/furMaterial.ts","webpack://MATLIB/./src/fur/fur.fragment.fx","webpack://MATLIB/./src/fur/fur.vertex.fx","webpack://MATLIB/./src/gradient/index.ts","webpack://MATLIB/./src/gradient/gradientMaterial.ts","webpack://MATLIB/./src/gradient/gradient.fragment.fx","webpack://MATLIB/./src/gradient/gradient.vertex.fx","webpack://MATLIB/./src/grid/index.ts","webpack://MATLIB/./src/grid/gridMaterial.ts","webpack://MATLIB/./src/grid/grid.fragment.fx","webpack://MATLIB/./src/grid/grid.vertex.fx","webpack://MATLIB/./src/lava/index.ts","webpack://MATLIB/./src/lava/lavaMaterial.ts","webpack://MATLIB/./src/lava/lava.fragment.fx","webpack://MATLIB/./src/lava/lava.vertex.fx","webpack://MATLIB/./src/mix/index.ts","webpack://MATLIB/./src/mix/mixMaterial.ts","webpack://MATLIB/./src/mix/mix.fragment.fx","webpack://MATLIB/./src/mix/mix.vertex.fx","webpack://MATLIB/./src/normal/index.ts","webpack://MATLIB/./src/normal/normalMaterial.ts","webpack://MATLIB/./src/normal/normal.fragment.fx","webpack://MATLIB/./src/normal/normal.vertex.fx","webpack://MATLIB/./src/shadowOnly/index.ts","webpack://MATLIB/./src/shadowOnly/shadowOnlyMaterial.ts","webpack://MATLIB/./src/shadowOnly/shadowOnly.fragment.fx","webpack://MATLIB/./src/shadowOnly/shadowOnly.vertex.fx","webpack://MATLIB/./src/simple/index.ts","webpack://MATLIB/./src/simple/simpleMaterial.ts","webpack://MATLIB/./src/simple/simple.fragment.fx","webpack://MATLIB/./src/simple/simple.vertex.fx","webpack://MATLIB/./src/sky/index.ts","webpack://MATLIB/./src/sky/skyMaterial.ts","webpack://MATLIB/./src/sky/sky.fragment.fx","webpack://MATLIB/./src/sky/sky.vertex.fx","webpack://MATLIB/./src/terrain/index.ts","webpack://MATLIB/./src/terrain/terrainMaterial.ts","webpack://MATLIB/./src/terrain/terrain.fragment.fx","webpack://MATLIB/./src/terrain/terrain.vertex.fx","webpack://MATLIB/./src/triPlanar/index.ts","webpack://MATLIB/./src/triPlanar/triPlanarMaterial.ts","webpack://MATLIB/./src/triPlanar/triPlanar.fragment.fx","webpack://MATLIB/./src/triPlanar/triPlanar.vertex.fx","webpack://MATLIB/./src/water/index.ts","webpack://MATLIB/./src/water/waterMaterial.ts","webpack://MATLIB/./src/water/water.fragment.fx","webpack://MATLIB/./src/water/water.vertex.fx"],"names":["root","factory","exports","module","require","define","amd","window","__WEBPACK_EXTERNAL_MODULE__0__","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","__export","MatLib","globalObject","global","undefined","mat","BABYLON","g","this","Function","eval","e","babylonjs_1","Effect","ShadersStore","CellMaterialDefines","_super","_this","DIFFUSE","CLIPPLANE","CLIPPLANE2","CLIPPLANE3","CLIPPLANE4","ALPHATEST","POINTSIZE","FOG","NORMAL","UV1","UV2","VERTEXCOLOR","VERTEXALPHA","NUM_BONE_INFLUENCERS","BonesPerMesh","INSTANCES","NDOTL","CUSTOMUSERLIGHTING","CELLBASIC","DEPTHPREPASS","rebuild","__extends","MaterialDefines","CellMaterial","scene","diffuseColor","Color3","_computeHighLevel","_disableLighting","_maxSimultaneousLights","needAlphaBlending","alpha","needAlphaTesting","getAlphaTestTexture","isReadyForSubMesh","mesh","subMesh","useInstances","isFrozen","_wasPreviouslyReady","effect","_materialDefines","defines","getScene","checkReadyOnEveryCall","_renderId","getRenderId","engine","getEngine","_areTexturesDirty","_needUVs","texturesEnabled","_diffuseTexture","StandardMaterial","DiffuseTextureEnabled","isReady","computeHighLevel","MaterialHelper","PrepareDefinesForMisc","pointsCloud","fogEnabled","_shouldTurnAlphaTestOn","_needNormals","PrepareDefinesForLights","PrepareDefinesForFrameBoundValues","PrepareDefinesForAttributes","isDirty","markAsProcessed","resetCachedMaterial","fallbacks","EffectFallbacks","addFallback","HandleFallbacksForShadows","maxSimultaneousLights","addCPUSkinningFallback","attribs","VertexBuffer","PositionKind","push","NormalKind","UVKind","UV2Kind","ColorKind","PrepareAttributesForBones","PrepareAttributesForInstances","join","toString","uniforms","samplers","uniformBuffers","Array","PrepareUniformsAndSamplersList","uniformsNames","uniformBuffersNames","setEffect","createEffect","attributes","onCompiled","onError","indexParameters","bindForSubMesh","world","_activeEffect","bindOnlyWorldMatrix","setMatrix","getTransformMatrix","BindBonesParameters","_mustRebind","setTexture","setFloat2","coordinatesIndex","level","getTextureMatrix","BindClipPlane","setFloat","pointSize","BindEyePosition","setColor4","visibility","lightsEnabled","disableLighting","BindLights","applyFog","fogMode","Scene","FOGMODE_NONE","getViewMatrix","console","log","BindFogParameters","_afterBind","getAnimatables","results","animations","length","getActiveTextures","activeTextures","hasTexture","texture","dispose","forceDisposeEffect","getClassName","clone","SerializationHelper","Clone","serialize","serializationObject","Serialize","customType","Parse","source","rootUrl","__decorate","serializeAsTexture","expandToProperty","serializeAsColor3","PushMaterial","CustomShaderStructure","ShaderSpecialParts","CustomMaterial","CustomParts","customShaderNameResolve","Builder","FragmentShader","VertexShader","AttachAfterBind","el","_newUniformInstances","ea","split","setVector2","setVector3","setVector4","_newSamplerInstances","ReviewUniform","arr","ind","_newUniforms","_customUniform","indexOf","shaderName","_isCreatedShader","_createdShaderName","ShaderIndexer","fn_afterBind","replace","Vertex_Begin","Vertex_Definitions","Vertex_MainBegin","Vertex_Before_PositionUpdated","Vertex_Before_NormalUpdated","Fragment_Begin","Fragment_MainBegin","Fragment_Definitions","Fragment_Custom_Diffuse","Fragment_Custom_Alpha","Fragment_Before_FragColor","AddUniform","kind","param","shaderPart","FireMaterialDefines","FireMaterial","speed","_scaledDiffuse","_lastTime","_opacityTexture","_areMiscDirty","forcePointsCloud","transformFeedbackVaryings","_distortionTexture","getDeltaTime","asArray","material","FromArray","id","Tags","AddTagsTo","tags","backFaceCulling","wireframe","Texture","checkReadyOnlyOnce","FurMaterialDefines","HEIGHTMAP","HIGHLEVEL","FurMaterial","furLength","furAngle","furColor","furOffset","furSpacing","furGravity","Vector3","furSpeed","furDensity","furOcclusion","highLevelFur","_furTime","furTime","updateFur","_meshes","offsetFur","diffuseTexture","furTexture","heightTexture","getCaps","maxVertexTextureImageUnits","markAsUnprocessed","getCachedMaterial","_heightTexture","sourceMeshName","quality","executeWhenReady","sourceMesh","getMeshByName","GenerateTexture","FurifyMesh","DynamicTexture","context","getContext","fillStyle","Math","floor","random","fillRect","getSize","width","height","update","wrapU","WRAP_ADDRESSMODE","wrapV","meshes","materials","pop","EnableFor","offsetMesh","skeleton","position","Zero","parent","serializeAsVector3","GradientMaterialDefines","LIGHT0","LIGHT1","LIGHT2","LIGHT3","SPOTLIGHT0","SPOTLIGHT1","SPOTLIGHT2","SPOTLIGHT3","HEMILIGHT0","HEMILIGHT1","HEMILIGHT2","HEMILIGHT3","DIRLIGHT0","DIRLIGHT1","DIRLIGHT2","DIRLIGHT3","POINTLIGHT0","POINTLIGHT1","POINTLIGHT2","POINTLIGHT3","SHADOW0","SHADOW1","SHADOW2","SHADOW3","SHADOWS","SHADOWESM0","SHADOWESM1","SHADOWESM2","SHADOWESM3","SHADOWPOISSON0","SHADOWPOISSON1","SHADOWPOISSON2","SHADOWPOISSON3","SHADOWPCF0","SHADOWPCF1","SHADOWPCF2","SHADOWPCF3","SHADOWPCSS0","SHADOWPCSS1","SHADOWPCSS2","SHADOWPCSS3","GradientMaterial","topColor","topColorAlpha","bottomColor","bottomColorAlpha","offset","scale","smoothness","GridMaterialDefines","TRANSPARENT","PREMULTIPLYALPHA","GridMaterial","mainColor","Black","lineColor","Teal","gridRatio","gridOffset","majorUnitFrequency","minorUnitVisibility","opacity","preMultiplyAlpha","_gridControl","Vector4","needAlphaBlendingForMesh","multiply","getProjectionMatrix","setColor3","x","y","round","z","w","LavaMaterialDefines","UNLIT","LavaMaterial","movingSpeed","lowFrequencySpeed","fogDensity","_unlit","noiseTexture","fogColor","MixMaterialDefines","SPECULARTERM","MIXMAP2","MixMaterial","specularColor","specularPower","_mixTexture1","_mixTexture2","_diffuseTexture1","uScale","vScale","_diffuseTexture2","_diffuseTexture3","_diffuseTexture4","_diffuseTexture5","_diffuseTexture6","_diffuseTexture7","_diffuseTexture8","NormalMaterialDefines","NormalMaterial","ShadowOnlyMaterialDefines","ShadowOnlyMaterial","shadowColor","_activeLight","light","_i","_a","_lightSources","shadowEnabled","lightPosition","splice","SimpleMaterialDefines","SimpleMaterial","SkyMaterialDefines","SkyMaterial","luminance","turbidity","rayleigh","mieCoefficient","mieDirectionalG","distance","inclination","azimuth","sunPosition","useSunPosition","_cameraPosition","camera","activeCamera","cameraWorldMatrix","getWorldMatrix","theta","PI","phi","cos","sin","TerrainMaterialDefines","BUMP","TerrainMaterial","mixTexture","bumpTexture1","bumpTexture2","bumpTexture3","BumpTextureEnabled","_mixTexture","standardDerivatives","_bumpTexture1","_bumpTexture2","_bumpTexture3","TriPlanarMaterialDefines","DIFFUSEX","DIFFUSEY","DIFFUSEZ","BUMPX","BUMPY","BUMPZ","TriPlanarMaterial","tileSize","textures","diffuseTextureX","diffuseTextureY","diffuseTextureZ","textureDefines","normalTextureX","normalTextureY","normalTextureZ","_diffuseTextureX","_diffuseTextureY","_diffuseTextureZ","_normalTextureX","_normalTextureY","_normalTextureZ","WaterMaterialDefines","REFLECTION","LOGARITHMICDEPTH","FRESNELSEPARATE","BUMPSUPERIMPOSE","BUMPAFFECTSREFLECTION","WaterMaterial","renderTargetSize","Vector2","windForce","windDirection","waveHeight","bumpHeight","_bumpSuperimpose","_fresnelSeparate","_bumpAffectsReflection","waterColor","colorBlendFactor","waterColor2","colorBlendFactor2","waveLength","waveSpeed","_renderTargets","SmartArray","_mesh","_reflectionTransform","Matrix","_lastDeltaTime","_createRenderTargets","getRenderTargetTextures","reset","_reflectionRTT","_refractionRTT","_useLogarithmicDepth","fragmentDepthSupported","_markAllSubMeshesAsMiscDirty","addToRenderList","node","renderList","enableRenderTargets","enable","refreshRate","getRenderList","bumpTexture","ReflectionTextureEnabled","_waitingRenderList","getNodeByID","BindLogDepth","wrvp","deltaTime","isVisible","RenderTargetTexture","MIRROR_ADDRESSMODE","ignoreCameraViewport","savedViewMatrix","clipPlane","mirrorMatrix","onBeforeRender","positiony","Plane","FromPositionAndNormal","onAfterRender","ReflectionToRef","multiplyToRef","setTransformMatrix","cullBackFaces","_mirroredCameraPosition","TransformCoordinates","_bumpTexture","index","customRenderTargets","CreateDefaultMesh","Mesh","CreateGround","serializeAsVector2"],"mappings":"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","file":"babylon.materials.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"babylonjs\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine(\"babylonjs-materials\", [\"babylonjs\"], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"babylonjs-materials\"] = factory(require(\"babylonjs\"));\n\telse\n\t\troot[\"MATLIB\"] = factory(root[\"BABYLON\"]);\n})(window, function(__WEBPACK_EXTERNAL_MODULE__0__) {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","module.exports = __WEBPACK_EXTERNAL_MODULE__0__;","export * from \"./cell\";\r\nexport * from \"./custom\";\r\nexport * from \"./fire\";\r\nexport * from \"./fur\";\r\nexport * from \"./gradient\";\r\nexport * from \"./grid\";\r\nexport * from \"./lava\";\r\nexport * from \"./mix\";\r\nexport * from \"./normal\";\r\nexport * from \"./shadowOnly\";\r\nexport * from \"./simple\";\r\nexport * from \"./sky\";\r\nexport * from \"./terrain\";\r\nexport * from \"./triPlanar\";\r\nexport * from \"./water\";","import * as MatLib from \"./index\";\r\n\r\n/**\r\n * Legacy support, defining window.BABYLON.GridMaterial... (global variable).\r\n *\r\n * This is the entry point for the UMD module.\r\n * The entry point for a future ESM package should be index.ts\r\n */\r\nvar globalObject = (typeof global !== 'undefined') ? global : ((typeof window !== 'undefined') ? window : undefined);\r\nif (typeof globalObject !== \"undefined\") {\r\n    (<any>globalObject).BABYLON = (<any>globalObject).BABYLON || {};\r\n    for (var mat in MatLib) {\r\n        if (MatLib.hasOwnProperty(mat)) {\r\n            (<any>globalObject).BABYLON[mat] = (<any>MatLib)[mat];\r\n        }\r\n    }\r\n}\r\n\r\nexport * from \"./index\";","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","export * from \"./cellMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, expandToProperty, BaseTexture, serializeAsColor3, Scene, Color3, serialize, AbstractMesh, Nullable, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\"\r\n\r\nEffect.ShadersStore[\"cellPixelShader\"] = require(\"./cell.fragment.fx\");\r\nEffect.ShadersStore[\"cellVertexShader\"] = require(\"./cell.vertex.fx\");\r\n\r\nclass CellMaterialDefines extends MaterialDefines {\r\n    public DIFFUSE = false;\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public NORMAL = false;\r\n    public UV1 = false;\r\n    public UV2 = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n    public NDOTL = true;\r\n    public CUSTOMUSERLIGHTING = true;\r\n    public CELLBASIC = true;\r\n    public DEPTHPREPASS = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class CellMaterial extends PushMaterial {\r\n    @serializeAsTexture(\"diffuseTexture\")\r\n    private _diffuseTexture: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture: BaseTexture;\r\n\r\n    @serializeAsColor3(\"diffuse\")\r\n    public diffuseColor = new Color3(1, 1, 1);\r\n\r\n    @serialize(\"computeHighLevel\")\r\n    public _computeHighLevel: boolean = false;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public computeHighLevel: boolean;\r\n\r\n    @serialize(\"disableLighting\")\r\n    private _disableLighting = false;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public disableLighting: boolean;\r\n\r\n    @serialize(\"maxSimultaneousLights\")\r\n    private _maxSimultaneousLights = 4;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public maxSimultaneousLights: number;\r\n\r\n    private _renderId: number;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new CellMaterialDefines();\r\n        }\r\n\r\n        var defines = <CellMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Textures\r\n        if (defines._areTexturesDirty) {\r\n            defines._needUVs = false;\r\n            if (scene.texturesEnabled) {\r\n                if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                    if (!this._diffuseTexture.isReady()) {\r\n                        return false;\r\n                    } else {\r\n                        defines._needUVs = true;\r\n                        defines.DIFFUSE = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // High level\r\n        defines.CELLBASIC = !this.computeHighLevel;\r\n\r\n        // Misc.\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        // Lights\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights, this._disableLighting);\r\n\r\n        // Values that need to be evaluated on every frame\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, this.maxSimultaneousLights);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            if (defines.UV1) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n            }\r\n\r\n            if (defines.UV2) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            var shaderName = \"cell\";\r\n            var join = defines.toString();\r\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                \"vDiffuseInfos\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"diffuseMatrix\"\r\n            ];\r\n            var samplers = [\"diffuseSampler\"];\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: this.maxSimultaneousLights\r\n            });\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights - 1 }\r\n                }, engine), defines);\r\n\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <CellMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n            // Textures\r\n            if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                this._activeEffect.setTexture(\"diffuseSampler\", this._diffuseTexture);\r\n\r\n                this._activeEffect.setFloat2(\"vDiffuseInfos\", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level);\r\n                this._activeEffect.setMatrix(\"diffuseMatrix\", this._diffuseTexture.getTextureMatrix());\r\n            }\r\n\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this.diffuseColor, this.alpha * mesh.visibility);\r\n\r\n        // Lights\r\n        if (scene.lightsEnabled && !this.disableLighting) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, this._maxSimultaneousLights);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        console.log(\"TOTO\")\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        var results = [];\r\n\r\n        if (this._diffuseTexture && this._diffuseTexture.animations && this._diffuseTexture.animations.length > 0) {\r\n            results.push(this._diffuseTexture);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    public getActiveTextures(): BaseTexture[] {\r\n        var activeTextures = super.getActiveTextures();\r\n\r\n        if (this._diffuseTexture) {\r\n            activeTextures.push(this._diffuseTexture);\r\n        }\r\n\r\n        return activeTextures;\r\n    }\r\n\r\n    public hasTexture(texture: BaseTexture): boolean {\r\n        if (super.hasTexture(texture)) {\r\n            return true;\r\n        }\r\n\r\n        return this._diffuseTexture === texture;\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        if (this._diffuseTexture) {\r\n            this._diffuseTexture.dispose();\r\n        }\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"CellMaterial\";\r\n    }\r\n\r\n    public clone(name: string): CellMaterial {\r\n        return SerializationHelper.Clone<CellMaterial>(() => new CellMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.CellMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): CellMaterial {\r\n        return SerializationHelper.Parse(() => new CellMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform sampler2D diffuseSampler;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\n\\nvec3 computeCustomDiffuseLighting(lightingInfo info,vec3 diffuseBase,float shadow)\\n{\\ndiffuseBase=info.diffuse*shadow;\\n#ifdef CELLBASIC\\nfloat level=1.0;\\nif (info.ndl<0.5)\\nlevel=0.5;\\ndiffuseBase.rgb*vec3(level,level,level);\\n#else\\nfloat ToonThresholds[4];\\nToonThresholds[0]=0.95;\\nToonThresholds[1]=0.5;\\nToonThresholds[2]=0.2;\\nToonThresholds[3]=0.03;\\nfloat ToonBrightnessLevels[5];\\nToonBrightnessLevels[0]=1.0;\\nToonBrightnessLevels[1]=0.8;\\nToonBrightnessLevels[2]=0.6;\\nToonBrightnessLevels[3]=0.35;\\nToonBrightnessLevels[4]=0.2;\\nif (info.ndl>ToonThresholds[0])\\n{\\ndiffuseBase.rgb*=ToonBrightnessLevels[0];\\n}\\nelse if (info.ndl>ToonThresholds[1])\\n{\\ndiffuseBase.rgb*=ToonBrightnessLevels[1];\\n}\\nelse if (info.ndl>ToonThresholds[2])\\n{\\ndiffuseBase.rgb*=ToonBrightnessLevels[2];\\n}\\nelse if (info.ndl>ToonThresholds[3])\\n{\\ndiffuseBase.rgb*=ToonBrightnessLevels[3];\\n}\\nelse\\n{\\ndiffuseBase.rgb*=ToonBrightnessLevels[4];\\n}\\n#endif\\nreturn max(diffuseBase,vec3(0.2));\\n}\\nvoid main(void)\\n{\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=vec4(1.,1.,1.,1.);\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n\\nfloat alpha=vDiffuseColor.a;\\n#ifdef DIFFUSE\\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\nbaseColor.rgb*=vDiffuseInfos.y;\\n#endif\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n\\nlightingInfo info;\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nfloat shadow=1.;\\nfloat glossiness=0.;\\n#ifdef SPECULARTERM\\nvec3 specularBase=vec3(0.,0.,0.);\\n#endif \\n#include<lightFragment>[0..maxSimultaneousLights]\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\\n\\nvec4 color=vec4(finalDiffuse,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform mat4 diffuseMatrix;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef DIFFUSE\\nif (vDiffuseInfos.x == 0.)\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\\n}\\nelse\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\\n}\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./customMaterial\";","import { StandardMaterial, Texture, Mesh, Effect, StandardMaterialDefines, Scene } from \"babylonjs\";\n\nexport class CustomShaderStructure {\n\n    public FragmentStore: string;\n    public VertexStore: string;\n\n    constructor() { }\n}\n\nexport class ShaderSpecialParts {\n\n    constructor() { }\n\n    public Fragment_Begin: string;\n    public Fragment_Definitions: string;\n    public Fragment_MainBegin: string;\n\n    // diffuseColor\n    public Fragment_Custom_Diffuse: string;\n\n    // alpha\n    public Fragment_Custom_Alpha: string;\n\n    public Fragment_Before_FragColor: string;\n\n    public Vertex_Begin: string;\n    public Vertex_Definitions: string;\n    public Vertex_MainBegin: string;\n\n    // positionUpdated\n    public Vertex_Before_PositionUpdated: string;\n\n    // normalUpdated\n    public Vertex_Before_NormalUpdated: string;\n}\n\nexport class CustomMaterial extends StandardMaterial {\n    public static ShaderIndexer = 1;\n    public CustomParts: ShaderSpecialParts;\n    _isCreatedShader: boolean;\n    _createdShaderName: string;\n    _customUniform: string[];\n    _newUniforms: string[];\n    _newUniformInstances: any[];\n    _newSamplerInstances: Texture[];\n\n    public  FragmentShader : string ;\n    public  VertexShader : string ;\n\n    public AttachAfterBind(mesh: Mesh, effect: Effect) {\n        for (var el in this._newUniformInstances) {\n            var ea = el.toString().split('-');\n            if (ea[0] == 'vec2') {\n                effect.setVector2(ea[1], this._newUniformInstances[el]);\n            }\n            else if (ea[0] == 'vec3') {\n                effect.setVector3(ea[1], this._newUniformInstances[el]);\n            }\n            else if (ea[0] == 'vec4') {\n                effect.setVector4(ea[1], this._newUniformInstances[el]);\n            }\n            else if (ea[0] == 'mat4') {\n                effect.setMatrix(ea[1], this._newUniformInstances[el]);\n            }\n            else if (ea[0] == 'float') {\n                effect.setFloat(ea[1], this._newUniformInstances[el]);\n            }\n        }\n        for (var el in this._newSamplerInstances) {\n            var ea = el.toString().split('-');\n            if (ea[0] == 'sampler2D' && this._newSamplerInstances[el].isReady && this._newSamplerInstances[el].isReady()) {\n                effect.setTexture(ea[1], this._newSamplerInstances[el]);\n            }\n        }\n    }\n\n    public ReviewUniform(name: string, arr: string[]): string[] {\n        if (name == \"uniform\") {\n            for (var ind in this._newUniforms) {\n                if (this._customUniform[ind].indexOf('sampler') == -1) {\n                    arr.push(this._newUniforms[ind]);\n                }\n            }\n        }\n        if (name == \"sampler\") {\n            for (var ind in this._newUniforms) {\n                if (this._customUniform[ind].indexOf('sampler') != -1) {\n                    arr.push(this._newUniforms[ind]);\n                }\n            }\n        }\n        return arr;\n    }\n\n    public Builder(shaderName: string, uniforms: string[], uniformBuffers: string[], samplers: string[], defines: StandardMaterialDefines): string {\n\n        if (this._isCreatedShader) {\n            return this._createdShaderName;\n        }\n        this._isCreatedShader = false;\n\n        CustomMaterial.ShaderIndexer++;\n        var name: string = \"custom_\" + CustomMaterial.ShaderIndexer;\n\n        this.ReviewUniform(\"uniform\", uniforms);\n        this.ReviewUniform(\"sampler\", samplers);\n\n        var fn_afterBind = this._afterBind.bind(this);\n        this._afterBind = (m, e) => {\n            if (!e) {\n                return;\n            }\n            this.AttachAfterBind(m, e);\n            try { fn_afterBind(m, e); }\n            catch (e) { }\n        };\n\n        BABYLON.Effect.ShadersStore[name + \"VertexShader\"] = this.VertexShader\n            .replace('#define CUSTOM_VERTEX_BEGIN', (this.CustomParts.Vertex_Begin ? this.CustomParts.Vertex_Begin : \"\"))\n            .replace('#define CUSTOM_VERTEX_DEFINITIONS', (this._customUniform ? this._customUniform.join(\"\\n\") : \"\") + (this.CustomParts.Vertex_Definitions ? this.CustomParts.Vertex_Definitions : \"\"))\n            .replace('#define CUSTOM_VERTEX_MAIN_BEGIN', (this.CustomParts.Vertex_MainBegin ? this.CustomParts.Vertex_MainBegin : \"\"))\n            .replace('#define CUSTOM_VERTEX_UPDATE_POSITION', (this.CustomParts.Vertex_Before_PositionUpdated ? this.CustomParts.Vertex_Before_PositionUpdated : \"\"))\n            .replace('#define CUSTOM_VERTEX_UPDATE_NORMAL', (this.CustomParts.Vertex_Before_NormalUpdated ? this.CustomParts.Vertex_Before_NormalUpdated : \"\"));\n\n            // #define CUSTOM_VERTEX_MAIN_END\n\n        BABYLON.Effect.ShadersStore[name + \"PixelShader\"] = this.FragmentShader\n            .replace('#define CUSTOM_FRAGMENT_BEGIN', (this.CustomParts.Fragment_Begin ? this.CustomParts.Fragment_Begin : \"\"))\n            .replace('#define CUSTOM_FRAGMENT_MAIN_BEGIN', (this.CustomParts.Fragment_MainBegin ? this.CustomParts.Fragment_MainBegin : \"\"))\n            .replace('#define CUSTOM_FRAGMENT_DEFINITIONS', (this._customUniform ? this._customUniform.join(\"\\n\") : \"\") + (this.CustomParts.Fragment_Definitions ? this.CustomParts.Fragment_Definitions : \"\"))\n            .replace('#define CUSTOM_FRAGMENT_UPDATE_DIFFUSE', (this.CustomParts.Fragment_Custom_Diffuse ? this.CustomParts.Fragment_Custom_Diffuse : \"\"))\n            .replace('#define CUSTOM_FRAGMENT_UPDATE_ALPHA', (this.CustomParts.Fragment_Custom_Alpha ? this.CustomParts.Fragment_Custom_Alpha : \"\"))\n            .replace('#define CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR', (this.CustomParts.Fragment_Before_FragColor ? this.CustomParts.Fragment_Before_FragColor : \"\"));\n\n            // #define CUSTOM_FRAGMENT_BEFORE_LIGHTS\n\n            // #define CUSTOM_FRAGMENT_BEFORE_FOG\n\n        this._isCreatedShader = true;\n        this._createdShaderName = name;\n\n        return name;\n    }\n\n    constructor(name: string, scene: Scene) {\n        super(name, scene);\n        this.CustomParts = new ShaderSpecialParts();\n        this.customShaderNameResolve = this.Builder;\n\n        this.FragmentShader = BABYLON.Effect.ShadersStore[\"defaultPixelShader\"];\n        this.VertexShader = BABYLON.Effect.ShadersStore[\"defaultVertexShader\"];\n    }\n\n    public AddUniform(name: string, kind: string, param: any): CustomMaterial {\n        if (!this._customUniform) {\n            this._customUniform = new Array();\n            this._newUniforms = new Array();\n            this._newSamplerInstances = new Array();\n            this._newUniformInstances = new Array();\n        }\n        if (param) {\n            if (kind.indexOf(\"sampler\") == -1) {\n                (<any>this._newUniformInstances)[kind + \"-\" + name] = param;\n            }\n            else {\n                (<any>this._newUniformInstances)[kind + \"-\" + name] = param;\n            }\n        }\n        this._customUniform.push(\"uniform \" + kind + \" \" + name + \";\");\n        this._newUniforms.push(name);\n\n        return this;\n    }\n\n    public Fragment_Begin(shaderPart: string): CustomMaterial {\n        this.CustomParts.Fragment_Begin = shaderPart;\n        return this;\n    }\n\n    public Fragment_Definitions(shaderPart: string): CustomMaterial {\n        this.CustomParts.Fragment_Definitions = shaderPart;\n        return this;\n    }\n\n    public Fragment_MainBegin(shaderPart: string): CustomMaterial {\n        this.CustomParts.Fragment_MainBegin = shaderPart;\n        return this;\n    }\n\n    public Fragment_Custom_Diffuse(shaderPart: string): CustomMaterial {\n        this.CustomParts.Fragment_Custom_Diffuse = shaderPart.replace(\"result\", \"diffuseColor\");\n        return this;\n    }\n\n    public Fragment_Custom_Alpha(shaderPart: string): CustomMaterial {\n        this.CustomParts.Fragment_Custom_Alpha = shaderPart.replace(\"result\", \"alpha\");\n        return this;\n    }\n\n    public Fragment_Before_FragColor(shaderPart: string): CustomMaterial {\n        this.CustomParts.Fragment_Before_FragColor = shaderPart.replace(\"result\", \"color\");\n        return this;\n    }\n\n    public Vertex_Begin(shaderPart: string): CustomMaterial {\n        this.CustomParts.Vertex_Begin = shaderPart;\n        return this;\n    }\n\n    public Vertex_Definitions(shaderPart: string): CustomMaterial {\n        this.CustomParts.Vertex_Definitions = shaderPart;\n        return this;\n    }\n\n    public Vertex_MainBegin(shaderPart: string): CustomMaterial {\n        this.CustomParts.Vertex_MainBegin = shaderPart;\n        return this;\n    }\n\n    public Vertex_Before_PositionUpdated(shaderPart: string): CustomMaterial {\n        this.CustomParts.Vertex_Before_PositionUpdated = shaderPart.replace(\"result\", \"positionUpdated\");\n        return this;\n    }\n\n    public Vertex_Before_NormalUpdated(shaderPart: string): CustomMaterial {\n        this.CustomParts.Vertex_Before_NormalUpdated = shaderPart.replace(\"result\", \"normalUpdated\");\n        return this;\n    }\n}\n","export * from \"./fireMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, Nullable, BaseTexture, expandToProperty, serializeAsColor3, Color3, serialize, Scene, AbstractMesh, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, Matrix, Mesh, IAnimatable, SerializationHelper, Tags, Texture, } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"firePixelShader\"] = require(\"./fire.fragment.fx\");\r\nEffect.ShadersStore[\"fireVertexShader\"] = require(\"./fire.vertex.fx\");\r\n\r\nclass FireMaterialDefines extends MaterialDefines {\r\n    public DIFFUSE = false;\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public DEPTHPREPASS = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public UV1 = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public BonesPerMesh = 0;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public INSTANCES = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class FireMaterial extends PushMaterial {\r\n    @serializeAsTexture(\"diffuseTexture\")\r\n    private _diffuseTexture: Nullable<BaseTexture>;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture: Nullable<BaseTexture>;\r\n\r\n    @serializeAsTexture(\"distortionTexture\")\r\n    private _distortionTexture: Nullable<BaseTexture>;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public distortionTexture: Nullable<BaseTexture>;\r\n\r\n    @serializeAsTexture(\"opacityTexture\")\r\n    private _opacityTexture: Nullable<BaseTexture>;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public opacityTexture: Nullable<BaseTexture>;\r\n\r\n    @serializeAsColor3(\"diffuse\")\r\n    public diffuseColor = new Color3(1, 1, 1);\r\n\r\n    @serialize()\r\n    public speed = 1.0;\r\n\r\n    private _scaledDiffuse = new Color3();\r\n    private _renderId: number;\r\n    private _lastTime: number = 0;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new FireMaterialDefines();\r\n        }\r\n\r\n        var defines = <FireMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Textures\r\n        if (defines._areTexturesDirty) {\r\n            defines._needUVs = false;\r\n            if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                if (!this._diffuseTexture.isReady()) {\r\n                    return false;\r\n                } else {\r\n                    defines._needUVs = true;\r\n                    defines.DIFFUSE = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        defines.ALPHATEST = this._opacityTexture ? true : false;\r\n\r\n        // Misc.\r\n        if (defines._areMiscDirty) {\r\n            defines.POINTSIZE = (this.pointsCloud || scene.forcePointsCloud);\r\n            defines.FOG = (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE && this.fogEnabled);\r\n        }\r\n\r\n        // Values that need to be evaluated on every frame\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, false, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.UV1) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            // Legacy browser patch\r\n            var shaderName = \"fire\";\r\n\r\n            var join = defines.toString();\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                {\r\n                    attributes: attribs,\r\n                    uniformsNames: [\"world\", \"view\", \"viewProjection\", \"vEyePosition\",\r\n                        \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                        \"vDiffuseInfos\",\r\n                        \"mBones\",\r\n                        \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"diffuseMatrix\",\r\n                        // Fire\r\n                        \"time\", \"speed\"\r\n                    ],\r\n                    uniformBuffersNames: [],\r\n                    samplers: [\"diffuseSampler\",\r\n                        // Fire\r\n                        \"distortionSampler\", \"opacitySampler\"\r\n                    ],\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: null,\r\n                    maxSimultaneousLights: 4,\r\n                    transformFeedbackVaryings: null\r\n                }, engine), defines);\r\n        }\r\n\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <FireMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n            // Textures\r\n            if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                this._activeEffect.setTexture(\"diffuseSampler\", this._diffuseTexture);\r\n\r\n                this._activeEffect.setFloat2(\"vDiffuseInfos\", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level);\r\n                this._activeEffect.setMatrix(\"diffuseMatrix\", this._diffuseTexture.getTextureMatrix());\r\n\r\n                this._activeEffect.setTexture(\"distortionSampler\", this._distortionTexture);\r\n                this._activeEffect.setTexture(\"opacitySampler\", this._opacityTexture);\r\n            }\r\n\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this._scaledDiffuse, this.alpha * mesh.visibility);\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        // Time\r\n        this._lastTime += scene.getEngine().getDeltaTime();\r\n        this._activeEffect.setFloat(\"time\", this._lastTime);\r\n\r\n        // Speed\r\n        this._activeEffect.setFloat(\"speed\", this.speed);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        var results = [];\r\n\r\n        if (this._diffuseTexture && this._diffuseTexture.animations && this._diffuseTexture.animations.length > 0) {\r\n            results.push(this._diffuseTexture);\r\n        }\r\n        if (this._distortionTexture && this._distortionTexture.animations && this._distortionTexture.animations.length > 0) {\r\n            results.push(this._distortionTexture);\r\n        }\r\n        if (this._opacityTexture && this._opacityTexture.animations && this._opacityTexture.animations.length > 0) {\r\n            results.push(this._opacityTexture);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    public getActiveTextures(): BaseTexture[] {\r\n        var activeTextures = super.getActiveTextures();\r\n\r\n        if (this._diffuseTexture) {\r\n            activeTextures.push(this._diffuseTexture);\r\n        }\r\n\r\n        if (this._distortionTexture) {\r\n            activeTextures.push(this._distortionTexture);\r\n        }\r\n\r\n        if (this._opacityTexture) {\r\n            activeTextures.push(this._opacityTexture);\r\n        }\r\n\r\n        return activeTextures;\r\n    }\r\n\r\n    public hasTexture(texture: BaseTexture): boolean {\r\n        if (super.hasTexture(texture)) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._distortionTexture === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._opacityTexture === texture) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"FireMaterial\";\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        if (this._diffuseTexture) {\r\n            this._diffuseTexture.dispose();\r\n        }\r\n        if (this._distortionTexture) {\r\n            this._distortionTexture.dispose();\r\n        }\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): FireMaterial {\r\n        return SerializationHelper.Clone<FireMaterial>(() => new FireMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n\r\n        var serializationObject = super.serialize();\r\n        serializationObject.customType = \"BABYLON.FireMaterial\";\r\n        serializationObject.diffuseColor = this.diffuseColor.asArray();\r\n        serializationObject.speed = this.speed;\r\n\r\n        if (this._diffuseTexture) {\r\n            serializationObject._diffuseTexture = this._diffuseTexture.serialize();\r\n        }\r\n\r\n        if (this._distortionTexture) {\r\n            serializationObject._distortionTexture = this._distortionTexture.serialize();\r\n        }\r\n\r\n        if (this._opacityTexture) {\r\n            serializationObject._opacityTexture = this._opacityTexture.serialize();\r\n        }\r\n\r\n        return serializationObject;\r\n    }\r\n\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): FireMaterial {\r\n        var material = new FireMaterial(source.name, scene);\r\n\r\n        material.diffuseColor = Color3.FromArray(source.diffuseColor);\r\n        material.speed = source.speed;\r\n\r\n        material.alpha = source.alpha;\r\n\r\n        material.id = source.id;\r\n\r\n        Tags.AddTagsTo(material, source.tags);\r\n        material.backFaceCulling = source.backFaceCulling;\r\n        material.wireframe = source.wireframe;\r\n\r\n        if (source._diffuseTexture) {\r\n            material._diffuseTexture = Texture.Parse(source._diffuseTexture, scene, rootUrl);\r\n        }\r\n\r\n        if (source._distortionTexture) {\r\n            material._distortionTexture = Texture.Parse(source._distortionTexture, scene, rootUrl);\r\n        }\r\n\r\n        if (source._opacityTexture) {\r\n            material._opacityTexture = Texture.Parse(source._opacityTexture, scene, rootUrl);\r\n        }\r\n\r\n        if (source.checkReadyOnlyOnce) {\r\n            material.checkReadyOnlyOnce = source.checkReadyOnlyOnce;\r\n        }\r\n\r\n        return material;\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\n\\nvarying vec3 vPositionW;\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform sampler2D diffuseSampler;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n\\nuniform sampler2D distortionSampler;\\nuniform sampler2D opacitySampler;\\n#ifdef DIFFUSE\\nvarying vec2 vDistortionCoords1;\\nvarying vec2 vDistortionCoords2;\\nvarying vec2 vDistortionCoords3;\\n#endif\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\nvec4 bx2(vec4 x)\\n{\\nreturn vec4(2.0)*x-vec4(1.0);\\n}\\nvoid main(void) {\\n\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=vec4(1.,1.,1.,1.);\\n\\nfloat alpha=1.0;\\n#ifdef DIFFUSE\\n\\nconst float distortionAmount0=0.092;\\nconst float distortionAmount1=0.092;\\nconst float distortionAmount2=0.092;\\nvec2 heightAttenuation=vec2(0.3,0.39);\\nvec4 noise0=texture2D(distortionSampler,vDistortionCoords1);\\nvec4 noise1=texture2D(distortionSampler,vDistortionCoords2);\\nvec4 noise2=texture2D(distortionSampler,vDistortionCoords3);\\nvec4 noiseSum=bx2(noise0)*distortionAmount0+bx2(noise1)*distortionAmount1+bx2(noise2)*distortionAmount2;\\nvec4 perturbedBaseCoords=vec4(vDiffuseUV,0.0,1.0)+noiseSum*(vDiffuseUV.y*heightAttenuation.x+heightAttenuation.y);\\nvec4 opacityColor=texture2D(opacitySampler,perturbedBaseCoords.xy);\\n#ifdef ALPHATEST\\nif (opacityColor.r<0.1)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\nbaseColor=texture2D(diffuseSampler,perturbedBaseCoords.xy)*2.0;\\nbaseColor*=opacityColor;\\nbaseColor.rgb*=vDiffuseInfos.y;\\n#endif\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\nvec3 diffuseBase=vec3(1.0,1.0,1.0);\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\n\\nvec4 color=vec4(baseColor.rgb,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n\\nuniform float time;\\nuniform float speed;\\n#ifdef DIFFUSE\\nvarying vec2 vDistortionCoords1;\\nvarying vec2 vDistortionCoords2;\\nvarying vec2 vDistortionCoords3;\\n#endif\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n\\n#ifdef DIFFUSE\\nvDiffuseUV=uv;\\nvDiffuseUV.y-=0.2;\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n#ifdef DIFFUSE\\n\\nvec3 layerSpeed=vec3(-0.2,-0.52,-0.1)*speed;\\nvDistortionCoords1.x=uv.x;\\nvDistortionCoords1.y=uv.y+layerSpeed.x*time/1000.0;\\nvDistortionCoords2.x=uv.x;\\nvDistortionCoords2.y=uv.y+layerSpeed.y*time/1000.0;\\nvDistortionCoords3.x=uv.x;\\nvDistortionCoords3.y=uv.y+layerSpeed.z*time/1000.0;\\n#endif\\n}\\n\"","export * from \"./furMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, BaseTexture, expandToProperty, serializeAsColor3, Color3, serialize, serializeAsVector3, Vector3, DynamicTexture, AbstractMesh, Scene, Nullable, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper, Texture, Tags } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"furPixelShader\"] = require(\"./fur.fragment.fx\");\r\nEffect.ShadersStore[\"furVertexShader\"] = require(\"./fur.vertex.fx\");\r\n\r\nclass FurMaterialDefines extends MaterialDefines {\r\n    public DIFFUSE = false;\r\n    public HEIGHTMAP = false;\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public DEPTHPREPASS = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public NORMAL = false;\r\n    public UV1 = false;\r\n    public UV2 = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n    public HIGHLEVEL = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class FurMaterial extends PushMaterial {\r\n\r\n    @serializeAsTexture(\"diffuseTexture\")\r\n    private _diffuseTexture: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture: BaseTexture;\r\n\r\n    @serializeAsTexture(\"heightTexture\")\r\n    private _heightTexture: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public heightTexture: BaseTexture;\r\n\r\n    @serializeAsColor3()\r\n    public diffuseColor = new Color3(1, 1, 1);\r\n\r\n    @serialize()\r\n    public furLength: number = 1;\r\n\r\n    @serialize()\r\n    public furAngle: number = 0;\r\n\r\n    @serializeAsColor3()\r\n    public furColor = new Color3(0.44, 0.21, 0.02);\r\n\r\n    @serialize()\r\n    public furOffset: number = 0.0;\r\n\r\n    @serialize()\r\n    public furSpacing: number = 12;\r\n\r\n    @serializeAsVector3()\r\n    public furGravity = new Vector3(0, 0, 0);\r\n\r\n    @serialize()\r\n    public furSpeed: number = 100;\r\n\r\n    @serialize()\r\n    public furDensity: number = 20;\r\n\r\n    @serialize()\r\n    public furOcclusion: number = 0.0;\r\n\r\n    public furTexture: DynamicTexture;\r\n\r\n    @serialize(\"disableLighting\")\r\n    private _disableLighting = false;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public disableLighting: boolean;\r\n\r\n    @serialize(\"maxSimultaneousLights\")\r\n    private _maxSimultaneousLights = 4;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public maxSimultaneousLights: number;\r\n\r\n    @serialize()\r\n    public highLevelFur: boolean = true;\r\n\r\n    public _meshes: AbstractMesh[];\r\n\r\n    private _renderId: number;\r\n\r\n    private _furTime: number = 0;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    @serialize()\r\n    public get furTime() {\r\n        return this._furTime;\r\n    }\r\n\r\n    public set furTime(furTime: number) {\r\n        this._furTime = furTime;\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    public updateFur(): void {\r\n        for (var i = 1; i < this._meshes.length; i++) {\r\n            var offsetFur = <FurMaterial>this._meshes[i].material;\r\n\r\n            offsetFur.furLength = this.furLength;\r\n            offsetFur.furAngle = this.furAngle;\r\n            offsetFur.furGravity = this.furGravity;\r\n            offsetFur.furSpacing = this.furSpacing;\r\n            offsetFur.furSpeed = this.furSpeed;\r\n            offsetFur.furColor = this.furColor;\r\n            offsetFur.diffuseTexture = this.diffuseTexture;\r\n            offsetFur.furTexture = this.furTexture;\r\n            offsetFur.highLevelFur = this.highLevelFur;\r\n            offsetFur.furTime = this.furTime;\r\n            offsetFur.furDensity = this.furDensity;\r\n        }\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new FurMaterialDefines();\r\n        }\r\n\r\n        var defines = <FurMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Textures\r\n        if (defines._areTexturesDirty) {\r\n            if (scene.texturesEnabled) {\r\n                if (this.diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                    if (!this.diffuseTexture.isReady()) {\r\n                        return false;\r\n                    } else {\r\n                        defines._needUVs = true;\r\n                        defines.DIFFUSE = true;\r\n                    }\r\n                }\r\n                if (this.heightTexture && engine.getCaps().maxVertexTextureImageUnits) {\r\n                    if (!this.heightTexture.isReady()) {\r\n                        return false;\r\n                    } else {\r\n                        defines._needUVs = true;\r\n                        defines.HEIGHTMAP = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // High level\r\n        if (this.highLevelFur !== defines.HIGHLEVEL) {\r\n            defines.HIGHLEVEL = true;\r\n            defines.markAsUnprocessed();\r\n        }\r\n\r\n        // Misc.\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        // Lights\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights, this._disableLighting);\r\n\r\n        // Values that need to be evaluated on every frame\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, this.maxSimultaneousLights);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            if (defines.UV1) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n            }\r\n\r\n            if (defines.UV2) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            // Legacy browser patch\r\n            var shaderName = \"fur\";\r\n            var join = defines.toString();\r\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                \"vDiffuseInfos\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"diffuseMatrix\",\r\n                \"furLength\", \"furAngle\", \"furColor\", \"furOffset\", \"furGravity\", \"furTime\", \"furSpacing\", \"furDensity\", \"furOcclusion\"\r\n            ];\r\n            var samplers = [\"diffuseSampler\",\r\n                \"heightTexture\", \"furTexture\"\r\n            ];\r\n\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: this.maxSimultaneousLights\r\n            });\r\n\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights }\r\n                }, engine), defines);\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <FurMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        if (scene.getCachedMaterial() !== this) {\r\n            // Textures\r\n            if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                this._activeEffect.setTexture(\"diffuseSampler\", this._diffuseTexture);\r\n\r\n                this._activeEffect.setFloat2(\"vDiffuseInfos\", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level);\r\n                this._activeEffect.setMatrix(\"diffuseMatrix\", this._diffuseTexture.getTextureMatrix());\r\n            }\r\n\r\n            if (this._heightTexture) {\r\n                this._activeEffect.setTexture(\"heightTexture\", this._heightTexture);\r\n            }\r\n\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this.diffuseColor, this.alpha * mesh.visibility);\r\n\r\n        if (scene.lightsEnabled && !this.disableLighting) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, this.maxSimultaneousLights);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._activeEffect.setFloat(\"furLength\", this.furLength);\r\n        this._activeEffect.setFloat(\"furAngle\", this.furAngle);\r\n        this._activeEffect.setColor4(\"furColor\", this.furColor, 1.0);\r\n\r\n        if (this.highLevelFur) {\r\n            this._activeEffect.setVector3(\"furGravity\", this.furGravity);\r\n            this._activeEffect.setFloat(\"furOffset\", this.furOffset);\r\n            this._activeEffect.setFloat(\"furSpacing\", this.furSpacing);\r\n            this._activeEffect.setFloat(\"furDensity\", this.furDensity);\r\n            this._activeEffect.setFloat(\"furOcclusion\", this.furOcclusion);\r\n\r\n            this._furTime += this.getScene().getEngine().getDeltaTime() / this.furSpeed;\r\n            this._activeEffect.setFloat(\"furTime\", this._furTime);\r\n\r\n            this._activeEffect.setTexture(\"furTexture\", this.furTexture);\r\n        }\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        var results = [];\r\n\r\n        if (this.diffuseTexture && this.diffuseTexture.animations && this.diffuseTexture.animations.length > 0) {\r\n            results.push(this.diffuseTexture);\r\n        }\r\n\r\n        if (this.heightTexture && this.heightTexture.animations && this.heightTexture.animations.length > 0) {\r\n            results.push(this.heightTexture);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    public getActiveTextures(): BaseTexture[] {\r\n        var activeTextures = super.getActiveTextures();\r\n\r\n        if (this._diffuseTexture) {\r\n            activeTextures.push(this._diffuseTexture);\r\n        }\r\n\r\n        if (this._heightTexture) {\r\n            activeTextures.push(this._heightTexture);\r\n        }\r\n\r\n        return activeTextures;\r\n    }\r\n\r\n    public hasTexture(texture: BaseTexture): boolean {\r\n        if (super.hasTexture(texture)) {\r\n            return true;\r\n        }\r\n\r\n        if (this.diffuseTexture === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._heightTexture === texture) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        if (this.diffuseTexture) {\r\n            this.diffuseTexture.dispose();\r\n        }\r\n\r\n        if (this._meshes) {\r\n            for (var i = 1; i < this._meshes.length; i++) {\r\n                let mat = this._meshes[i].material;\r\n\r\n                if (mat) {\r\n                    mat.dispose(forceDisposeEffect);\r\n                }\r\n                this._meshes[i].dispose();\r\n            }\r\n        }\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): FurMaterial {\r\n        return SerializationHelper.Clone(() => new FurMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.FurMaterial\";\r\n\r\n        if (this._meshes) {\r\n            serializationObject.sourceMeshName = this._meshes[0].name;\r\n            serializationObject.quality = this._meshes.length;\r\n        }\r\n\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"FurMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): FurMaterial {\r\n        var material = SerializationHelper.Parse(() => new FurMaterial(source.name, scene), source, scene, rootUrl);\r\n\r\n        if (source.sourceMeshName && material.highLevelFur) {\r\n            scene.executeWhenReady(() => {\r\n                var sourceMesh = <Mesh>scene.getMeshByName(source.sourceMeshName);\r\n                if (sourceMesh) {\r\n                    var furTexture = FurMaterial.GenerateTexture(\"Fur Texture\", scene);\r\n                    material.furTexture = furTexture;\r\n                    FurMaterial.FurifyMesh(sourceMesh, source.quality);\r\n                }\r\n            });\r\n        }\r\n\r\n        return material;\r\n    }\r\n\r\n    public static GenerateTexture(name: string, scene: Scene): DynamicTexture {\r\n        // Generate fur textures\r\n        var texture = new DynamicTexture(\"FurTexture \" + name, 256, scene, true);\r\n        var context = texture.getContext();\r\n\r\n        for (var i = 0; i < 20000; ++i) {\r\n            context.fillStyle = \"rgba(255, \" + Math.floor(Math.random() * 255) + \", \" + Math.floor(Math.random() * 255) + \", 1)\";\r\n            context.fillRect((Math.random() * texture.getSize().width), (Math.random() * texture.getSize().height), 2, 2);\r\n        }\r\n\r\n        texture.update(false);\r\n        texture.wrapU = Texture.WRAP_ADDRESSMODE;\r\n        texture.wrapV = Texture.WRAP_ADDRESSMODE;\r\n\r\n        return texture;\r\n    }\r\n\r\n    // Creates and returns an array of meshes used as shells for the Fur Material\r\n    // that can be disposed later in your code\r\n    // The quality is in interval [0, 100]\r\n    public static FurifyMesh(sourceMesh: Mesh, quality: number): Mesh[] {\r\n        var meshes = [sourceMesh];\r\n        var mat: FurMaterial = <FurMaterial>sourceMesh.material;\r\n        var i;\r\n\r\n        if (!(mat instanceof FurMaterial)) {\r\n            throw \"The material of the source mesh must be a Fur Material\";\r\n        }\r\n\r\n        for (i = 1; i < quality; i++) {\r\n            var offsetFur = new FurMaterial(mat.name + i, sourceMesh.getScene());\r\n            sourceMesh.getScene().materials.pop();\r\n            Tags.EnableFor(offsetFur);\r\n            Tags.AddTagsTo(offsetFur, \"furShellMaterial\");\r\n\r\n            offsetFur.furLength = mat.furLength;\r\n            offsetFur.furAngle = mat.furAngle;\r\n            offsetFur.furGravity = mat.furGravity;\r\n            offsetFur.furSpacing = mat.furSpacing;\r\n            offsetFur.furSpeed = mat.furSpeed;\r\n            offsetFur.furColor = mat.furColor;\r\n            offsetFur.diffuseTexture = mat.diffuseTexture;\r\n            offsetFur.furOffset = i / quality;\r\n            offsetFur.furTexture = mat.furTexture;\r\n            offsetFur.highLevelFur = mat.highLevelFur;\r\n            offsetFur.furTime = mat.furTime;\r\n            offsetFur.furDensity = mat.furDensity;\r\n\r\n            var offsetMesh = sourceMesh.clone(sourceMesh.name + i);\r\n\r\n            offsetMesh.material = offsetFur;\r\n            offsetMesh.skeleton = sourceMesh.skeleton;\r\n            offsetMesh.position = Vector3.Zero();\r\n            meshes.push(offsetMesh);\r\n        }\r\n\r\n        for (i = 1; i < meshes.length; i++) {\r\n            meshes[i].parent = sourceMesh;\r\n        }\r\n\r\n        (<FurMaterial>sourceMesh.material)._meshes = meshes;\r\n\r\n        return meshes;\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n\\nuniform vec4 furColor;\\nuniform float furLength;\\nvarying vec3 vPositionW;\\nvarying float vfur_length;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform sampler2D diffuseSampler;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n\\n#ifdef HIGHLEVEL\\nuniform float furOffset;\\nuniform float furOcclusion;\\nuniform sampler2D furTexture;\\nvarying vec2 vFurUV;\\n#endif\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n#include<fogFragmentDeclaration>\\n#include<clipPlaneFragmentDeclaration>\\nfloat Rand(vec3 rv) {\\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\\nreturn fract(sin(x)*43758.5453);\\n}\\nvoid main(void) {\\n\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=furColor;\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n\\nfloat alpha=vDiffuseColor.a;\\n#ifdef DIFFUSE\\nbaseColor*=texture2D(diffuseSampler,vDiffuseUV);\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\nbaseColor.rgb*=vDiffuseInfos.y;\\n#endif\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n#ifdef HIGHLEVEL\\n\\nvec4 furTextureColor=texture2D(furTexture,vec2(vFurUV.x,vFurUV.y));\\nif (furTextureColor.a<=0.0 || furTextureColor.g<furOffset) {\\ndiscard;\\n}\\nfloat occlusion=mix(0.0,furTextureColor.b*1.2,furOffset);\\nbaseColor=vec4(baseColor.xyz*max(occlusion,furOcclusion),1.1-furOffset);\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\nfloat glossiness=0.;\\n#ifdef SPECULARTERM\\nvec3 specularBase=vec3(0.,0.,0.);\\n#endif\\n#include<lightFragment>[0..maxSimultaneousLights]\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase.rgb*baseColor.rgb,0.0,1.0);\\n\\n#ifdef HIGHLEVEL\\nvec4 color=vec4(finalDiffuse,alpha);\\n#else\\nfloat r=vfur_length/furLength*0.5;\\nvec4 color=vec4(finalDiffuse*(0.5+r),alpha);\\n#endif\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\nattribute vec3 normal;\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\nuniform float furLength;\\nuniform float furAngle;\\n#ifdef HIGHLEVEL\\nuniform float furOffset;\\nuniform vec3 furGravity;\\nuniform float furTime;\\nuniform float furSpacing;\\nuniform float furDensity;\\n#endif\\n#ifdef HEIGHTMAP\\nuniform sampler2D heightTexture;\\n#endif\\n#ifdef HIGHLEVEL\\nvarying vec2 vFurUV;\\n#endif\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform mat4 diffuseMatrix;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\nvarying float vfur_length;\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nfloat Rand(vec3 rv) {\\nfloat x=dot(rv,vec3(12.9898,78.233,24.65487));\\nreturn fract(sin(x)*43758.5453);\\n}\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\n\\nfloat r=Rand(position);\\n#ifdef HEIGHTMAP\\n#if __VERSION__>100\\nvfur_length=furLength*texture(heightTexture,uv).x;\\n#else\\nvfur_length=furLength*texture2D(heightTexture,uv).r;\\n#endif\\n#else \\nvfur_length=(furLength*r);\\n#endif\\nvec3 tangent1=vec3(normal.y,-normal.x,0);\\nvec3 tangent2=vec3(-normal.z,0,normal.x);\\nr=Rand(tangent1*r);\\nfloat J=(2.0+4.0*r);\\nr=Rand(tangent2*r);\\nfloat K=(2.0+2.0*r);\\ntangent1=tangent1*J+tangent2*K;\\ntangent1=normalize(tangent1);\\nvec3 newPosition=position+normal*vfur_length*cos(furAngle)+tangent1*vfur_length*sin(furAngle);\\n#ifdef HIGHLEVEL\\n\\nvec3 forceDirection=vec3(0.0,0.0,0.0);\\nforceDirection.x=sin(furTime+position.x*0.05)*0.2;\\nforceDirection.y=cos(furTime*0.7+position.y*0.04)*0.2;\\nforceDirection.z=sin(furTime*0.7+position.z*0.04)*0.2;\\nvec3 displacement=vec3(0.0,0.0,0.0);\\ndisplacement=furGravity+forceDirection;\\nfloat displacementFactor=pow(furOffset,3.0);\\nvec3 aNormal=normal;\\naNormal.xyz+=displacement*displacementFactor;\\nnewPosition=vec3(newPosition.x,newPosition.y,newPosition.z)+(normalize(aNormal)*furOffset*furSpacing);\\n#endif\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\ngl_Position=viewProjection*finalWorld*vec4(newPosition,1.0);\\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\\nvPositionW=vec3(worldPos);\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef DIFFUSE\\nif (vDiffuseInfos.x == 0.)\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\\n}\\nelse\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\\n}\\n#ifdef HIGHLEVEL\\nvFurUV=vDiffuseUV*furDensity;\\n#endif\\n#else\\n#ifdef HIGHLEVEL\\nvFurUV=uv*furDensity;\\n#endif\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./gradientMaterial\";","import { Effect, MaterialDefines, PushMaterial, serialize, expandToProperty, serializeAsColor3, Color3, Scene, Nullable, BaseTexture, AbstractMesh, SubMesh, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"gradientPixelShader\"] = require(\"./gradient.fragment.fx\");\r\nEffect.ShadersStore[\"gradientVertexShader\"] = require(\"./gradient.vertex.fx\");\r\n\r\nclass GradientMaterialDefines extends MaterialDefines {\r\n    public DIFFUSE = false;\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public DEPTHPREPASS = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public LIGHT0 = false;\r\n    public LIGHT1 = false;\r\n    public LIGHT2 = false;\r\n    public LIGHT3 = false;\r\n    public SPOTLIGHT0 = false;\r\n    public SPOTLIGHT1 = false;\r\n    public SPOTLIGHT2 = false;\r\n    public SPOTLIGHT3 = false;\r\n    public HEMILIGHT0 = false;\r\n    public HEMILIGHT1 = false;\r\n    public HEMILIGHT2 = false;\r\n    public HEMILIGHT3 = false;\r\n    public DIRLIGHT0 = false;\r\n    public DIRLIGHT1 = false;\r\n    public DIRLIGHT2 = false;\r\n    public DIRLIGHT3 = false;\r\n    public POINTLIGHT0 = false;\r\n    public POINTLIGHT1 = false;\r\n    public POINTLIGHT2 = false;\r\n    public POINTLIGHT3 = false;\r\n    public SHADOW0 = false;\r\n    public SHADOW1 = false;\r\n    public SHADOW2 = false;\r\n    public SHADOW3 = false;\r\n    public SHADOWS = false;\r\n    public SHADOWESM0 = false;\r\n    public SHADOWESM1 = false;\r\n    public SHADOWESM2 = false;\r\n    public SHADOWESM3 = false;\r\n    public SHADOWPOISSON0 = false;\r\n    public SHADOWPOISSON1 = false;\r\n    public SHADOWPOISSON2 = false;\r\n    public SHADOWPOISSON3 = false;\r\n    public SHADOWPCF0 = false;\r\n    public SHADOWPCF1 = false;\r\n    public SHADOWPCF2 = false;\r\n    public SHADOWPCF3 = false;\r\n    public SHADOWPCSS0 = false;\r\n    public SHADOWPCSS1 = false;\r\n    public SHADOWPCSS2 = false;\r\n    public SHADOWPCSS3 = false;\r\n    public NORMAL = false;\r\n    public UV1 = false;\r\n    public UV2 = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class GradientMaterial extends PushMaterial {\r\n\r\n    @serialize(\"maxSimultaneousLights\")\r\n    private _maxSimultaneousLights = 4;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public maxSimultaneousLights: number;\r\n\r\n    // The gradient top color, red by default\r\n    @serializeAsColor3()\r\n    public topColor = new Color3(1, 0, 0);\r\n\r\n    @serialize()\r\n    public topColorAlpha = 1.0;\r\n\r\n    // The gradient top color, blue by default\r\n    @serializeAsColor3()\r\n    public bottomColor = new Color3(0, 0, 1);\r\n\r\n    @serialize()\r\n    public bottomColorAlpha = 1.0;\r\n\r\n    // Gradient offset\r\n    @serialize()\r\n    public offset = 0;\r\n\r\n    @serialize()\r\n    public scale = 1.0;\r\n\r\n    @serialize()\r\n    public smoothness = 1.0;\r\n\r\n    @serialize()\r\n    public disableLighting = false;\r\n    private _scaledDiffuse = new Color3();\r\n    private _renderId: number;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0 || this.topColorAlpha < 1.0 || this.bottomColorAlpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new GradientMaterialDefines();\r\n        }\r\n\r\n        var defines = <GradientMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, false, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            if (defines.UV1) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n            }\r\n\r\n            if (defines.UV2) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            // Legacy browser patch\r\n            var shaderName = \"gradient\";\r\n            var join = defines.toString();\r\n\r\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                \"vDiffuseInfos\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"diffuseMatrix\",\r\n                \"topColor\", \"bottomColor\", \"offset\", \"smoothness\", \"scale\"\r\n            ];\r\n            var samplers = [\"diffuseSampler\"];\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: 4\r\n            });\r\n\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: 4 }\r\n                }, engine), defines);\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <GradientMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, effect);\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(effect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this._scaledDiffuse, this.alpha * mesh.visibility);\r\n\r\n        if (scene.lightsEnabled && !this.disableLighting) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._activeEffect.setColor4(\"topColor\", this.topColor, this.topColorAlpha);\r\n        this._activeEffect.setColor4(\"bottomColor\", this.bottomColor, this.bottomColorAlpha);\r\n        this._activeEffect.setFloat(\"offset\", this.offset);\r\n        this._activeEffect.setFloat(\"scale\", this.scale);\r\n        this._activeEffect.setFloat(\"smoothness\", this.smoothness);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        return [];\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): GradientMaterial {\r\n        return SerializationHelper.Clone(() => new GradientMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.GradientMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"GradientMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): GradientMaterial {\r\n        return SerializationHelper.Parse(() => new GradientMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n\\nuniform vec4 topColor;\\nuniform vec4 bottomColor;\\nuniform float offset;\\nuniform float scale;\\nuniform float smoothness;\\n\\nvarying vec3 vPositionW;\\nvarying vec3 vPosition;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0]\\n#include<__decl__lightFragment>[1]\\n#include<__decl__lightFragment>[2]\\n#include<__decl__lightFragment>[3]\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform sampler2D diffuseSampler;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\nvoid main(void) {\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\nfloat h=vPosition.y*scale+offset;\\nfloat mysmoothness=clamp(smoothness,0.01,max(smoothness,10.));\\nvec4 baseColor=mix(bottomColor,topColor,max(pow(max(h,0.0),mysmoothness),0.0));\\n\\nvec3 diffuseColor=baseColor.rgb;\\n\\nfloat alpha=baseColor.a;\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\nfloat glossiness=0.;\\n#include<lightFragment>[0]\\n#include<lightFragment>[1]\\n#include<lightFragment>[2]\\n#include<lightFragment>[3]\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\\n\\nvec4 color=vec4(finalDiffuse,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\\n\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform mat4 diffuseMatrix;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\nvarying vec3 vPosition;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex> \\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\nvPosition=position;\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef DIFFUSE\\nif (vDiffuseInfos.x == 0.)\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\\n}\\nelse\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\\n}\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./gridMaterial\";","import { Effect, MaterialDefines, serializeAsColor3, Color3, serialize, Vector3, Vector4, Scene, AbstractMesh, SubMesh, MaterialHelper, VertexBuffer, Matrix, Mesh, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"gridPixelShader\"] = require(\"./grid.fragment.fx\");\r\nEffect.ShadersStore[\"gridVertexShader\"] = require(\"./grid.vertex.fx\");\r\n\r\nclass GridMaterialDefines extends MaterialDefines {\r\n    public TRANSPARENT = false;\r\n    public FOG = false;\r\n    public PREMULTIPLYALPHA = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\n/**\r\n * The grid materials allows you to wrap any shape with a grid.\r\n * Colors are customizable.\r\n */\r\nexport class GridMaterial extends BABYLON.PushMaterial {\r\n\r\n    /**\r\n     * Main color of the grid (e.g. between lines)\r\n     */\r\n    @serializeAsColor3()\r\n    public mainColor = Color3.Black();\r\n\r\n    /**\r\n     * Color of the grid lines.\r\n     */\r\n    @serializeAsColor3()\r\n    public lineColor = Color3.Teal();\r\n\r\n    /**\r\n     * The scale of the grid compared to unit.\r\n     */\r\n    @serialize()\r\n    public gridRatio = 1.0;\r\n\r\n    /**\r\n     * Allows setting an offset for the grid lines.\r\n     */\r\n    @serializeAsColor3()\r\n    public gridOffset = Vector3.Zero();\r\n\r\n    /**\r\n     * The frequency of thicker lines.\r\n     */\r\n    @serialize()\r\n    public majorUnitFrequency = 10;\r\n\r\n    /**\r\n     * The visibility of minor units in the grid.\r\n     */\r\n    @serialize()\r\n    public minorUnitVisibility = 0.33;\r\n\r\n    /**\r\n     * The grid opacity outside of the lines.\r\n     */\r\n    @serialize()\r\n    public opacity = 1.0;\r\n\r\n    /**\r\n     * Determine RBG output is premultiplied by alpha value.\r\n     */\r\n    @serialize()\r\n    public preMultiplyAlpha = false;\r\n\r\n    private _gridControl: Vector4 = new Vector4(this.gridRatio, this.majorUnitFrequency, this.minorUnitVisibility, this.opacity);\r\n\r\n    private _renderId: number;\r\n\r\n    /**\r\n     * constructor\r\n     * @param name The name given to the material in order to identify it afterwards.\r\n     * @param scene The scene the material is used in.\r\n     */\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    /**\r\n     * Returns wehter or not the grid requires alpha blending.\r\n     */\r\n    public needAlphaBlending(): boolean {\r\n        return this.opacity < 1.0;\r\n    }\r\n\r\n    public needAlphaBlendingForMesh(mesh: AbstractMesh): boolean {\r\n        return this.needAlphaBlending();\r\n    }\r\n\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new GridMaterialDefines();\r\n        }\r\n\r\n        var defines = <GridMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (defines.TRANSPARENT !== (this.opacity < 1.0)) {\r\n            defines.TRANSPARENT = !defines.TRANSPARENT;\r\n            defines.markAsUnprocessed();\r\n        }\r\n\r\n        if (defines.PREMULTIPLYALPHA != this.preMultiplyAlpha) {\r\n            defines.PREMULTIPLYALPHA = !defines.PREMULTIPLYALPHA;\r\n            defines.markAsUnprocessed();\r\n        }\r\n\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, false, this.fogEnabled, false, defines);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n            scene.resetCachedMaterial();\r\n\r\n            // Attributes\r\n            var attribs = [VertexBuffer.PositionKind, VertexBuffer.NormalKind];\r\n\r\n            // Defines\r\n            var join = defines.toString();\r\n            subMesh.setEffect(scene.getEngine().createEffect(\"grid\",\r\n                attribs,\r\n                [\"projection\", \"worldView\", \"mainColor\", \"lineColor\", \"gridControl\", \"gridOffset\", \"vFogInfos\", \"vFogColor\", \"world\", \"view\"],\r\n                [],\r\n                join,\r\n                undefined,\r\n                this.onCompiled,\r\n                this.onError), defines);\r\n        }\r\n\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <GridMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"worldView\", world.multiply(scene.getViewMatrix()));\r\n        this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        this._activeEffect.setMatrix(\"projection\", scene.getProjectionMatrix());\r\n\r\n        // Uniforms\r\n        if (this._mustRebind(scene, effect)) {\r\n            this._activeEffect.setColor3(\"mainColor\", this.mainColor);\r\n            this._activeEffect.setColor3(\"lineColor\", this.lineColor);\r\n\r\n            this._activeEffect.setVector3(\"gridOffset\", this.gridOffset);\r\n\r\n            this._gridControl.x = this.gridRatio;\r\n            this._gridControl.y = Math.round(this.majorUnitFrequency);\r\n            this._gridControl.z = this.minorUnitVisibility;\r\n            this._gridControl.w = this.opacity;\r\n            this._activeEffect.setVector4(\"gridControl\", this._gridControl);\r\n        }\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): GridMaterial {\r\n        return SerializationHelper.Clone(() => new GridMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.GridMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"GridMaterial\";\r\n    }\r\n\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): GridMaterial {\r\n        return SerializationHelper.Parse(() => new GridMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}","module.exports = \"#extension GL_OES_standard_derivatives : enable\\n#define SQRT2 1.41421356\\n#define PI 3.14159\\nprecision highp float;\\nuniform vec3 mainColor;\\nuniform vec3 lineColor;\\nuniform vec4 gridControl;\\nuniform vec3 gridOffset;\\n\\n#ifdef TRANSPARENT\\nvarying vec4 vCameraSpacePosition;\\n#endif\\nvarying vec3 vPosition;\\nvarying vec3 vNormal;\\n#include<fogFragmentDeclaration>\\nfloat getVisibility(float position) {\\n\\nfloat majorGridFrequency=gridControl.y;\\nif (floor(position+0.5) == floor(position/majorGridFrequency+0.5)*majorGridFrequency)\\n{\\nreturn 1.0;\\n} \\nreturn gridControl.z;\\n}\\nfloat getAnisotropicAttenuation(float differentialLength) {\\nconst float maxNumberOfLines=10.0;\\nreturn clamp(1.0/(differentialLength+1.0)-1.0/maxNumberOfLines,0.0,1.0);\\n}\\nfloat isPointOnLine(float position,float differentialLength) {\\nfloat fractionPartOfPosition=position-floor(position+0.5); \\nfractionPartOfPosition/=differentialLength; \\nfractionPartOfPosition=clamp(fractionPartOfPosition,-1.,1.);\\nfloat result=0.5+0.5*cos(fractionPartOfPosition*PI); \\nreturn result; \\n}\\nfloat contributionOnAxis(float position) {\\nfloat differentialLength=length(vec2(dFdx(position),dFdy(position)));\\ndifferentialLength*=SQRT2; \\n\\nfloat result=isPointOnLine(position,differentialLength);\\n\\nfloat visibility=getVisibility(position);\\nresult*=visibility;\\n\\nfloat anisotropicAttenuation=getAnisotropicAttenuation(differentialLength);\\nresult*=anisotropicAttenuation;\\nreturn result;\\n}\\nfloat normalImpactOnAxis(float x) {\\nfloat normalImpact=clamp(1.0-3.0*abs(x*x*x),0.0,1.0);\\nreturn normalImpact;\\n}\\nvoid main(void) {\\n\\nfloat gridRatio=gridControl.x;\\nvec3 gridPos=(vPosition+gridOffset)/gridRatio;\\n\\nfloat x=contributionOnAxis(gridPos.x);\\nfloat y=contributionOnAxis(gridPos.y);\\nfloat z=contributionOnAxis(gridPos.z);\\n\\nvec3 normal=normalize(vNormal);\\nx*=normalImpactOnAxis(normal.x);\\ny*=normalImpactOnAxis(normal.y);\\nz*=normalImpactOnAxis(normal.z);\\n\\nfloat grid=clamp(x+y+z,0.,1.);\\n\\nvec3 color=mix(mainColor,lineColor,grid);\\n#ifdef FOG\\n#include<fogFragment>\\n#endif\\n#ifdef TRANSPARENT\\nfloat distanceToFragment=length(vCameraSpacePosition.xyz);\\nfloat cameraPassThrough=clamp(distanceToFragment-0.25,0.0,1.0);\\nfloat opacity=clamp(grid,0.08,cameraPassThrough*gridControl.w*grid);\\ngl_FragColor=vec4(color.rgb,opacity);\\n#ifdef PREMULTIPLYALPHA\\ngl_FragColor.rgb*=opacity;\\n#endif\\n#else\\n\\ngl_FragColor=vec4(color.rgb,1.0);\\n#endif\\n}\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\nattribute vec3 normal;\\n\\nuniform mat4 projection;\\nuniform mat4 world;\\nuniform mat4 view;\\nuniform mat4 worldView;\\n\\n#ifdef TRANSPARENT\\nvarying vec4 vCameraSpacePosition;\\n#endif\\nvarying vec3 vPosition;\\nvarying vec3 vNormal;\\n#include<fogVertexDeclaration>\\nvoid main(void) {\\n#ifdef FOG\\nvec4 worldPos=world*vec4(position,1.0);\\n#endif\\n#include<fogVertex>\\nvec4 cameraSpacePosition=worldView*vec4(position,1.0);\\ngl_Position=projection*cameraSpacePosition;\\n#ifdef TRANSPARENT\\nvCameraSpacePosition=cameraSpacePosition;\\n#endif\\nvPosition=position;\\nvNormal=normal;\\n}\"","export * from \"./lavaMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, BaseTexture, expandToProperty, serializeAsColor3, Color3, serialize, Scene, Nullable, AbstractMesh, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\";\n\nEffect.ShadersStore[\"lavaPixelShader\"] = require(\"./lava.fragment.fx\");\nEffect.ShadersStore[\"lavaVertexShader\"] = require(\"./lava.vertex.fx\");\n\nclass LavaMaterialDefines extends MaterialDefines {\n    public DIFFUSE = false;\n    public CLIPPLANE = false;\n    public CLIPPLANE2 = false;\n    public CLIPPLANE3 = false;\n    public CLIPPLANE4 = false;\n    public ALPHATEST = false;\n    public DEPTHPREPASS = false;\n    public POINTSIZE = false;\n    public FOG = false;\n    public LIGHT0 = false;\n    public LIGHT1 = false;\n    public LIGHT2 = false;\n    public LIGHT3 = false;\n    public SPOTLIGHT0 = false;\n    public SPOTLIGHT1 = false;\n    public SPOTLIGHT2 = false;\n    public SPOTLIGHT3 = false;\n    public HEMILIGHT0 = false;\n    public HEMILIGHT1 = false;\n    public HEMILIGHT2 = false;\n    public HEMILIGHT3 = false;\n    public DIRLIGHT0 = false;\n    public DIRLIGHT1 = false;\n    public DIRLIGHT2 = false;\n    public DIRLIGHT3 = false;\n    public POINTLIGHT0 = false;\n    public POINTLIGHT1 = false;\n    public POINTLIGHT2 = false;\n    public POINTLIGHT3 = false;\n    public SHADOW0 = false;\n    public SHADOW1 = false;\n    public SHADOW2 = false;\n    public SHADOW3 = false;\n    public SHADOWS = false;\n    public SHADOWESM0 = false;\n    public SHADOWESM1 = false;\n    public SHADOWESM2 = false;\n    public SHADOWESM3 = false;\n    public SHADOWPOISSON0 = false;\n    public SHADOWPOISSON1 = false;\n    public SHADOWPOISSON2 = false;\n    public SHADOWPOISSON3 = false;\n    public SHADOWPCF0 = false;\n    public SHADOWPCF1 = false;\n    public SHADOWPCF2 = false;\n    public SHADOWPCF3 = false;\n    public SHADOWPCSS0 = false;\n    public SHADOWPCSS1 = false;\n    public SHADOWPCSS2 = false;\n    public SHADOWPCSS3 = false;\n    public NORMAL = false;\n    public UV1 = false;\n    public UV2 = false;\n    public VERTEXCOLOR = false;\n    public VERTEXALPHA = false;\n    public NUM_BONE_INFLUENCERS = 0;\n    public BonesPerMesh = 0;\n    public INSTANCES = false;\n    public UNLIT = false;\n\n    constructor() {\n        super();\n        this.rebuild();\n    }\n}\n\nexport class LavaMaterial extends PushMaterial {\n    @serializeAsTexture(\"diffuseTexture\")\n    private _diffuseTexture: BaseTexture;\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    public diffuseTexture: BaseTexture;\n\n    @serializeAsTexture()\n    public noiseTexture: BaseTexture;\n\n    @serializeAsColor3()\n    public fogColor: Color3;\n\n    @serialize()\n    public speed: number = 1;\n\n    @serialize()\n    public movingSpeed: number = 1;\n\n    @serialize()\n    public lowFrequencySpeed: number = 1;\n\n    @serialize()\n    public fogDensity: number = 0.15;\n\n    private _lastTime: number = 0;\n\n    @serializeAsColor3()\n    public diffuseColor = new Color3(1, 1, 1);\n\n    @serialize(\"disableLighting\")\n    private _disableLighting = false;\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\n    public disableLighting: boolean;\n\n    @serialize(\"unlit\")\n    private _unlit = false;\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\n    public unlit: boolean;\n\n    @serialize(\"maxSimultaneousLights\")\n    private _maxSimultaneousLights = 4;\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\n    public maxSimultaneousLights: number;\n\n    private _scaledDiffuse = new Color3();\n    private _renderId: number;\n\n    constructor(name: string, scene: Scene) {\n        super(name, scene);\n    }\n\n    public needAlphaBlending(): boolean {\n        return (this.alpha < 1.0);\n    }\n\n    public needAlphaTesting(): boolean {\n        return false;\n    }\n\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\n        return null;\n    }\n\n    // Methods\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\n        if (this.isFrozen) {\n            if (this._wasPreviouslyReady && subMesh.effect) {\n                return true;\n            }\n        }\n\n        if (!subMesh._materialDefines) {\n            subMesh._materialDefines = new LavaMaterialDefines();\n        }\n\n        var defines = <LavaMaterialDefines>subMesh._materialDefines;\n        var scene = this.getScene();\n\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\n            if (this._renderId === scene.getRenderId()) {\n                return true;\n            }\n        }\n\n        var engine = scene.getEngine();\n\n        // Textures\n        if (defines._areTexturesDirty) {\n            defines._needUVs = false;\n            if (scene.texturesEnabled) {\n                if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\n                    if (!this._diffuseTexture.isReady()) {\n                        return false;\n                    } else {\n                        defines._needUVs = true;\n                        defines.DIFFUSE = true;\n                    }\n                }\n            }\n        }\n\n        // Misc.\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\n\n        // Lights\n        defines._needNormals = true;\n\n        MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights, this._disableLighting);\n\n        // Values that need to be evaluated on every frame\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\n\n        // Attribs\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\n\n        // Get correct effect\n        if (defines.isDirty) {\n            defines.markAsProcessed();\n            scene.resetCachedMaterial();\n\n            // Fallbacks\n            var fallbacks = new EffectFallbacks();\n            if (defines.FOG) {\n                fallbacks.addFallback(1, \"FOG\");\n            }\n\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks);\n\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\n                fallbacks.addCPUSkinningFallback(0, mesh);\n            }\n\n            //Attributes\n            var attribs = [VertexBuffer.PositionKind];\n\n            if (defines.NORMAL) {\n                attribs.push(VertexBuffer.NormalKind);\n            }\n\n            if (defines.UV1) {\n                attribs.push(VertexBuffer.UVKind);\n            }\n\n            if (defines.UV2) {\n                attribs.push(VertexBuffer.UV2Kind);\n            }\n\n            if (defines.VERTEXCOLOR) {\n                attribs.push(VertexBuffer.ColorKind);\n            }\n\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\n\n            // Legacy browser patch\n            var shaderName = \"lava\";\n            var join = defines.toString();\n\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\",\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\n                \"vDiffuseInfos\",\n                \"mBones\",\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"diffuseMatrix\",\n                \"time\", \"speed\", \"movingSpeed\",\n                \"fogColor\", \"fogDensity\", \"lowFrequencySpeed\"\n            ];\n\n            var samplers = [\"diffuseSampler\",\n                \"noiseTexture\"\n            ];\n            var uniformBuffers = new Array<string>();\n\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\n                uniformsNames: uniforms,\n                uniformBuffersNames: uniformBuffers,\n                samplers: samplers,\n                defines: defines,\n                maxSimultaneousLights: this.maxSimultaneousLights\n            });\n\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\n                <EffectCreationOptions>{\n                    attributes: attribs,\n                    uniformsNames: uniforms,\n                    uniformBuffersNames: uniformBuffers,\n                    samplers: samplers,\n                    defines: join,\n                    fallbacks: fallbacks,\n                    onCompiled: this.onCompiled,\n                    onError: this.onError,\n                    indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights }\n                }, engine), defines);\n        }\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\n            return false;\n        }\n\n        this._renderId = scene.getRenderId();\n        this._wasPreviouslyReady = true;\n\n        return true;\n    }\n\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\n        var scene = this.getScene();\n\n        var defines = <LavaMaterialDefines>subMesh._materialDefines;\n        if (!defines) {\n            return;\n        }\n\n        var effect = subMesh.effect;\n\n        if (!effect) {\n            return;\n        }\n        this._activeEffect = effect;\n\n        defines.UNLIT = this._unlit;\n\n        // Matrices\n        this.bindOnlyWorldMatrix(world);\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\n\n        // Bones\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\n\n        if (this._mustRebind(scene, effect)) {\n            // Textures\n            if (this.diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\n                this._activeEffect.setTexture(\"diffuseSampler\", this.diffuseTexture);\n\n                this._activeEffect.setFloat2(\"vDiffuseInfos\", this.diffuseTexture.coordinatesIndex, this.diffuseTexture.level);\n                this._activeEffect.setMatrix(\"diffuseMatrix\", this.diffuseTexture.getTextureMatrix());\n            }\n\n            if (this.noiseTexture) {\n                this._activeEffect.setTexture(\"noiseTexture\", this.noiseTexture);\n            }\n\n            // Clip plane\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\n\n            // Point size\n            if (this.pointsCloud) {\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\n            }\n\n            MaterialHelper.BindEyePosition(effect, scene);\n        }\n\n        this._activeEffect.setColor4(\"vDiffuseColor\", this._scaledDiffuse, this.alpha * mesh.visibility);\n\n        if (scene.lightsEnabled && !this.disableLighting) {\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines);\n        }\n\n        // View\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\n        }\n\n        // Fog\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\n\n        this._lastTime += scene.getEngine().getDeltaTime();\n        this._activeEffect.setFloat(\"time\", this._lastTime * this.speed / 1000);\n\n        if (!this.fogColor) {\n            this.fogColor = Color3.Black();\n        }\n        this._activeEffect.setColor3(\"fogColor\", this.fogColor);\n        this._activeEffect.setFloat(\"fogDensity\", this.fogDensity);\n\n        this._activeEffect.setFloat(\"lowFrequencySpeed\", this.lowFrequencySpeed);\n        this._activeEffect.setFloat(\"movingSpeed\", this.movingSpeed);\n\n        this._afterBind(mesh, this._activeEffect);\n    }\n\n    public getAnimatables(): IAnimatable[] {\n        var results = [];\n\n        if (this.diffuseTexture && this.diffuseTexture.animations && this.diffuseTexture.animations.length > 0) {\n            results.push(this.diffuseTexture);\n        }\n\n        if (this.noiseTexture && this.noiseTexture.animations && this.noiseTexture.animations.length > 0) {\n            results.push(this.noiseTexture);\n        }\n\n        return results;\n    }\n\n    public getActiveTextures(): BaseTexture[] {\n        var activeTextures = super.getActiveTextures();\n\n        if (this._diffuseTexture) {\n            activeTextures.push(this._diffuseTexture);\n        }\n\n        return activeTextures;\n    }\n\n    public hasTexture(texture: BaseTexture): boolean {\n        if (super.hasTexture(texture)) {\n            return true;\n        }\n\n        if (this.diffuseTexture === texture) {\n            return true;\n        }\n\n        return false;\n    }\n\n    public dispose(forceDisposeEffect?: boolean): void {\n        if (this.diffuseTexture) {\n            this.diffuseTexture.dispose();\n        }\n        if (this.noiseTexture) {\n            this.noiseTexture.dispose();\n        }\n\n        super.dispose(forceDisposeEffect);\n    }\n\n    public clone(name: string): LavaMaterial {\n        return SerializationHelper.Clone(() => new LavaMaterial(name, this.getScene()), this);\n    }\n\n    public serialize(): any {\n        var serializationObject = SerializationHelper.Serialize(this);\n        serializationObject.customType = \"BABYLON.LavaMaterial\";\n        return serializationObject;\n    }\n\n    public getClassName(): string {\n        return \"LavaMaterial\";\n    }\n\n    // Statics\n    public static Parse(source: any, scene: Scene, rootUrl: string): LavaMaterial {\n        return SerializationHelper.Parse(() => new LavaMaterial(source.name, scene), source, scene, rootUrl);\n    }\n}\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n\\nvarying vec3 vPositionW;\\n\\nuniform float time;\\nuniform float speed;\\nuniform float movingSpeed;\\nuniform vec3 fogColor;\\nuniform sampler2D noiseTexture;\\nuniform float fogDensity;\\n\\nvarying float noise;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0]\\n#include<__decl__lightFragment>[1]\\n#include<__decl__lightFragment>[2]\\n#include<__decl__lightFragment>[3]\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform sampler2D diffuseSampler;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\nfloat random( vec3 scale,float seed ){\\nreturn fract( sin( dot( gl_FragCoord.xyz+seed,scale ) )*43758.5453+seed ) ;\\n}\\nvoid main(void) {\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=vec4(1.,1.,1.,1.);\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n\\nfloat alpha=vDiffuseColor.a;\\n#ifdef DIFFUSE\\n\\nvec4 noiseTex=texture2D( noiseTexture,vDiffuseUV );\\nvec2 T1=vDiffuseUV+vec2( 1.5,-1.5 )*time*0.02;\\nvec2 T2=vDiffuseUV+vec2( -0.5,2.0 )*time*0.01*speed;\\nT1.x+=noiseTex.x*2.0;\\nT1.y+=noiseTex.y*2.0;\\nT2.x-=noiseTex.y*0.2+time*0.001*movingSpeed;\\nT2.y+=noiseTex.z*0.2+time*0.002*movingSpeed;\\nfloat p=texture2D( noiseTexture,T1*3.0 ).a;\\nvec4 lavaColor=texture2D( diffuseSampler,T2*4.0);\\nvec4 temp=lavaColor*( vec4( p,p,p,p )*2. )+( lavaColor*lavaColor-0.1 );\\nbaseColor=temp;\\nfloat depth=gl_FragCoord.z*4.0;\\nconst float LOG2=1.442695;\\nfloat fogFactor=exp2(-fogDensity*fogDensity*depth*depth*LOG2 );\\nfogFactor=1.0-clamp( fogFactor,0.0,1.0 );\\nbaseColor=mix( baseColor,vec4( fogColor,baseColor.w ),fogFactor );\\ndiffuseColor=baseColor.rgb;\\n\\n\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\nbaseColor.rgb*=vDiffuseInfos.y;\\n#endif\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n#ifdef UNLIT\\nvec3 diffuseBase=vec3(1.,1.,1.);\\n#else\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\nfloat glossiness=0.;\\n#include<lightFragment>[0]\\n#include<lightFragment>[1]\\n#include<lightFragment>[2]\\n#include<lightFragment>[3]\\n#endif\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\\n\\nvec4 color=vec4(finalDiffuse,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\"","module.exports = \"precision highp float;\\n\\nuniform float time;\\nuniform float lowFrequencySpeed;\\n\\nvarying float noise;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform mat4 diffuseMatrix;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n\\n\\n\\nvec3 mod289(vec3 x)\\n{\\nreturn x-floor(x*(1.0/289.0))*289.0;\\n}\\nvec4 mod289(vec4 x)\\n{\\nreturn x-floor(x*(1.0/289.0))*289.0;\\n}\\nvec4 permute(vec4 x)\\n{\\nreturn mod289(((x*34.0)+1.0)*x);\\n}\\nvec4 taylorInvSqrt(vec4 r)\\n{\\nreturn 1.79284291400159-0.85373472095314*r;\\n}\\nvec3 fade(vec3 t) {\\nreturn t*t*t*(t*(t*6.0-15.0)+10.0);\\n}\\n\\nfloat pnoise(vec3 P,vec3 rep)\\n{\\nvec3 Pi0=mod(floor(P),rep); \\nvec3 Pi1=mod(Pi0+vec3(1.0),rep); \\nPi0=mod289(Pi0);\\nPi1=mod289(Pi1);\\nvec3 Pf0=fract(P); \\nvec3 Pf1=Pf0-vec3(1.0); \\nvec4 ix=vec4(Pi0.x,Pi1.x,Pi0.x,Pi1.x);\\nvec4 iy=vec4(Pi0.yy,Pi1.yy);\\nvec4 iz0=Pi0.zzzz;\\nvec4 iz1=Pi1.zzzz;\\nvec4 ixy=permute(permute(ix)+iy);\\nvec4 ixy0=permute(ixy+iz0);\\nvec4 ixy1=permute(ixy+iz1);\\nvec4 gx0=ixy0*(1.0/7.0);\\nvec4 gy0=fract(floor(gx0)*(1.0/7.0))-0.5;\\ngx0=fract(gx0);\\nvec4 gz0=vec4(0.5)-abs(gx0)-abs(gy0);\\nvec4 sz0=step(gz0,vec4(0.0));\\ngx0-=sz0*(step(0.0,gx0)-0.5);\\ngy0-=sz0*(step(0.0,gy0)-0.5);\\nvec4 gx1=ixy1*(1.0/7.0);\\nvec4 gy1=fract(floor(gx1)*(1.0/7.0))-0.5;\\ngx1=fract(gx1);\\nvec4 gz1=vec4(0.5)-abs(gx1)-abs(gy1);\\nvec4 sz1=step(gz1,vec4(0.0));\\ngx1-=sz1*(step(0.0,gx1)-0.5);\\ngy1-=sz1*(step(0.0,gy1)-0.5);\\nvec3 g000=vec3(gx0.x,gy0.x,gz0.x);\\nvec3 g100=vec3(gx0.y,gy0.y,gz0.y);\\nvec3 g010=vec3(gx0.z,gy0.z,gz0.z);\\nvec3 g110=vec3(gx0.w,gy0.w,gz0.w);\\nvec3 g001=vec3(gx1.x,gy1.x,gz1.x);\\nvec3 g101=vec3(gx1.y,gy1.y,gz1.y);\\nvec3 g011=vec3(gx1.z,gy1.z,gz1.z);\\nvec3 g111=vec3(gx1.w,gy1.w,gz1.w);\\nvec4 norm0=taylorInvSqrt(vec4(dot(g000,g000),dot(g010,g010),dot(g100,g100),dot(g110,g110)));\\ng000*=norm0.x;\\ng010*=norm0.y;\\ng100*=norm0.z;\\ng110*=norm0.w;\\nvec4 norm1=taylorInvSqrt(vec4(dot(g001,g001),dot(g011,g011),dot(g101,g101),dot(g111,g111)));\\ng001*=norm1.x;\\ng011*=norm1.y;\\ng101*=norm1.z;\\ng111*=norm1.w;\\nfloat n000=dot(g000,Pf0);\\nfloat n100=dot(g100,vec3(Pf1.x,Pf0.yz));\\nfloat n010=dot(g010,vec3(Pf0.x,Pf1.y,Pf0.z));\\nfloat n110=dot(g110,vec3(Pf1.xy,Pf0.z));\\nfloat n001=dot(g001,vec3(Pf0.xy,Pf1.z));\\nfloat n101=dot(g101,vec3(Pf1.x,Pf0.y,Pf1.z));\\nfloat n011=dot(g011,vec3(Pf0.x,Pf1.yz));\\nfloat n111=dot(g111,Pf1);\\nvec3 fade_xyz=fade(Pf0);\\nvec4 n_z=mix(vec4(n000,n100,n010,n110),vec4(n001,n101,n011,n111),fade_xyz.z);\\nvec2 n_yz=mix(n_z.xy,n_z.zw,fade_xyz.y);\\nfloat n_xyz=mix(n_yz.x,n_yz.y,fade_xyz.x);\\nreturn 2.2*n_xyz;\\n}\\n\\nfloat turbulence( vec3 p ) {\\nfloat w=100.0;\\nfloat t=-.5;\\nfor (float f=1.0 ; f<=10.0 ; f++ ){\\nfloat power=pow( 2.0,f );\\nt+=abs( pnoise( vec3( power*p ),vec3( 10.0,10.0,10.0 ) )/power );\\n}\\nreturn t;\\n}\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\n#ifdef NORMAL\\n\\nnoise=10.0*-.10*turbulence( .5*normal+time*1.15 );\\n\\nfloat b=lowFrequencySpeed*5.0*pnoise( 0.05*position +vec3(time*1.025),vec3( 100.0 ) );\\n\\nfloat displacement =-1.5*noise+b;\\n\\nvec3 newPosition=position+normal*displacement;\\ngl_Position=viewProjection*finalWorld*vec4( newPosition,1.0 );\\nvec4 worldPos=finalWorld*vec4(newPosition,1.0);\\nvPositionW=vec3(worldPos);\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef DIFFUSE\\nif (vDiffuseInfos.x == 0.)\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\\n}\\nelse\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\\n}\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\"","export * from \"./mixMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, BaseTexture, expandToProperty, Texture, serializeAsColor3, Color3, serialize, Scene, Nullable, AbstractMesh, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"mixPixelShader\"] = require(\"./mix.fragment.fx\");\r\nEffect.ShadersStore[\"mixVertexShader\"] = require(\"./mix.vertex.fx\");\r\n\r\nclass MixMaterialDefines extends MaterialDefines {\r\n    public DIFFUSE = false;\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public DEPTHPREPASS = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public SPECULARTERM = false;\r\n    public NORMAL = false;\r\n    public UV1 = false;\r\n    public UV2 = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n    public MIXMAP2 = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class MixMaterial extends PushMaterial {\r\n    /**\r\n     * Mix textures\r\n     */\r\n\r\n    @serializeAsTexture(\"mixTexture1\")\r\n    private _mixTexture1: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public mixTexture1: BaseTexture;\r\n\r\n    @serializeAsTexture(\"mixTexture2\")\r\n    private _mixTexture2: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public mixTexture2: BaseTexture;\r\n\r\n    /**\r\n     * Diffuse textures\r\n     */\r\n\r\n    @serializeAsTexture(\"diffuseTexture1\")\r\n    private _diffuseTexture1: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture1: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture2\")\r\n    private _diffuseTexture2: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture2: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture3\")\r\n    private _diffuseTexture3: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture3: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture4\")\r\n    private _diffuseTexture4: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture4: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture1\")\r\n    private _diffuseTexture5: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture5: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture2\")\r\n    private _diffuseTexture6: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture6: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture3\")\r\n    private _diffuseTexture7: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture7: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture4\")\r\n    private _diffuseTexture8: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture8: Texture;\r\n\r\n    /**\r\n     * Uniforms\r\n     */\r\n\r\n    @serializeAsColor3()\r\n    public diffuseColor = new Color3(1, 1, 1);\r\n\r\n    @serializeAsColor3()\r\n    public specularColor = new Color3(0, 0, 0);\r\n\r\n    @serialize()\r\n    public specularPower = 64;\r\n\r\n    @serialize(\"disableLighting\")\r\n    private _disableLighting = false;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public disableLighting: boolean;\r\n\r\n    @serialize(\"maxSimultaneousLights\")\r\n    private _maxSimultaneousLights = 4;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public maxSimultaneousLights: number;\r\n\r\n    private _renderId: number;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new MixMaterialDefines();\r\n        }\r\n\r\n        var defines = <MixMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Textures\r\n        if (scene.texturesEnabled) {\r\n            if (StandardMaterial.DiffuseTextureEnabled) {\r\n                if (this._mixTexture1) {\r\n                    if (!this._mixTexture1.isReady()) {\r\n                        return false;\r\n                    } else {\r\n                        defines._needUVs = true;\r\n                        defines.DIFFUSE = true;\r\n                    }\r\n                }\r\n                if (this._mixTexture2) {\r\n                    if (!this._mixTexture2.isReady()) {\r\n                        return false;\r\n                    } else {\r\n                        defines.MIXMAP2 = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Misc.\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        // Lights\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights, this._disableLighting);\r\n\r\n        // Values that need to be evaluated on every frame\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, this.maxSimultaneousLights);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            if (defines.UV1) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n            }\r\n\r\n            if (defines.UV2) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            // Legacy browser patch\r\n            var shaderName = \"mix\";\r\n            var join = defines.toString();\r\n            var uniforms = [\r\n                \"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\", \"vSpecularColor\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                \"vTextureInfos\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"textureMatrix\",\r\n                \"diffuse1Infos\", \"diffuse2Infos\", \"diffuse3Infos\", \"diffuse4Infos\",\r\n                \"diffuse5Infos\", \"diffuse6Infos\", \"diffuse7Infos\", \"diffuse8Infos\"\r\n            ];\r\n            var samplers = [\r\n                \"mixMap1Sampler\", \"mixMap2Sampler\",\r\n                \"diffuse1Sampler\", \"diffuse2Sampler\", \"diffuse3Sampler\", \"diffuse4Sampler\",\r\n                \"diffuse5Sampler\", \"diffuse6Sampler\", \"diffuse7Sampler\", \"diffuse8Sampler\"\r\n            ];\r\n\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: this.maxSimultaneousLights\r\n            });\r\n\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights }\r\n                }, engine), defines);\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <MixMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n            // Textures\r\n            if (this._mixTexture1) {\r\n                this._activeEffect.setTexture(\"mixMap1Sampler\", this._mixTexture1);\r\n                this._activeEffect.setFloat2(\"vTextureInfos\", this._mixTexture1.coordinatesIndex, this._mixTexture1.level);\r\n                this._activeEffect.setMatrix(\"textureMatrix\", this._mixTexture1.getTextureMatrix());\r\n\r\n                if (StandardMaterial.DiffuseTextureEnabled) {\r\n                    if (this._diffuseTexture1) {\r\n                        this._activeEffect.setTexture(\"diffuse1Sampler\", this._diffuseTexture1);\r\n                        this._activeEffect.setFloat2(\"diffuse1Infos\", this._diffuseTexture1.uScale, this._diffuseTexture1.vScale);\r\n                    }\r\n                    if (this._diffuseTexture2) {\r\n                        this._activeEffect.setTexture(\"diffuse2Sampler\", this._diffuseTexture2);\r\n                        this._activeEffect.setFloat2(\"diffuse2Infos\", this._diffuseTexture2.uScale, this._diffuseTexture2.vScale);\r\n                    }\r\n                    if (this._diffuseTexture3) {\r\n                        this._activeEffect.setTexture(\"diffuse3Sampler\", this._diffuseTexture3);\r\n                        this._activeEffect.setFloat2(\"diffuse3Infos\", this._diffuseTexture3.uScale, this._diffuseTexture3.vScale);\r\n                    }\r\n                    if (this._diffuseTexture4) {\r\n                        this._activeEffect.setTexture(\"diffuse4Sampler\", this._diffuseTexture4);\r\n                        this._activeEffect.setFloat2(\"diffuse4Infos\", this._diffuseTexture4.uScale, this._diffuseTexture4.vScale);\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (this._mixTexture2) {\r\n                this._activeEffect.setTexture(\"mixMap2Sampler\", this._mixTexture2);\r\n\r\n                if (StandardMaterial.DiffuseTextureEnabled) {\r\n                    if (this._diffuseTexture5) {\r\n                        this._activeEffect.setTexture(\"diffuse5Sampler\", this._diffuseTexture5);\r\n                        this._activeEffect.setFloat2(\"diffuse5Infos\", this._diffuseTexture5.uScale, this._diffuseTexture5.vScale);\r\n                    }\r\n                    if (this._diffuseTexture6) {\r\n                        this._activeEffect.setTexture(\"diffuse6Sampler\", this._diffuseTexture6);\r\n                        this._activeEffect.setFloat2(\"diffuse6Infos\", this._diffuseTexture6.uScale, this._diffuseTexture6.vScale);\r\n                    }\r\n                    if (this._diffuseTexture7) {\r\n                        this._activeEffect.setTexture(\"diffuse7Sampler\", this._diffuseTexture7);\r\n                        this._activeEffect.setFloat2(\"diffuse7Infos\", this._diffuseTexture7.uScale, this._diffuseTexture7.vScale);\r\n                    }\r\n                    if (this._diffuseTexture8) {\r\n                        this._activeEffect.setTexture(\"diffuse8Sampler\", this._diffuseTexture8);\r\n                        this._activeEffect.setFloat2(\"diffuse8Infos\", this._diffuseTexture8.uScale, this._diffuseTexture8.vScale);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this.diffuseColor, this.alpha * mesh.visibility);\r\n\r\n        if (defines.SPECULARTERM) {\r\n            this._activeEffect.setColor4(\"vSpecularColor\", this.specularColor, this.specularPower);\r\n        }\r\n\r\n        if (scene.lightsEnabled && !this.disableLighting) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, this.maxSimultaneousLights);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        var results = [];\r\n\r\n        if (this._mixTexture1 && this._mixTexture1.animations && this._mixTexture1.animations.length > 0) {\r\n            results.push(this._mixTexture1);\r\n        }\r\n\r\n        if (this._mixTexture2 && this._mixTexture2.animations && this._mixTexture2.animations.length > 0) {\r\n            results.push(this._mixTexture2);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    public getActiveTextures(): BaseTexture[] {\r\n        var activeTextures = super.getActiveTextures();\r\n\r\n        // Mix map 1\r\n        if (this._mixTexture1) {\r\n            activeTextures.push(this._mixTexture1);\r\n        }\r\n\r\n        if (this._diffuseTexture1) {\r\n            activeTextures.push(this._diffuseTexture1);\r\n        }\r\n\r\n        if (this._diffuseTexture2) {\r\n            activeTextures.push(this._diffuseTexture2);\r\n        }\r\n\r\n        if (this._diffuseTexture3) {\r\n            activeTextures.push(this._diffuseTexture3);\r\n        }\r\n\r\n        if (this._diffuseTexture4) {\r\n            activeTextures.push(this._diffuseTexture4);\r\n        }\r\n\r\n        // Mix map 2\r\n        if (this._mixTexture2) {\r\n            activeTextures.push(this._mixTexture2);\r\n        }\r\n\r\n        if (this._diffuseTexture5) {\r\n            activeTextures.push(this._diffuseTexture5);\r\n        }\r\n\r\n        if (this._diffuseTexture6) {\r\n            activeTextures.push(this._diffuseTexture6);\r\n        }\r\n\r\n        if (this._diffuseTexture7) {\r\n            activeTextures.push(this._diffuseTexture7);\r\n        }\r\n\r\n        if (this._diffuseTexture8) {\r\n            activeTextures.push(this._diffuseTexture8);\r\n        }\r\n\r\n        return activeTextures;\r\n    }\r\n\r\n    public hasTexture(texture: BaseTexture): boolean {\r\n        if (super.hasTexture(texture)) {\r\n            return true;\r\n        }\r\n\r\n        // Mix map 1\r\n        if (this._mixTexture1 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture1 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture2 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture3 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture4 === texture) {\r\n            return true;\r\n        }\r\n\r\n        // Mix map 2\r\n        if (this._mixTexture2 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture5 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture6 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture7 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture8 === texture) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        if (this._mixTexture1) {\r\n            this._mixTexture1.dispose();\r\n        }\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): MixMaterial {\r\n        return SerializationHelper.Clone(() => new MixMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.MixMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"MixMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): MixMaterial {\r\n        return SerializationHelper.Parse(() => new MixMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n#ifdef SPECULARTERM\\nuniform vec4 vSpecularColor;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n\\n#ifdef DIFFUSE\\nvarying vec2 vTextureUV;\\nuniform sampler2D mixMap1Sampler;\\nuniform vec2 vTextureInfos;\\n#ifdef MIXMAP2\\nuniform sampler2D mixMap2Sampler;\\n#endif\\nuniform sampler2D diffuse1Sampler;\\nuniform sampler2D diffuse2Sampler;\\nuniform sampler2D diffuse3Sampler;\\nuniform sampler2D diffuse4Sampler;\\nuniform vec2 diffuse1Infos;\\nuniform vec2 diffuse2Infos;\\nuniform vec2 diffuse3Infos;\\nuniform vec2 diffuse4Infos;\\n#ifdef MIXMAP2\\nuniform sampler2D diffuse5Sampler;\\nuniform sampler2D diffuse6Sampler;\\nuniform sampler2D diffuse7Sampler;\\nuniform sampler2D diffuse8Sampler;\\nuniform vec2 diffuse5Infos;\\nuniform vec2 diffuse6Infos;\\nuniform vec2 diffuse7Infos;\\nuniform vec2 diffuse8Infos;\\n#endif\\n#endif\\n\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\nvoid main(void) {\\n\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 finalMixColor=vec4(1.,1.,1.,1.);\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n#ifdef MIXMAP2\\nvec4 mixColor2=vec4(1.,1.,1.,1.);\\n#endif\\n#ifdef SPECULARTERM\\nfloat glossiness=vSpecularColor.a;\\nvec3 specularColor=vSpecularColor.rgb;\\n#else\\nfloat glossiness=0.;\\n#endif\\n\\nfloat alpha=vDiffuseColor.a;\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n#ifdef DIFFUSE\\nvec4 mixColor=texture2D(mixMap1Sampler,vTextureUV);\\n#include<depthPrePass>\\nmixColor.rgb*=vTextureInfos.y;\\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\\nvec4 diffuse4Color=texture2D(diffuse4Sampler,vTextureUV*diffuse4Infos);\\ndiffuse1Color.rgb*=mixColor.r;\\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,mixColor.g);\\ndiffuse3Color.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,mixColor.b);\\nfinalMixColor.rgb=mix(diffuse3Color.rgb,diffuse4Color.rgb,1.0-mixColor.a);\\n#ifdef MIXMAP2\\nmixColor=texture2D(mixMap2Sampler,vTextureUV);\\nmixColor.rgb*=vTextureInfos.y;\\nvec4 diffuse5Color=texture2D(diffuse5Sampler,vTextureUV*diffuse5Infos);\\nvec4 diffuse6Color=texture2D(diffuse6Sampler,vTextureUV*diffuse6Infos);\\nvec4 diffuse7Color=texture2D(diffuse7Sampler,vTextureUV*diffuse7Infos);\\nvec4 diffuse8Color=texture2D(diffuse8Sampler,vTextureUV*diffuse8Infos);\\ndiffuse5Color.rgb=mix(finalMixColor.rgb,diffuse5Color.rgb,mixColor.r);\\ndiffuse6Color.rgb=mix(diffuse5Color.rgb,diffuse6Color.rgb,mixColor.g);\\ndiffuse7Color.rgb=mix(diffuse6Color.rgb,diffuse7Color.rgb,mixColor.b);\\nfinalMixColor.rgb=mix(diffuse7Color.rgb,diffuse8Color.rgb,1.0-mixColor.a);\\n#endif\\n#endif\\n#ifdef VERTEXCOLOR\\nfinalMixColor.rgb*=vColor.rgb;\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\n#ifdef SPECULARTERM\\nvec3 specularBase=vec3(0.,0.,0.);\\n#endif\\n#include<lightFragment>[0..maxSimultaneousLights]\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\n#ifdef SPECULARTERM\\nvec3 finalSpecular=specularBase*specularColor;\\n#else\\nvec3 finalSpecular=vec3(0.0);\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*finalMixColor.rgb,0.0,1.0);\\n\\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\\n\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vTextureUV;\\nuniform mat4 textureMatrix;\\nuniform vec2 vTextureInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef DIFFUSE\\nif (vTextureInfos.x == 0.)\\n{\\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\\n}\\nelse\\n{\\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\\n}\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./normalMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, BaseTexture, expandToProperty, serializeAsColor3, Color3, serialize, Scene, Nullable, AbstractMesh, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"normalPixelShader\"] = require(\"./normal.fragment.fx\");\r\nEffect.ShadersStore[\"normalVertexShader\"] = require(\"./normal.vertex.fx\");\r\n\r\nclass NormalMaterialDefines extends MaterialDefines {\r\n    public DIFFUSE = false;\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public DEPTHPREPASS = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public LIGHT0 = false;\r\n    public LIGHT1 = false;\r\n    public LIGHT2 = false;\r\n    public LIGHT3 = false;\r\n    public SPOTLIGHT0 = false;\r\n    public SPOTLIGHT1 = false;\r\n    public SPOTLIGHT2 = false;\r\n    public SPOTLIGHT3 = false;\r\n    public HEMILIGHT0 = false;\r\n    public HEMILIGHT1 = false;\r\n    public HEMILIGHT2 = false;\r\n    public HEMILIGHT3 = false;\r\n    public DIRLIGHT0 = false;\r\n    public DIRLIGHT1 = false;\r\n    public DIRLIGHT2 = false;\r\n    public DIRLIGHT3 = false;\r\n    public POINTLIGHT0 = false;\r\n    public POINTLIGHT1 = false;\r\n    public POINTLIGHT2 = false;\r\n    public POINTLIGHT3 = false;\r\n    public SHADOW0 = false;\r\n    public SHADOW1 = false;\r\n    public SHADOW2 = false;\r\n    public SHADOW3 = false;\r\n    public SHADOWS = false;\r\n    public SHADOWESM0 = false;\r\n    public SHADOWESM1 = false;\r\n    public SHADOWESM2 = false;\r\n    public SHADOWESM3 = false;\r\n    public SHADOWPOISSON0 = false;\r\n    public SHADOWPOISSON1 = false;\r\n    public SHADOWPOISSON2 = false;\r\n    public SHADOWPOISSON3 = false;\r\n    public SHADOWPCF0 = false;\r\n    public SHADOWPCF1 = false;\r\n    public SHADOWPCF2 = false;\r\n    public SHADOWPCF3 = false;\r\n    public SHADOWPCSS0 = false;\r\n    public SHADOWPCSS1 = false;\r\n    public SHADOWPCSS2 = false;\r\n    public SHADOWPCSS3 = false;\r\n    public NORMAL = false;\r\n    public UV1 = false;\r\n    public UV2 = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class NormalMaterial extends PushMaterial {\r\n    @serializeAsTexture(\"diffuseTexture\")\r\n    private _diffuseTexture: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture: BaseTexture;\r\n\r\n    @serializeAsColor3()\r\n    public diffuseColor = new Color3(1, 1, 1);\r\n\r\n    @serialize(\"disableLighting\")\r\n    private _disableLighting = false;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public disableLighting: boolean;\r\n\r\n    @serialize(\"maxSimultaneousLights\")\r\n    private _maxSimultaneousLights = 4;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public maxSimultaneousLights: number;\r\n\r\n    private _renderId: number;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new NormalMaterialDefines();\r\n        }\r\n\r\n        var defines = <NormalMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Textures\r\n        if (defines._areTexturesDirty) {\r\n            defines._needUVs = false;\r\n            if (scene.texturesEnabled) {\r\n                if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                    if (!this._diffuseTexture.isReady()) {\r\n                        return false;\r\n                    } else {\r\n                        defines._needUVs = true;\r\n                        defines.DIFFUSE = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Misc.\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        // Lights\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights, this._disableLighting);\r\n\r\n        // Values that need to be evaluated on every frame\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            if (defines.UV1) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n            }\r\n\r\n            if (defines.UV2) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            var shaderName = \"normal\";\r\n            var join = defines.toString();\r\n\r\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                \"vDiffuseInfos\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"diffuseMatrix\"\r\n            ];\r\n            var samplers = [\"diffuseSampler\"];\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: 4\r\n            });\r\n\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: 4 }\r\n                }, engine), defines);\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <NormalMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n            // Textures\r\n            if (this.diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                this._activeEffect.setTexture(\"diffuseSampler\", this.diffuseTexture);\r\n\r\n                this._activeEffect.setFloat2(\"vDiffuseInfos\", this.diffuseTexture.coordinatesIndex, this.diffuseTexture.level);\r\n                this._activeEffect.setMatrix(\"diffuseMatrix\", this.diffuseTexture.getTextureMatrix());\r\n            }\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this.diffuseColor, this.alpha * mesh.visibility);\r\n\r\n        // Lights\r\n        if (scene.lightsEnabled && !this.disableLighting) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        var results = [];\r\n\r\n        if (this.diffuseTexture && this.diffuseTexture.animations && this.diffuseTexture.animations.length > 0) {\r\n            results.push(this.diffuseTexture);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    public getActiveTextures(): BaseTexture[] {\r\n        var activeTextures = super.getActiveTextures();\r\n\r\n        if (this._diffuseTexture) {\r\n            activeTextures.push(this._diffuseTexture);\r\n        }\r\n\r\n        return activeTextures;\r\n    }\r\n\r\n    public hasTexture(texture: BaseTexture): boolean {\r\n        if (super.hasTexture(texture)) {\r\n            return true;\r\n        }\r\n\r\n        if (this.diffuseTexture === texture) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        if (this.diffuseTexture) {\r\n            this.diffuseTexture.dispose();\r\n        }\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): NormalMaterial {\r\n        return SerializationHelper.Clone(() => new NormalMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.NormalMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"NormalMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): NormalMaterial {\r\n        return SerializationHelper.Parse(() => new NormalMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0]\\n#include<__decl__lightFragment>[1]\\n#include<__decl__lightFragment>[2]\\n#include<__decl__lightFragment>[3]\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform sampler2D diffuseSampler;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\nvoid main(void) {\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=vec4(1.,1.,1.,1.);\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n\\nfloat alpha=vDiffuseColor.a;\\n#ifdef DIFFUSE\\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\nbaseColor.rgb*=vDiffuseInfos.y;\\n#endif\\n#ifdef NORMAL\\nbaseColor=mix(baseColor,vec4(vNormalW,1.0),0.5);\\n#endif\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\nfloat glossiness=0.;\\n#include<lightFragment>[0]\\n#include<lightFragment>[1]\\n#include<lightFragment>[2]\\n#include<lightFragment>[3]\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\\n\\nvec4 color=vec4(finalDiffuse,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform mat4 diffuseMatrix;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef DIFFUSE\\nif (vDiffuseInfos.x == 0.)\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\\n}\\nelse\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\\n}\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./shadowOnlyMaterial\";","import { Effect, MaterialDefines, PushMaterial, IShadowLight, Scene, Nullable, BaseTexture, AbstractMesh, SubMesh, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"shadowOnlyPixelShader\"] = require(\"./shadowOnly.fragment.fx\");\r\nEffect.ShadersStore[\"shadowOnlyVertexShader\"] = require(\"./shadowOnly.vertex.fx\");\r\n\r\nclass ShadowOnlyMaterialDefines extends MaterialDefines {\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public NORMAL = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class ShadowOnlyMaterial extends PushMaterial {\r\n    private _renderId: number;\r\n    private _activeLight: IShadowLight;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public shadowColor = BABYLON.Color3.Black();\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return true;\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    public get activeLight(): IShadowLight {\r\n        return this._activeLight;\r\n    }\r\n\r\n    public set activeLight(light: IShadowLight) {\r\n        this._activeLight = light;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new ShadowOnlyMaterialDefines();\r\n        }\r\n\r\n        var defines = <ShadowOnlyMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Ensure that active light is the first shadow light\r\n        if (this._activeLight) {\r\n            for (var light of mesh._lightSources) {\r\n                if (light.shadowEnabled) {\r\n                    if (this._activeLight === light) {\r\n                        break; // We are good\r\n                    }\r\n\r\n                    var lightPosition = mesh._lightSources.indexOf(this._activeLight);\r\n\r\n                    if (lightPosition !== -1) {\r\n                        mesh._lightSources.splice(lightPosition, 1);\r\n                        mesh._lightSources.splice(0, 0, this._activeLight);\r\n                    }\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, 1);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, false, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, 1);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            var shaderName = \"shadowOnly\";\r\n            var join = defines.toString();\r\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\", \"alpha\", \"shadowColor\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\"\r\n            ];\r\n            var samplers = new Array<string>();\r\n\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: 1\r\n            });\r\n\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: 1 }\r\n                }, engine), defines);\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <ShadowOnlyMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            this._activeEffect.setFloat(\"alpha\", this.alpha);\r\n            this._activeEffect.setColor3(\"shadowColor\", this.shadowColor);\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        // Lights\r\n        if (scene.lightsEnabled) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, 1);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public clone(name: string): ShadowOnlyMaterial {\r\n        return SerializationHelper.Clone<ShadowOnlyMaterial>(() => new ShadowOnlyMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.ShadowOnlyMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"ShadowOnlyMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): ShadowOnlyMaterial {\r\n        return SerializationHelper.Parse(() => new ShadowOnlyMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform float alpha;\\nuniform vec3 shadowColor;\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\nvoid main(void) {\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\nfloat glossiness=0.;\\n#include<lightFragment>[0..1]\\n\\nvec4 color=vec4(shadowColor,(1.0-clamp(shadow,0.,1.))*alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./simpleMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, BaseTexture, expandToProperty, serializeAsColor3, Color3, serialize, Scene, Nullable, AbstractMesh, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"simplePixelShader\"] = require(\"./simple.fragment.fx\");\r\nEffect.ShadersStore[\"simpleVertexShader\"] = require(\"./simple.vertex.fx\");\r\n\r\nclass SimpleMaterialDefines extends MaterialDefines {\r\n    public DIFFUSE = false;\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public DEPTHPREPASS = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public NORMAL = false;\r\n    public UV1 = false;\r\n    public UV2 = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class SimpleMaterial extends PushMaterial {\r\n    @serializeAsTexture(\"diffuseTexture\")\r\n    private _diffuseTexture: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture: BaseTexture;\r\n\r\n    @serializeAsColor3(\"diffuse\")\r\n    public diffuseColor = new Color3(1, 1, 1);\r\n\r\n    @serialize(\"disableLighting\")\r\n    private _disableLighting = false;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public disableLighting: boolean;\r\n\r\n    @serialize(\"maxSimultaneousLights\")\r\n    private _maxSimultaneousLights = 4;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public maxSimultaneousLights: number;\r\n\r\n    private _renderId: number;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new SimpleMaterialDefines();\r\n        }\r\n\r\n        var defines = <SimpleMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Textures\r\n        if (defines._areTexturesDirty) {\r\n            defines._needUVs = false;\r\n            if (scene.texturesEnabled) {\r\n                if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                    if (!this._diffuseTexture.isReady()) {\r\n                        return false;\r\n                    } else {\r\n                        defines._needUVs = true;\r\n                        defines.DIFFUSE = true;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Misc.\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        // Lights\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights, this._disableLighting);\r\n\r\n        // Values that need to be evaluated on every frame\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, this.maxSimultaneousLights);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            if (defines.UV1) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n            }\r\n\r\n            if (defines.UV2) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            var shaderName = \"simple\";\r\n            var join = defines.toString();\r\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                \"vDiffuseInfos\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"diffuseMatrix\"\r\n            ];\r\n            var samplers = [\"diffuseSampler\"];\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: this.maxSimultaneousLights\r\n            });\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: this._maxSimultaneousLights - 1 }\r\n                }, engine), defines);\r\n\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <SimpleMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n            // Textures\r\n            if (this._diffuseTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                this._activeEffect.setTexture(\"diffuseSampler\", this._diffuseTexture);\r\n\r\n                this._activeEffect.setFloat2(\"vDiffuseInfos\", this._diffuseTexture.coordinatesIndex, this._diffuseTexture.level);\r\n                this._activeEffect.setMatrix(\"diffuseMatrix\", this._diffuseTexture.getTextureMatrix());\r\n            }\r\n\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this.diffuseColor, this.alpha * mesh.visibility);\r\n\r\n        // Lights\r\n        if (scene.lightsEnabled && !this.disableLighting) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, this.maxSimultaneousLights);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        var results = [];\r\n\r\n        if (this._diffuseTexture && this._diffuseTexture.animations && this._diffuseTexture.animations.length > 0) {\r\n            results.push(this._diffuseTexture);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    public getActiveTextures(): BaseTexture[] {\r\n        var activeTextures = super.getActiveTextures();\r\n\r\n        if (this._diffuseTexture) {\r\n            activeTextures.push(this._diffuseTexture);\r\n        }\r\n\r\n        return activeTextures;\r\n    }\r\n\r\n    public hasTexture(texture: BaseTexture): boolean {\r\n        if (super.hasTexture(texture)) {\r\n            return true;\r\n        }\r\n\r\n        if (this.diffuseTexture === texture) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        if (this._diffuseTexture) {\r\n            this._diffuseTexture.dispose();\r\n        }\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): SimpleMaterial {\r\n        return SerializationHelper.Clone<SimpleMaterial>(() => new SimpleMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.SimpleMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"SimpleMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): SimpleMaterial {\r\n        return SerializationHelper.Parse(() => new SimpleMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform sampler2D diffuseSampler;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\nvoid main(void) {\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=vec4(1.,1.,1.,1.);\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n\\nfloat alpha=vDiffuseColor.a;\\n#ifdef DIFFUSE\\nbaseColor=texture2D(diffuseSampler,vDiffuseUV);\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\nbaseColor.rgb*=vDiffuseInfos.y;\\n#endif\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\nfloat glossiness=0.;\\n#ifdef SPECULARTERM\\nvec3 specularBase=vec3(0.,0.,0.);\\n#endif \\n#include<lightFragment>[0..maxSimultaneousLights]\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\\n\\nvec4 color=vec4(finalDiffuse,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vDiffuseUV;\\nuniform mat4 diffuseMatrix;\\nuniform vec2 vDiffuseInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef DIFFUSE\\nif (vDiffuseInfos.x == 0.)\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv,1.0,0.0));\\n}\\nelse\\n{\\nvDiffuseUV=vec2(diffuseMatrix*vec4(uv2,1.0,0.0));\\n}\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./skyMaterial\";","import { Effect, MaterialDefines, PushMaterial, serialize, serializeAsVector3, Vector3, Scene, Nullable, BaseTexture, AbstractMesh, SubMesh, MaterialHelper, EffectFallbacks, VertexBuffer, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"skyPixelShader\"] = require(\"./sky.fragment.fx\");\r\nEffect.ShadersStore[\"skyVertexShader\"] = require(\"./sky.vertex.fx\");\r\n\r\nclass SkyMaterialDefines extends MaterialDefines {\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class SkyMaterial extends PushMaterial {\r\n    // Public members\r\n    @serialize()\r\n    public luminance: number = 1.0;\r\n\r\n    @serialize()\r\n    public turbidity: number = 10.0;\r\n\r\n    @serialize()\r\n    public rayleigh: number = 2.0;\r\n\r\n    @serialize()\r\n    public mieCoefficient: number = 0.005;\r\n\r\n    @serialize()\r\n    public mieDirectionalG: number = 0.8;\r\n\r\n    @serialize()\r\n    public distance: number = 500;\r\n\r\n    @serialize()\r\n    public inclination: number = 0.49;\r\n\r\n    @serialize()\r\n    public azimuth: number = 0.25;\r\n\r\n    @serializeAsVector3()\r\n    public sunPosition: Vector3 = new Vector3(0, 100, 0);\r\n\r\n    @serialize()\r\n    public useSunPosition: boolean = false;\r\n\r\n    // Private members\r\n    private _cameraPosition: Vector3 = Vector3.Zero();\r\n\r\n    private _renderId: number;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new SkyMaterialDefines();\r\n        }\r\n\r\n        var defines = <SkyMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, false, defines);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, false);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            var shaderName = \"sky\";\r\n\r\n            var join = defines.toString();\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                attribs,\r\n                [\"world\", \"viewProjection\", \"view\",\r\n                    \"vFogInfos\", \"vFogColor\", \"pointSize\", \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\",\r\n                    \"luminance\", \"turbidity\", \"rayleigh\", \"mieCoefficient\", \"mieDirectionalG\", \"sunPosition\",\r\n                    \"cameraPosition\"\r\n                ],\r\n                [],\r\n                join, fallbacks, this.onCompiled, this.onError), defines);\r\n        }\r\n\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <SkyMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n\r\n            BABYLON.MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        // Sky\r\n        var camera = scene.activeCamera;\r\n        if (camera) {\r\n            var cameraWorldMatrix = camera.getWorldMatrix();\r\n            this._cameraPosition.x = cameraWorldMatrix.m[12];\r\n            this._cameraPosition.y = cameraWorldMatrix.m[13];\r\n            this._cameraPosition.z = cameraWorldMatrix.m[14];\r\n            this._activeEffect.setVector3(\"cameraPosition\", this._cameraPosition);\r\n        }\r\n\r\n        if (this.luminance > 0) {\r\n            this._activeEffect.setFloat(\"luminance\", this.luminance);\r\n        }\r\n\r\n        this._activeEffect.setFloat(\"turbidity\", this.turbidity);\r\n        this._activeEffect.setFloat(\"rayleigh\", this.rayleigh);\r\n        this._activeEffect.setFloat(\"mieCoefficient\", this.mieCoefficient);\r\n        this._activeEffect.setFloat(\"mieDirectionalG\", this.mieDirectionalG);\r\n\r\n        if (!this.useSunPosition) {\r\n            var theta = Math.PI * (this.inclination - 0.5);\r\n            var phi = 2 * Math.PI * (this.azimuth - 0.5);\r\n\r\n            this.sunPosition.x = this.distance * Math.cos(phi);\r\n            this.sunPosition.y = this.distance * Math.sin(phi) * Math.sin(theta);\r\n            this.sunPosition.z = this.distance * Math.sin(phi) * Math.cos(theta);\r\n        }\r\n\r\n        this._activeEffect.setVector3(\"sunPosition\", this.sunPosition);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        return [];\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): SkyMaterial {\r\n        return SerializationHelper.Clone<SkyMaterial>(() => new SkyMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType  = \"BABYLON.SkyMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"SkyMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): SkyMaterial {\r\n        return SerializationHelper.Parse(() => new SkyMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nvarying vec3 vPositionW;\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneFragmentDeclaration>\\n\\nuniform vec3 cameraPosition;\\nuniform float luminance;\\nuniform float turbidity;\\nuniform float rayleigh;\\nuniform float mieCoefficient;\\nuniform float mieDirectionalG;\\nuniform vec3 sunPosition;\\n\\n#include<fogFragmentDeclaration>\\n\\nconst float e=2.71828182845904523536028747135266249775724709369995957;\\nconst float pi=3.141592653589793238462643383279502884197169;\\nconst float n=1.0003;\\nconst float N=2.545E25;\\nconst float pn=0.035;\\nconst vec3 lambda=vec3(680E-9,550E-9,450E-9);\\nconst vec3 K=vec3(0.686,0.678,0.666);\\nconst float v=4.0;\\nconst float rayleighZenithLength=8.4E3;\\nconst float mieZenithLength=1.25E3;\\nconst vec3 up=vec3(0.0,1.0,0.0);\\nconst float EE=1000.0;\\nconst float sunAngularDiameterCos=0.999956676946448443553574619906976478926848692873900859324;\\nconst float cutoffAngle=pi/1.95;\\nconst float steepness=1.5;\\nvec3 totalRayleigh(vec3 lambda)\\n{\\nreturn (8.0*pow(pi,3.0)*pow(pow(n,2.0)-1.0,2.0)*(6.0+3.0*pn))/(3.0*N*pow(lambda,vec3(4.0))*(6.0-7.0*pn));\\n}\\nvec3 simplifiedRayleigh()\\n{\\nreturn 0.0005/vec3(94,40,18);\\n}\\nfloat rayleighPhase(float cosTheta)\\n{ \\nreturn (3.0/(16.0*pi))*(1.0+pow(cosTheta,2.0));\\n}\\nvec3 totalMie(vec3 lambda,vec3 K,float T)\\n{\\nfloat c=(0.2*T )*10E-18;\\nreturn 0.434*c*pi*pow((2.0*pi)/lambda,vec3(v-2.0))*K;\\n}\\nfloat hgPhase(float cosTheta,float g)\\n{\\nreturn (1.0/(4.0*pi))*((1.0-pow(g,2.0))/pow(1.0-2.0*g*cosTheta+pow(g,2.0),1.5));\\n}\\nfloat sunIntensity(float zenithAngleCos)\\n{\\nreturn EE*max(0.0,1.0-exp((-(cutoffAngle-acos(zenithAngleCos))/steepness)));\\n}\\nfloat A=0.15;\\nfloat B=0.50;\\nfloat C=0.10;\\nfloat D=0.20;\\nfloat EEE=0.02;\\nfloat F=0.30;\\nfloat W=1000.0;\\nvec3 Uncharted2Tonemap(vec3 x)\\n{\\nreturn ((x*(A*x+C*B)+D*EEE)/(x*(A*x+B)+D*F))-EEE/F;\\n}\\nvoid main(void) {\\n\\n#include<clipPlaneFragment>\\n\\nfloat sunfade=1.0-clamp(1.0-exp((sunPosition.y/450000.0)),0.0,1.0);\\nfloat rayleighCoefficient=rayleigh-(1.0*(1.0-sunfade));\\nvec3 sunDirection=normalize(sunPosition);\\nfloat sunE=sunIntensity(dot(sunDirection,up));\\nvec3 betaR=simplifiedRayleigh()*rayleighCoefficient;\\nvec3 betaM=totalMie(lambda,K,turbidity)*mieCoefficient;\\nfloat zenithAngle=acos(max(0.0,dot(up,normalize(vPositionW-cameraPosition))));\\nfloat sR=rayleighZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\\nfloat sM=mieZenithLength/(cos(zenithAngle)+0.15*pow(93.885-((zenithAngle*180.0)/pi),-1.253));\\nvec3 Fex=exp(-(betaR*sR+betaM*sM));\\nfloat cosTheta=dot(normalize(vPositionW-cameraPosition),sunDirection);\\nfloat rPhase=rayleighPhase(cosTheta*0.5+0.5);\\nvec3 betaRTheta=betaR*rPhase;\\nfloat mPhase=hgPhase(cosTheta,mieDirectionalG);\\nvec3 betaMTheta=betaM*mPhase;\\nvec3 Lin=pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*(1.0-Fex),vec3(1.5));\\nLin*=mix(vec3(1.0),pow(sunE*((betaRTheta+betaMTheta)/(betaR+betaM))*Fex,vec3(1.0/2.0)),clamp(pow(1.0-dot(up,sunDirection),5.0),0.0,1.0));\\nvec3 direction=normalize(vPositionW-cameraPosition);\\nfloat theta=acos(direction.y);\\nfloat phi=atan(direction.z,direction.x);\\nvec2 uv=vec2(phi,theta)/vec2(2.0*pi,pi)+vec2(0.5,0.0);\\nvec3 L0=vec3(0.1)*Fex;\\nfloat sundisk=smoothstep(sunAngularDiameterCos,sunAngularDiameterCos+0.00002,cosTheta);\\nL0+=(sunE*19000.0*Fex)*sundisk;\\nvec3 whiteScale=1.0/Uncharted2Tonemap(vec3(W));\\nvec3 texColor=(Lin+L0); \\ntexColor*=0.04 ;\\ntexColor+=vec3(0.0,0.001,0.0025)*0.3;\\nfloat g_fMaxLuminance=1.0;\\nfloat fLumScaled=0.1/luminance; \\nfloat fLumCompressed=(fLumScaled*(1.0+(fLumScaled/(g_fMaxLuminance*g_fMaxLuminance))))/(1.0+fLumScaled); \\nfloat ExposureBias=fLumCompressed;\\nvec3 curr=Uncharted2Tonemap((log2(2.0/pow(luminance,4.0)))*texColor);\\n\\n\\n\\nvec3 retColor=curr*whiteScale;\\n\\n\\nfloat alpha=1.0;\\n#ifdef VERTEXCOLOR\\nretColor.rgb*=vColor.rgb;\\n#endif\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\n\\nvec4 color=clamp(vec4(retColor.rgb,alpha),0.0,1.0);\\n\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\\n\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n\\nuniform mat4 world;\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\nvoid main(void) {\\ngl_Position=viewProjection*world*vec4(position,1.0);\\nvec4 worldPos=world*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./terrainMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, BaseTexture, expandToProperty, Texture, serializeAsColor3, Color3, serialize, Scene, Nullable, AbstractMesh, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"terrainPixelShader\"] = require(\"./terrain.fragment.fx\");\r\nEffect.ShadersStore[\"terrainVertexShader\"] = require(\"./terrain.vertex.fx\");\r\n\r\nclass TerrainMaterialDefines extends MaterialDefines {\r\n    public DIFFUSE = false;\r\n    public BUMP = false;\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public DEPTHPREPASS = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public SPECULARTERM = false;\r\n    public NORMAL = false;\r\n    public UV1 = false;\r\n    public UV2 = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class TerrainMaterial extends PushMaterial {\r\n    @serializeAsTexture(\"mixTexture\")\r\n    private _mixTexture: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public mixTexture: BaseTexture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture1\")\r\n    private _diffuseTexture1: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture1: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture2\")\r\n    private _diffuseTexture2: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture2: Texture;\r\n\r\n    @serializeAsTexture(\"diffuseTexture3\")\r\n    private _diffuseTexture3: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTexture3: Texture;\r\n\r\n    @serializeAsTexture(\"bumpTexture1\")\r\n    private _bumpTexture1: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public bumpTexture1: Texture;\r\n\r\n    @serializeAsTexture(\"bumpTexture2\")\r\n    private _bumpTexture2: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public bumpTexture2: Texture;\r\n\r\n    @serializeAsTexture(\"bumpTexture3\")\r\n    private _bumpTexture3: Texture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public bumpTexture3: Texture;\r\n\r\n    @serializeAsColor3()\r\n    public diffuseColor = new Color3(1, 1, 1);\r\n\r\n    @serializeAsColor3()\r\n    public specularColor = new Color3(0, 0, 0);\r\n\r\n    @serialize()\r\n    public specularPower = 64;\r\n\r\n    @serialize(\"disableLighting\")\r\n    private _disableLighting = false;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public disableLighting: boolean;\r\n\r\n    @serialize(\"maxSimultaneousLights\")\r\n    private _maxSimultaneousLights = 4;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public maxSimultaneousLights: number;\r\n\r\n    private _renderId: number;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new TerrainMaterialDefines();\r\n        }\r\n\r\n        var defines = <TerrainMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Textures\r\n        if (scene.texturesEnabled) {\r\n            if (this.mixTexture && StandardMaterial.DiffuseTextureEnabled) {\r\n                if (!this.mixTexture.isReady()) {\r\n                    return false;\r\n                } else {\r\n                    defines._needUVs = true;\r\n                    defines.DIFFUSE = true;\r\n                }\r\n            }\r\n            if ((this.bumpTexture1 || this.bumpTexture2 || this.bumpTexture3) && StandardMaterial.BumpTextureEnabled) {\r\n                defines._needUVs = true;\r\n                defines._needNormals = true;\r\n                defines.BUMP = true;\r\n            }\r\n        }\r\n\r\n        // Misc.\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        // Lights\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights, this._disableLighting);\r\n\r\n        // Values that need to be evaluated on every frame\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, this.maxSimultaneousLights);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            if (defines.UV1) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n            }\r\n\r\n            if (defines.UV2) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            // Legacy browser patch\r\n            var shaderName = \"terrain\";\r\n            var join = defines.toString();\r\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\", \"vSpecularColor\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                \"vTextureInfos\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"textureMatrix\",\r\n                \"diffuse1Infos\", \"diffuse2Infos\", \"diffuse3Infos\"\r\n            ];\r\n            var samplers = [\"textureSampler\", \"diffuse1Sampler\", \"diffuse2Sampler\", \"diffuse3Sampler\",\r\n                \"bump1Sampler\", \"bump2Sampler\", \"bump3Sampler\"\r\n            ];\r\n\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: this.maxSimultaneousLights\r\n            });\r\n\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights }\r\n                }, engine), defines);\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <TerrainMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        if (this._mustRebind(scene, effect)) {\r\n            // Textures\r\n            if (this.mixTexture) {\r\n                this._activeEffect.setTexture(\"textureSampler\", this._mixTexture);\r\n                this._activeEffect.setFloat2(\"vTextureInfos\", this._mixTexture.coordinatesIndex, this._mixTexture.level);\r\n                this._activeEffect.setMatrix(\"textureMatrix\", this._mixTexture.getTextureMatrix());\r\n\r\n                if (StandardMaterial.DiffuseTextureEnabled) {\r\n                    if (this._diffuseTexture1) {\r\n                        this._activeEffect.setTexture(\"diffuse1Sampler\", this._diffuseTexture1);\r\n                        this._activeEffect.setFloat2(\"diffuse1Infos\", this._diffuseTexture1.uScale, this._diffuseTexture1.vScale);\r\n                    }\r\n                    if (this._diffuseTexture2) {\r\n                        this._activeEffect.setTexture(\"diffuse2Sampler\", this._diffuseTexture2);\r\n                        this._activeEffect.setFloat2(\"diffuse2Infos\", this._diffuseTexture2.uScale, this._diffuseTexture2.vScale);\r\n                    }\r\n                    if (this._diffuseTexture3) {\r\n                        this._activeEffect.setTexture(\"diffuse3Sampler\", this._diffuseTexture3);\r\n                        this._activeEffect.setFloat2(\"diffuse3Infos\", this._diffuseTexture3.uScale, this._diffuseTexture3.vScale);\r\n                    }\r\n                }\r\n\r\n                if (StandardMaterial.BumpTextureEnabled && scene.getEngine().getCaps().standardDerivatives) {\r\n                    if (this._bumpTexture1) {\r\n                        this._activeEffect.setTexture(\"bump1Sampler\", this._bumpTexture1);\r\n                    }\r\n                    if (this._bumpTexture2) {\r\n                        this._activeEffect.setTexture(\"bump2Sampler\", this._bumpTexture2);\r\n                    }\r\n                    if (this._bumpTexture3) {\r\n                        this._activeEffect.setTexture(\"bump3Sampler\", this._bumpTexture3);\r\n                    }\r\n                }\r\n            }\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this.diffuseColor, this.alpha * mesh.visibility);\r\n\r\n        if (defines.SPECULARTERM) {\r\n            this._activeEffect.setColor4(\"vSpecularColor\", this.specularColor, this.specularPower);\r\n        }\r\n\r\n        if (scene.lightsEnabled && !this.disableLighting) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, this.maxSimultaneousLights);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        var results = [];\r\n\r\n        if (this.mixTexture && this.mixTexture.animations && this.mixTexture.animations.length > 0) {\r\n            results.push(this.mixTexture);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    public getActiveTextures(): BaseTexture[] {\r\n        var activeTextures = super.getActiveTextures();\r\n\r\n        if (this._mixTexture) {\r\n            activeTextures.push(this._mixTexture);\r\n        }\r\n\r\n        if (this._diffuseTexture1) {\r\n            activeTextures.push(this._diffuseTexture1);\r\n        }\r\n\r\n        if (this._diffuseTexture2) {\r\n            activeTextures.push(this._diffuseTexture2);\r\n        }\r\n\r\n        if (this._diffuseTexture3) {\r\n            activeTextures.push(this._diffuseTexture3);\r\n        }\r\n\r\n        if (this._bumpTexture1) {\r\n            activeTextures.push(this._bumpTexture1);\r\n        }\r\n\r\n        if (this._bumpTexture2) {\r\n            activeTextures.push(this._bumpTexture2);\r\n        }\r\n\r\n        if (this._bumpTexture3) {\r\n            activeTextures.push(this._bumpTexture3);\r\n        }\r\n\r\n        return activeTextures;\r\n    }\r\n\r\n    public hasTexture(texture: BaseTexture): boolean {\r\n        if (super.hasTexture(texture)) {\r\n            return true;\r\n        }\r\n\r\n        if (this._mixTexture === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture1 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture2 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTexture3 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._bumpTexture1 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._bumpTexture2 === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._bumpTexture3 === texture) {\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        if (this.mixTexture) {\r\n            this.mixTexture.dispose();\r\n        }\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): TerrainMaterial {\r\n        return SerializationHelper.Clone(() => new TerrainMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.TerrainMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"TerrainMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): TerrainMaterial {\r\n        return SerializationHelper.Parse(() => new TerrainMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n#ifdef SPECULARTERM\\nuniform vec4 vSpecularColor;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n\\n#ifdef DIFFUSE\\nvarying vec2 vTextureUV;\\nuniform sampler2D textureSampler;\\nuniform vec2 vTextureInfos;\\nuniform sampler2D diffuse1Sampler;\\nuniform sampler2D diffuse2Sampler;\\nuniform sampler2D diffuse3Sampler;\\nuniform vec2 diffuse1Infos;\\nuniform vec2 diffuse2Infos;\\nuniform vec2 diffuse3Infos;\\n#endif\\n#ifdef BUMP\\nuniform sampler2D bump1Sampler;\\nuniform sampler2D bump2Sampler;\\nuniform sampler2D bump3Sampler;\\n#endif\\n\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n#include<clipPlaneFragmentDeclaration>\\n\\n#include<fogFragmentDeclaration>\\n\\n#ifdef BUMP\\n#extension GL_OES_standard_derivatives : enable\\n\\nmat3 cotangent_frame(vec3 normal,vec3 p,vec2 uv)\\n{\\n\\nvec3 dp1=dFdx(p);\\nvec3 dp2=dFdy(p);\\nvec2 duv1=dFdx(uv);\\nvec2 duv2=dFdy(uv);\\n\\nvec3 dp2perp=cross(dp2,normal);\\nvec3 dp1perp=cross(normal,dp1);\\nvec3 tangent=dp2perp*duv1.x+dp1perp*duv2.x;\\nvec3 binormal=dp2perp*duv1.y+dp1perp*duv2.y;\\n\\nfloat invmax=inversesqrt(max(dot(tangent,tangent),dot(binormal,binormal)));\\nreturn mat3(tangent*invmax,binormal*invmax,normal);\\n}\\nvec3 perturbNormal(vec3 viewDir,vec3 mixColor)\\n{ \\nvec3 bump1Color=texture2D(bump1Sampler,vTextureUV*diffuse1Infos).xyz;\\nvec3 bump2Color=texture2D(bump2Sampler,vTextureUV*diffuse2Infos).xyz;\\nvec3 bump3Color=texture2D(bump3Sampler,vTextureUV*diffuse3Infos).xyz;\\nbump1Color.rgb*=mixColor.r;\\nbump2Color.rgb=mix(bump1Color.rgb,bump2Color.rgb,mixColor.g);\\nvec3 map=mix(bump2Color.rgb,bump3Color.rgb,mixColor.b);\\nmap=map*255./127.-128./127.;\\nmat3 TBN=cotangent_frame(vNormalW*vTextureInfos.y,-viewDir,vTextureUV);\\nreturn normalize(TBN*map);\\n}\\n#endif\\nvoid main(void) {\\n\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=vec4(1.,1.,1.,1.);\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n#ifdef SPECULARTERM\\nfloat glossiness=vSpecularColor.a;\\nvec3 specularColor=vSpecularColor.rgb;\\n#else\\nfloat glossiness=0.;\\n#endif\\n\\nfloat alpha=vDiffuseColor.a;\\n\\n#ifdef NORMAL\\nvec3 normalW=normalize(vNormalW);\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\n#ifdef DIFFUSE\\nbaseColor=texture2D(textureSampler,vTextureUV);\\n#if defined(BUMP) && defined(DIFFUSE)\\nnormalW=perturbNormal(viewDirectionW,baseColor.rgb);\\n#endif\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\nbaseColor.rgb*=vTextureInfos.y;\\nvec4 diffuse1Color=texture2D(diffuse1Sampler,vTextureUV*diffuse1Infos);\\nvec4 diffuse2Color=texture2D(diffuse2Sampler,vTextureUV*diffuse2Infos);\\nvec4 diffuse3Color=texture2D(diffuse3Sampler,vTextureUV*diffuse3Infos);\\ndiffuse1Color.rgb*=baseColor.r;\\ndiffuse2Color.rgb=mix(diffuse1Color.rgb,diffuse2Color.rgb,baseColor.g);\\nbaseColor.rgb=mix(diffuse2Color.rgb,diffuse3Color.rgb,baseColor.b);\\n#endif\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\n#ifdef SPECULARTERM\\nvec3 specularBase=vec3(0.,0.,0.);\\n#endif\\n#include<lightFragment>[0..maxSimultaneousLights]\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\n#ifdef SPECULARTERM\\nvec3 finalSpecular=specularBase*specularColor;\\n#else\\nvec3 finalSpecular=vec3(0.0);\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor*baseColor.rgb,0.0,1.0);\\n\\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\\n\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSE\\nvarying vec2 vTextureUV;\\nuniform mat4 textureMatrix;\\nuniform vec2 vTextureInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef DIFFUSE\\nif (vTextureInfos.x == 0.)\\n{\\nvTextureUV=vec2(textureMatrix*vec4(uv,1.0,0.0));\\n}\\nelse\\n{\\nvTextureUV=vec2(textureMatrix*vec4(uv2,1.0,0.0));\\n}\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./triPlanarMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, BaseTexture, expandToProperty, serialize, serializeAsColor3, Color3, Scene, Nullable, AbstractMesh, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Matrix, Mesh, IAnimatable, SerializationHelper } from \"babylonjs\";\r\n\r\nEffect.ShadersStore[\"triPlanarPixelShader\"] = require(\"./triPlanar.fragment.fx\");\r\nEffect.ShadersStore[\"triPlanarVertexShader\"] = require(\"./triPlanar.vertex.fx\");\r\n\r\nclass TriPlanarMaterialDefines extends MaterialDefines {\r\n    public DIFFUSEX = false;\r\n    public DIFFUSEY = false;\r\n    public DIFFUSEZ = false;\r\n\r\n    public BUMPX = false;\r\n    public BUMPY = false;\r\n    public BUMPZ = false;\r\n\r\n    public CLIPPLANE = false;\r\n    public CLIPPLANE2 = false;\r\n    public CLIPPLANE3 = false;\r\n    public CLIPPLANE4 = false;\r\n    public ALPHATEST = false;\r\n    public DEPTHPREPASS = false;\r\n    public POINTSIZE = false;\r\n    public FOG = false;\r\n    public SPECULARTERM = false;\r\n    public NORMAL = false;\r\n    public VERTEXCOLOR = false;\r\n    public VERTEXALPHA = false;\r\n    public NUM_BONE_INFLUENCERS = 0;\r\n    public BonesPerMesh = 0;\r\n    public INSTANCES = false;\r\n\r\n    constructor() {\r\n        super();\r\n        this.rebuild();\r\n    }\r\n}\r\n\r\nexport class TriPlanarMaterial extends PushMaterial {\r\n    @serializeAsTexture()\r\n    public mixTexture: BaseTexture;\r\n\r\n    @serializeAsTexture(\"diffuseTextureX\")\r\n    private _diffuseTextureX: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTextureX: BaseTexture;\r\n\r\n    @serializeAsTexture(\"diffuseTexturY\")\r\n    private _diffuseTextureY: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTextureY: BaseTexture;\r\n\r\n    @serializeAsTexture(\"diffuseTextureZ\")\r\n    private _diffuseTextureZ: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public diffuseTextureZ: BaseTexture;\r\n\r\n    @serializeAsTexture(\"normalTextureX\")\r\n    private _normalTextureX: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public normalTextureX: BaseTexture;\r\n\r\n    @serializeAsTexture(\"normalTextureY\")\r\n    private _normalTextureY: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public normalTextureY: BaseTexture;\r\n\r\n    @serializeAsTexture(\"normalTextureZ\")\r\n    private _normalTextureZ: BaseTexture;\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public normalTextureZ: BaseTexture;\r\n\r\n    @serialize()\r\n    public tileSize: number = 1;\r\n\r\n    @serializeAsColor3()\r\n    public diffuseColor = new Color3(1, 1, 1);\r\n\r\n    @serializeAsColor3()\r\n    public specularColor = new Color3(0.2, 0.2, 0.2);\r\n\r\n    @serialize()\r\n    public specularPower = 64;\r\n\r\n    @serialize(\"disableLighting\")\r\n    private _disableLighting = false;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public disableLighting: boolean;\r\n\r\n    @serialize(\"maxSimultaneousLights\")\r\n    private _maxSimultaneousLights = 4;\r\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\r\n    public maxSimultaneousLights: number;\r\n\r\n    private _renderId: number;\r\n\r\n    constructor(name: string, scene: Scene) {\r\n        super(name, scene);\r\n    }\r\n\r\n    public needAlphaBlending(): boolean {\r\n        return (this.alpha < 1.0);\r\n    }\r\n\r\n    public needAlphaTesting(): boolean {\r\n        return false;\r\n    }\r\n\r\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\r\n        return null;\r\n    }\r\n\r\n    // Methods\r\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\r\n        if (this.isFrozen) {\r\n            if (this._wasPreviouslyReady && subMesh.effect) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        if (!subMesh._materialDefines) {\r\n            subMesh._materialDefines = new TriPlanarMaterialDefines();\r\n        }\r\n\r\n        var defines = <TriPlanarMaterialDefines>subMesh._materialDefines;\r\n        var scene = this.getScene();\r\n\r\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\r\n            if (this._renderId === scene.getRenderId()) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        var engine = scene.getEngine();\r\n\r\n        // Textures\r\n        if (defines._areTexturesDirty) {\r\n            if (scene.texturesEnabled) {\r\n                if (StandardMaterial.DiffuseTextureEnabled) {\r\n                    var textures = [this.diffuseTextureX, this.diffuseTextureY, this.diffuseTextureZ];\r\n                    var textureDefines = [\"DIFFUSEX\", \"DIFFUSEY\", \"DIFFUSEZ\"];\r\n\r\n                    for (var i = 0; i < textures.length; i++) {\r\n                        if (textures[i]) {\r\n                            if (!textures[i].isReady()) {\r\n                                return false;\r\n                            } else {\r\n                                (<any>defines)[textureDefines[i]] = true;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                if (StandardMaterial.BumpTextureEnabled) {\r\n                    var textures = [this.normalTextureX, this.normalTextureY, this.normalTextureZ];\r\n                    var textureDefines = [\"BUMPX\", \"BUMPY\", \"BUMPZ\"];\r\n\r\n                    for (var i = 0; i < textures.length; i++) {\r\n                        if (textures[i]) {\r\n                            if (!textures[i].isReady()) {\r\n                                return false;\r\n                            } else {\r\n                                (<any>defines)[textureDefines[i]] = true;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Misc.\r\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, false, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\r\n\r\n        // Lights\r\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, false, this._maxSimultaneousLights, this._disableLighting);\r\n\r\n        // Values that need to be evaluated on every frame\r\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\r\n\r\n        // Attribs\r\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\r\n\r\n        // Get correct effect\r\n        if (defines.isDirty) {\r\n            defines.markAsProcessed();\r\n            scene.resetCachedMaterial();\r\n\r\n            // Fallbacks\r\n            var fallbacks = new EffectFallbacks();\r\n            if (defines.FOG) {\r\n                fallbacks.addFallback(1, \"FOG\");\r\n            }\r\n\r\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, this.maxSimultaneousLights);\r\n\r\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            //Attributes\r\n            var attribs = [VertexBuffer.PositionKind];\r\n\r\n            if (defines.NORMAL) {\r\n                attribs.push(VertexBuffer.NormalKind);\r\n            }\r\n\r\n            if (defines.VERTEXCOLOR) {\r\n                attribs.push(VertexBuffer.ColorKind);\r\n            }\r\n\r\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\r\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\r\n\r\n            // Legacy browser patch\r\n            var shaderName = \"triplanar\";\r\n            var join = defines.toString();\r\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\", \"vSpecularColor\",\r\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\r\n                \"mBones\",\r\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\",\r\n                \"tileSize\"\r\n            ];\r\n            var samplers = [\"diffuseSamplerX\", \"diffuseSamplerY\", \"diffuseSamplerZ\",\r\n                \"normalSamplerX\", \"normalSamplerY\", \"normalSamplerZ\"\r\n            ];\r\n\r\n            var uniformBuffers = new Array<string>();\r\n\r\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\r\n                uniformsNames: uniforms,\r\n                uniformBuffersNames: uniformBuffers,\r\n                samplers: samplers,\r\n                defines: defines,\r\n                maxSimultaneousLights: this.maxSimultaneousLights\r\n            });\r\n\r\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\r\n                <EffectCreationOptions>{\r\n                    attributes: attribs,\r\n                    uniformsNames: uniforms,\r\n                    uniformBuffersNames: uniformBuffers,\r\n                    samplers: samplers,\r\n                    defines: join,\r\n                    fallbacks: fallbacks,\r\n                    onCompiled: this.onCompiled,\r\n                    onError: this.onError,\r\n                    indexParameters: { maxSimultaneousLights: this.maxSimultaneousLights }\r\n                }, engine), defines);\r\n        }\r\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\r\n            return false;\r\n        }\r\n\r\n        this._renderId = scene.getRenderId();\r\n        this._wasPreviouslyReady = true;\r\n\r\n        return true;\r\n    }\r\n\r\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\r\n        var scene = this.getScene();\r\n\r\n        var defines = <TriPlanarMaterialDefines>subMesh._materialDefines;\r\n        if (!defines) {\r\n            return;\r\n        }\r\n\r\n        var effect = subMesh.effect;\r\n        if (!effect) {\r\n            return;\r\n        }\r\n        this._activeEffect = effect;\r\n\r\n        // Matrices\r\n        this.bindOnlyWorldMatrix(world);\r\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n\r\n        // Bones\r\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\r\n\r\n        this._activeEffect.setFloat(\"tileSize\", this.tileSize);\r\n\r\n        if (scene.getCachedMaterial() !== this) {\r\n            // Textures\r\n            if (this.diffuseTextureX) {\r\n                this._activeEffect.setTexture(\"diffuseSamplerX\", this.diffuseTextureX);\r\n            }\r\n            if (this.diffuseTextureY) {\r\n                this._activeEffect.setTexture(\"diffuseSamplerY\", this.diffuseTextureY);\r\n            }\r\n            if (this.diffuseTextureZ) {\r\n                this._activeEffect.setTexture(\"diffuseSamplerZ\", this.diffuseTextureZ);\r\n            }\r\n            if (this.normalTextureX) {\r\n                this._activeEffect.setTexture(\"normalSamplerX\", this.normalTextureX);\r\n            }\r\n            if (this.normalTextureY) {\r\n                this._activeEffect.setTexture(\"normalSamplerY\", this.normalTextureY);\r\n            }\r\n            if (this.normalTextureZ) {\r\n                this._activeEffect.setTexture(\"normalSamplerZ\", this.normalTextureZ);\r\n            }\r\n            // Clip plane\r\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\r\n\r\n            // Point size\r\n            if (this.pointsCloud) {\r\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\r\n            }\r\n\r\n            MaterialHelper.BindEyePosition(effect, scene);\r\n        }\r\n\r\n        this._activeEffect.setColor4(\"vDiffuseColor\", this.diffuseColor, this.alpha * mesh.visibility);\r\n\r\n        if (defines.SPECULARTERM) {\r\n            this._activeEffect.setColor4(\"vSpecularColor\", this.specularColor, this.specularPower);\r\n        }\r\n\r\n        if (scene.lightsEnabled && !this.disableLighting) {\r\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, this.maxSimultaneousLights);\r\n        }\r\n\r\n        // View\r\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\r\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\r\n        }\r\n\r\n        // Fog\r\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\r\n\r\n        this._afterBind(mesh, this._activeEffect);\r\n    }\r\n\r\n    public getAnimatables(): IAnimatable[] {\r\n        var results = [];\r\n\r\n        if (this.mixTexture && this.mixTexture.animations && this.mixTexture.animations.length > 0) {\r\n            results.push(this.mixTexture);\r\n        }\r\n\r\n        return results;\r\n    }\r\n\r\n    public getActiveTextures(): BaseTexture[] {\r\n        var activeTextures = super.getActiveTextures();\r\n\r\n        if (this._diffuseTextureX) {\r\n            activeTextures.push(this._diffuseTextureX);\r\n        }\r\n\r\n        if (this._diffuseTextureY) {\r\n            activeTextures.push(this._diffuseTextureY);\r\n        }\r\n\r\n        if (this._diffuseTextureZ) {\r\n            activeTextures.push(this._diffuseTextureZ);\r\n        }\r\n\r\n        if (this._normalTextureX) {\r\n            activeTextures.push(this._normalTextureX);\r\n        }\r\n\r\n        if (this._normalTextureY) {\r\n            activeTextures.push(this._normalTextureY);\r\n        }\r\n\r\n        if (this._normalTextureZ) {\r\n            activeTextures.push(this._normalTextureZ);\r\n        }\r\n\r\n        return activeTextures;\r\n    }\r\n\r\n    public hasTexture(texture: BaseTexture): boolean {\r\n        if (super.hasTexture(texture)) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTextureX === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTextureY === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._diffuseTextureZ === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._normalTextureX === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._normalTextureY === texture) {\r\n            return true;\r\n        }\r\n\r\n        if (this._normalTextureZ === texture) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n\r\n    public dispose(forceDisposeEffect?: boolean): void {\r\n        if (this.mixTexture) {\r\n            this.mixTexture.dispose();\r\n        }\r\n\r\n        super.dispose(forceDisposeEffect);\r\n    }\r\n\r\n    public clone(name: string): TriPlanarMaterial {\r\n        return SerializationHelper.Clone(() => new TriPlanarMaterial(name, this.getScene()), this);\r\n    }\r\n\r\n    public serialize(): any {\r\n        var serializationObject = SerializationHelper.Serialize(this);\r\n        serializationObject.customType = \"BABYLON.TriPlanarMaterial\";\r\n        return serializationObject;\r\n    }\r\n\r\n    public getClassName(): string {\r\n        return \"TriPlanarMaterial\";\r\n    }\r\n\r\n    // Statics\r\n    public static Parse(source: any, scene: Scene, rootUrl: string): TriPlanarMaterial {\r\n        return SerializationHelper.Parse(() => new TriPlanarMaterial(source.name, scene), source, scene, rootUrl);\r\n    }\r\n}\r\n","module.exports = \"precision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n#ifdef SPECULARTERM\\nuniform vec4 vSpecularColor;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n\\n#ifdef DIFFUSEX\\nvarying vec2 vTextureUVX;\\nuniform sampler2D diffuseSamplerX;\\n#ifdef BUMPX\\nuniform sampler2D normalSamplerX;\\n#endif\\n#endif\\n#ifdef DIFFUSEY\\nvarying vec2 vTextureUVY;\\nuniform sampler2D diffuseSamplerY;\\n#ifdef BUMPY\\nuniform sampler2D normalSamplerY;\\n#endif\\n#endif\\n#ifdef DIFFUSEZ\\nvarying vec2 vTextureUVZ;\\nuniform sampler2D diffuseSamplerZ;\\n#ifdef BUMPZ\\nuniform sampler2D normalSamplerZ;\\n#endif\\n#endif\\n#ifdef NORMAL\\nvarying mat3 tangentSpace;\\n#endif\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n#include<clipPlaneFragmentDeclaration>\\n#include<fogFragmentDeclaration>\\nvoid main(void) {\\n\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=vec4(0.,0.,0.,1.);\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n\\nfloat alpha=vDiffuseColor.a;\\n\\n#ifdef NORMAL\\nvec3 normalW=tangentSpace[2];\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\n#endif\\nvec4 baseNormal=vec4(0.0,0.0,0.0,1.0);\\nnormalW*=normalW;\\n#ifdef DIFFUSEX\\nbaseColor+=texture2D(diffuseSamplerX,vTextureUVX)*normalW.x;\\n#ifdef BUMPX\\nbaseNormal+=texture2D(normalSamplerX,vTextureUVX)*normalW.x;\\n#endif\\n#endif\\n#ifdef DIFFUSEY\\nbaseColor+=texture2D(diffuseSamplerY,vTextureUVY)*normalW.y;\\n#ifdef BUMPY\\nbaseNormal+=texture2D(normalSamplerY,vTextureUVY)*normalW.y;\\n#endif\\n#endif\\n#ifdef DIFFUSEZ\\nbaseColor+=texture2D(diffuseSamplerZ,vTextureUVZ)*normalW.z;\\n#ifdef BUMPZ\\nbaseNormal+=texture2D(normalSamplerZ,vTextureUVZ)*normalW.z;\\n#endif\\n#endif\\n#ifdef NORMAL\\nnormalW=normalize((2.0*baseNormal.xyz-1.0)*tangentSpace);\\n#endif\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\n#include<depthPrePass>\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\n#ifdef SPECULARTERM\\nfloat glossiness=vSpecularColor.a;\\nvec3 specularBase=vec3(0.,0.,0.);\\nvec3 specularColor=vSpecularColor.rgb;\\n#else\\nfloat glossiness=0.;\\n#endif\\n#include<lightFragment>[0..maxSimultaneousLights]\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\n#ifdef SPECULARTERM\\nvec3 finalSpecular=specularBase*specularColor;\\n#else\\nvec3 finalSpecular=vec3(0.0);\\n#endif\\nvec3 finalDiffuse=clamp(diffuseBase*diffuseColor,0.0,1.0)*baseColor.rgb;\\n\\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\\n\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef DIFFUSEX\\nvarying vec2 vTextureUVX;\\n#endif\\n#ifdef DIFFUSEY\\nvarying vec2 vTextureUVY;\\n#endif\\n#ifdef DIFFUSEZ\\nvarying vec2 vTextureUVZ;\\n#endif\\nuniform float tileSize;\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying mat3 tangentSpace;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\nvoid main(void)\\n{\\n#include<instancesVertex>\\n#include<bonesVertex>\\ngl_Position=viewProjection*finalWorld*vec4(position,1.0);\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n#ifdef DIFFUSEX\\nvTextureUVX=worldPos.zy/tileSize;\\n#endif\\n#ifdef DIFFUSEY\\nvTextureUVY=worldPos.xz/tileSize;\\n#endif\\n#ifdef DIFFUSEZ\\nvTextureUVZ=worldPos.xy/tileSize;\\n#endif\\n#ifdef NORMAL\\n\\nvec3 xtan=vec3(0,0,1);\\nvec3 xbin=vec3(0,1,0);\\nvec3 ytan=vec3(1,0,0);\\nvec3 ybin=vec3(0,0,1);\\nvec3 ztan=vec3(1,0,0);\\nvec3 zbin=vec3(0,1,0);\\nvec3 normalizedNormal=normalize(normal);\\nnormalizedNormal*=normalizedNormal;\\nvec3 worldBinormal=normalize(xbin*normalizedNormal.x+ybin*normalizedNormal.y+zbin*normalizedNormal.z);\\nvec3 worldTangent=normalize(xtan*normalizedNormal.x+ytan*normalizedNormal.y+ztan*normalizedNormal.z);\\nworldTangent=(world*vec4(worldTangent,1.0)).xyz;\\nworldBinormal=(world*vec4(worldBinormal,1.0)).xyz;\\nvec3 worldNormal=normalize(cross(worldTangent,worldBinormal));\\ntangentSpace[0]=worldTangent;\\ntangentSpace[1]=worldBinormal;\\ntangentSpace[2]=worldNormal;\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\n}\\n\"","export * from \"./waterMaterial\";","import { Effect, MaterialDefines, PushMaterial, serializeAsTexture, BaseTexture, expandToProperty, serializeAsColor3, Color3, serialize, serializeAsVector2, Vector2, SmartArray, RenderTargetTexture, Nullable, AbstractMesh, Matrix, Scene, SubMesh, StandardMaterial, MaterialHelper, EffectFallbacks, VertexBuffer, EffectCreationOptions, Mesh, Plane, Vector3, Camera, IAnimatable, SerializationHelper } from \"babylonjs\";\n\nEffect.ShadersStore[\"waterPixelShader\"] = require(\"./water.fragment.fx\");\nEffect.ShadersStore[\"waterVertexShader\"] = require(\"./water.vertex.fx\");\n\nclass WaterMaterialDefines extends MaterialDefines {\n    public BUMP = false;\n    public REFLECTION = false;\n    public CLIPPLANE = false;\n    public CLIPPLANE2 = false;\n    public CLIPPLANE3 = false;\n    public CLIPPLANE4 = false;\n    public ALPHATEST = false;\n    public DEPTHPREPASS = false;\n    public POINTSIZE = false;\n    public FOG = false;\n    public NORMAL = false;\n    public UV1 = false;\n    public UV2 = false;\n    public VERTEXCOLOR = false;\n    public VERTEXALPHA = false;\n    public NUM_BONE_INFLUENCERS = 0;\n    public BonesPerMesh = 0;\n    public INSTANCES = false;\n    public SPECULARTERM = false;\n    public LOGARITHMICDEPTH = false;\n    public FRESNELSEPARATE = false;\n    public BUMPSUPERIMPOSE = false;\n    public BUMPAFFECTSREFLECTION = false;\n\n    constructor() {\n        super();\n        this.rebuild();\n    }\n}\n\nexport class WaterMaterial extends PushMaterial {\n    /*\n    * Public members\n    */\n    @serializeAsTexture(\"bumpTexture\")\n    private _bumpTexture: BaseTexture;\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\n    public bumpTexture: BaseTexture;\n\n    @serializeAsColor3()\n    public diffuseColor = new Color3(1, 1, 1);\n\n    @serializeAsColor3()\n    public specularColor = new Color3(0, 0, 0);\n\n    @serialize()\n    public specularPower = 64;\n\n    @serialize(\"disableLighting\")\n    private _disableLighting = false;\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\n    public disableLighting: boolean;\n\n    @serialize(\"maxSimultaneousLights\")\n    private _maxSimultaneousLights = 4;\n    @expandToProperty(\"_markAllSubMeshesAsLightsDirty\")\n    public maxSimultaneousLights: number;\n\n    /**\n    * @param {number}: Represents the wind force\n    */\n    @serialize()\n    public windForce: number = 6;\n    /**\n    * @param {Vector2}: The direction of the wind in the plane (X, Z)\n    */\n    @serializeAsVector2()\n    public windDirection: Vector2 = new Vector2(0, 1);\n    /**\n    * @param {number}: Wave height, represents the height of the waves\n    */\n    @serialize()\n    public waveHeight: number = 0.4;\n    /**\n    * @param {number}: Bump height, represents the bump height related to the bump map\n    */\n    @serialize()\n    public bumpHeight: number = 0.4;\n    /**\n     * @param {boolean}: Add a smaller moving bump to less steady waves.\n     */\n    @serialize(\"bumpSuperimpose\")\n    private _bumpSuperimpose = false;\n    @expandToProperty(\"_markAllSubMeshesAsMiscDirty\")\n    public bumpSuperimpose: boolean;\n\n    /**\n     * @param {boolean}: Color refraction and reflection differently with .waterColor2 and .colorBlendFactor2. Non-linear (physically correct) fresnel.\n     */\n    @serialize(\"fresnelSeparate\")\n    private _fresnelSeparate = false;\n    @expandToProperty(\"_markAllSubMeshesAsMiscDirty\")\n    public fresnelSeparate: boolean;\n\n    /**\n     * @param {boolean}: bump Waves modify the reflection.\n     */\n    @serialize(\"bumpAffectsReflection\")\n    private _bumpAffectsReflection = false;\n    @expandToProperty(\"_markAllSubMeshesAsMiscDirty\")\n    public bumpAffectsReflection: boolean;\n\n    /**\n    * @param {number}: The water color blended with the refraction (near)\n    */\n    @serializeAsColor3()\n    public waterColor: Color3 = new Color3(0.1, 0.1, 0.6);\n    /**\n    * @param {number}: The blend factor related to the water color\n    */\n    @serialize()\n    public colorBlendFactor: number = 0.2;\n    /**\n     * @param {number}: The water color blended with the reflection (far)\n     */\n    @serializeAsColor3()\n    public waterColor2: Color3 = new Color3(0.1, 0.1, 0.6);\n    /**\n     * @param {number}: The blend factor related to the water color (reflection, far)\n     */\n    @serialize()\n    public colorBlendFactor2: number = 0.2;\n    /**\n    * @param {number}: Represents the maximum length of a wave\n    */\n    @serialize()\n    public waveLength: number = 0.1;\n\n    /**\n    * @param {number}: Defines the waves speed\n    */\n    @serialize()\n    public waveSpeed: number = 1.0;\n\n    protected _renderTargets = new SmartArray<RenderTargetTexture>(16);\n\n    /*\n    * Private members\n    */\n    private _mesh: Nullable<AbstractMesh> = null;\n\n    private _refractionRTT: Nullable<RenderTargetTexture>;\n    private _reflectionRTT: Nullable<RenderTargetTexture>;\n\n    private _reflectionTransform: Matrix = Matrix.Zero();\n    private _lastTime: number = 0;\n    private _lastDeltaTime: number = 0;\n\n    private _renderId: number;\n\n    private _useLogarithmicDepth: boolean;\n\n    private _waitingRenderList: Nullable<string[]>;\n\n    /**\n     * Gets a boolean indicating that current material needs to register RTT\n     */\n    public get hasRenderTargetTextures(): boolean {\n        return true;\n        }\n\n    /**\n    * Constructor\n    */\n    constructor(name: string, scene: Scene, public renderTargetSize: Vector2 = new Vector2(512, 512)) {\n        super(name, scene);\n\n        this._createRenderTargets(scene, renderTargetSize);\n\n        // Create render targets\n        this.getRenderTargetTextures = (): SmartArray<RenderTargetTexture> => {\n            this._renderTargets.reset();\n            this._renderTargets.push(<RenderTargetTexture>this._reflectionRTT);\n            this._renderTargets.push(<RenderTargetTexture>this._refractionRTT);\n\n            return this._renderTargets;\n        };\n    }\n\n    @serialize()\n    public get useLogarithmicDepth(): boolean {\n        return this._useLogarithmicDepth;\n    }\n\n    public set useLogarithmicDepth(value: boolean) {\n        this._useLogarithmicDepth = value && this.getScene().getEngine().getCaps().fragmentDepthSupported;\n        this._markAllSubMeshesAsMiscDirty();\n    }\n\n    // Get / Set\n    public get refractionTexture(): Nullable<RenderTargetTexture> {\n        return this._refractionRTT;\n    }\n\n    public get reflectionTexture(): Nullable<RenderTargetTexture> {\n        return this._reflectionRTT;\n    }\n\n    // Methods\n    public addToRenderList(node: any): void {\n        if (this._refractionRTT && this._refractionRTT.renderList) {\n            this._refractionRTT.renderList.push(node);\n        }\n\n        if (this._reflectionRTT && this._reflectionRTT.renderList) {\n            this._reflectionRTT.renderList.push(node);\n        }\n    }\n\n    public enableRenderTargets(enable: boolean): void {\n        var refreshRate = enable ? 1 : 0;\n\n        if (this._refractionRTT) {\n            this._refractionRTT.refreshRate = refreshRate;\n        }\n\n        if (this._reflectionRTT) {\n            this._reflectionRTT.refreshRate = refreshRate;\n        }\n    }\n\n    public getRenderList(): Nullable<AbstractMesh[]> {\n        return this._refractionRTT ? this._refractionRTT.renderList : [];\n    }\n\n    public get renderTargetsEnabled(): boolean {\n        return !(this._refractionRTT && this._refractionRTT.refreshRate === 0);\n    }\n\n    public needAlphaBlending(): boolean {\n        return (this.alpha < 1.0);\n    }\n\n    public needAlphaTesting(): boolean {\n        return false;\n    }\n\n    public getAlphaTestTexture(): Nullable<BaseTexture> {\n        return null;\n    }\n\n    public isReadyForSubMesh(mesh: AbstractMesh, subMesh: SubMesh, useInstances?: boolean): boolean {\n        if (this.isFrozen) {\n            if (this._wasPreviouslyReady && subMesh.effect) {\n                return true;\n            }\n        }\n\n        if (!subMesh._materialDefines) {\n            subMesh._materialDefines = new WaterMaterialDefines();\n        }\n\n        var defines = <WaterMaterialDefines>subMesh._materialDefines;\n        var scene = this.getScene();\n\n        if (!this.checkReadyOnEveryCall && subMesh.effect) {\n            if (this._renderId === scene.getRenderId()) {\n                return true;\n            }\n        }\n\n        var engine = scene.getEngine();\n\n        // Textures\n        if (defines._areTexturesDirty) {\n            defines._needUVs = false;\n            if (scene.texturesEnabled) {\n                if (this.bumpTexture && StandardMaterial.BumpTextureEnabled) {\n                    if (!this.bumpTexture.isReady()) {\n                        return false;\n                    } else {\n                        defines._needUVs = true;\n                        defines.BUMP = true;\n                    }\n                }\n\n                if (StandardMaterial.ReflectionTextureEnabled) {\n                    defines.REFLECTION = true;\n                }\n            }\n        }\n\n        MaterialHelper.PrepareDefinesForFrameBoundValues(scene, engine, defines, useInstances ? true : false);\n\n        MaterialHelper.PrepareDefinesForMisc(mesh, scene, this._useLogarithmicDepth, this.pointsCloud, this.fogEnabled, this._shouldTurnAlphaTestOn(mesh), defines);\n\n        if (defines._areMiscDirty) {\n            if (this._fresnelSeparate) {\n                defines.FRESNELSEPARATE = true;\n            }\n\n            if (this._bumpSuperimpose) {\n                defines.BUMPSUPERIMPOSE = true;\n            }\n\n            if (this._bumpAffectsReflection) {\n                defines.BUMPAFFECTSREFLECTION = true;\n            }\n        }\n\n        // Lights\n        defines._needNormals = MaterialHelper.PrepareDefinesForLights(scene, mesh, defines, true, this._maxSimultaneousLights, this._disableLighting);\n\n        // Attribs\n        MaterialHelper.PrepareDefinesForAttributes(mesh, defines, true, true);\n\n        // Configure this\n        this._mesh = mesh;\n\n        if (this._waitingRenderList) {\n            for (var i = 0; i < this._waitingRenderList.length; i++) {\n                this.addToRenderList(scene.getNodeByID(this._waitingRenderList[i]));\n            }\n\n            this._waitingRenderList = null;\n        }\n\n        // Get correct effect\n        if (defines.isDirty) {\n            defines.markAsProcessed();\n            scene.resetCachedMaterial();\n\n            // Fallbacks\n            var fallbacks = new EffectFallbacks();\n            if (defines.FOG) {\n                fallbacks.addFallback(1, \"FOG\");\n            }\n\n            if (defines.LOGARITHMICDEPTH) {\n                fallbacks.addFallback(0, \"LOGARITHMICDEPTH\");\n            }\n\n            MaterialHelper.HandleFallbacksForShadows(defines, fallbacks, this.maxSimultaneousLights);\n\n            if (defines.NUM_BONE_INFLUENCERS > 0) {\n                fallbacks.addCPUSkinningFallback(0, mesh);\n            }\n\n            //Attributes\n            var attribs = [VertexBuffer.PositionKind];\n\n            if (defines.NORMAL) {\n                attribs.push(VertexBuffer.NormalKind);\n            }\n\n            if (defines.UV1) {\n                attribs.push(VertexBuffer.UVKind);\n            }\n\n            if (defines.UV2) {\n                attribs.push(VertexBuffer.UV2Kind);\n            }\n\n            if (defines.VERTEXCOLOR) {\n                attribs.push(VertexBuffer.ColorKind);\n            }\n\n            MaterialHelper.PrepareAttributesForBones(attribs, mesh, defines, fallbacks);\n            MaterialHelper.PrepareAttributesForInstances(attribs, defines);\n\n            // Legacy browser patch\n            var shaderName = \"water\";\n            var join = defines.toString();\n            var uniforms = [\"world\", \"view\", \"viewProjection\", \"vEyePosition\", \"vLightsType\", \"vDiffuseColor\", \"vSpecularColor\",\n                \"vFogInfos\", \"vFogColor\", \"pointSize\",\n                \"vNormalInfos\",\n                \"mBones\",\n                \"vClipPlane\", \"vClipPlane2\", \"vClipPlane3\", \"vClipPlane4\", \"normalMatrix\",\n                \"logarithmicDepthConstant\",\n\n                // Water\n                \"worldReflectionViewProjection\", \"windDirection\", \"waveLength\", \"time\", \"windForce\",\n                \"cameraPosition\", \"bumpHeight\", \"waveHeight\", \"waterColor\", \"waterColor2\", \"colorBlendFactor\", \"colorBlendFactor2\", \"waveSpeed\"\n            ];\n            var samplers = [\"normalSampler\",\n                // Water\n                \"refractionSampler\", \"reflectionSampler\"\n            ];\n            var uniformBuffers = new Array<string>();\n\n            MaterialHelper.PrepareUniformsAndSamplersList(<EffectCreationOptions>{\n                uniformsNames: uniforms,\n                uniformBuffersNames: uniformBuffers,\n                samplers: samplers,\n                defines: defines,\n                maxSimultaneousLights: this.maxSimultaneousLights\n            });\n            subMesh.setEffect(scene.getEngine().createEffect(shaderName,\n                <EffectCreationOptions>{\n                    attributes: attribs,\n                    uniformsNames: uniforms,\n                    uniformBuffersNames: uniformBuffers,\n                    samplers: samplers,\n                    defines: join,\n                    fallbacks: fallbacks,\n                    onCompiled: this.onCompiled,\n                    onError: this.onError,\n                    indexParameters: { maxSimultaneousLights: this._maxSimultaneousLights }\n                }, engine), defines);\n\n        }\n        if (!subMesh.effect || !subMesh.effect.isReady()) {\n            return false;\n        }\n\n        this._renderId = scene.getRenderId();\n        this._wasPreviouslyReady = true;\n\n        return true;\n    }\n\n    public bindForSubMesh(world: Matrix, mesh: Mesh, subMesh: SubMesh): void {\n        var scene = this.getScene();\n\n        var defines = <WaterMaterialDefines>subMesh._materialDefines;\n        if (!defines) {\n            return;\n        }\n\n        var effect = subMesh.effect;\n        if (!effect || !this._mesh) {\n            return;\n        }\n        this._activeEffect = effect;\n\n        // Matrices\n        this.bindOnlyWorldMatrix(world);\n        this._activeEffect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\n\n        // Bones\n        MaterialHelper.BindBonesParameters(mesh, this._activeEffect);\n\n        if (this._mustRebind(scene, effect)) {\n            // Textures\n            if (this.bumpTexture && StandardMaterial.BumpTextureEnabled) {\n                this._activeEffect.setTexture(\"normalSampler\", this.bumpTexture);\n\n                this._activeEffect.setFloat2(\"vNormalInfos\", this.bumpTexture.coordinatesIndex, this.bumpTexture.level);\n                this._activeEffect.setMatrix(\"normalMatrix\", this.bumpTexture.getTextureMatrix());\n            }\n            // Clip plane\n            MaterialHelper.BindClipPlane(this._activeEffect, scene);\n\n            // Point size\n            if (this.pointsCloud) {\n                this._activeEffect.setFloat(\"pointSize\", this.pointSize);\n            }\n\n            MaterialHelper.BindEyePosition(effect, scene);\n        }\n\n        this._activeEffect.setColor4(\"vDiffuseColor\", this.diffuseColor, this.alpha * mesh.visibility);\n\n        if (defines.SPECULARTERM) {\n            this._activeEffect.setColor4(\"vSpecularColor\", this.specularColor, this.specularPower);\n        }\n\n        if (scene.lightsEnabled && !this.disableLighting) {\n            MaterialHelper.BindLights(scene, mesh, this._activeEffect, defines, this.maxSimultaneousLights);\n        }\n\n        // View\n        if (scene.fogEnabled && mesh.applyFog && scene.fogMode !== Scene.FOGMODE_NONE) {\n            this._activeEffect.setMatrix(\"view\", scene.getViewMatrix());\n        }\n\n        // Fog\n        MaterialHelper.BindFogParameters(scene, mesh, this._activeEffect);\n\n        // Log. depth\n        MaterialHelper.BindLogDepth(defines, this._activeEffect, scene);\n\n        // Water\n        if (StandardMaterial.ReflectionTextureEnabled) {\n            this._activeEffect.setTexture(\"refractionSampler\", this._refractionRTT);\n            this._activeEffect.setTexture(\"reflectionSampler\", this._reflectionRTT);\n        }\n\n        var wrvp = this._mesh.getWorldMatrix().multiply(this._reflectionTransform).multiply(scene.getProjectionMatrix());\n\n        // Add delta time. Prevent adding delta time if it hasn't changed.\n        let deltaTime = scene.getEngine().getDeltaTime();\n        if (deltaTime !== this._lastDeltaTime) {\n            this._lastDeltaTime = deltaTime;\n            this._lastTime += this._lastDeltaTime;\n        }\n\n        this._activeEffect.setMatrix(\"worldReflectionViewProjection\", wrvp);\n        this._activeEffect.setVector2(\"windDirection\", this.windDirection);\n        this._activeEffect.setFloat(\"waveLength\", this.waveLength);\n        this._activeEffect.setFloat(\"time\", this._lastTime / 100000);\n        this._activeEffect.setFloat(\"windForce\", this.windForce);\n        this._activeEffect.setFloat(\"waveHeight\", this.waveHeight);\n        this._activeEffect.setFloat(\"bumpHeight\", this.bumpHeight);\n        this._activeEffect.setColor4(\"waterColor\", this.waterColor, 1.0);\n        this._activeEffect.setFloat(\"colorBlendFactor\", this.colorBlendFactor);\n        this._activeEffect.setColor4(\"waterColor2\", this.waterColor2, 1.0);\n        this._activeEffect.setFloat(\"colorBlendFactor2\", this.colorBlendFactor2);\n        this._activeEffect.setFloat(\"waveSpeed\", this.waveSpeed);\n\n        this._afterBind(mesh, this._activeEffect);\n    }\n\n    private _createRenderTargets(scene: Scene, renderTargetSize: Vector2): void {\n        // Render targets\n        this._refractionRTT = new RenderTargetTexture(name + \"_refraction\", { width: renderTargetSize.x, height: renderTargetSize.y }, scene, false, true);\n        this._refractionRTT.wrapU = BABYLON.Texture.MIRROR_ADDRESSMODE;\n        this._refractionRTT.wrapV = BABYLON.Texture.MIRROR_ADDRESSMODE;\n        this._refractionRTT.ignoreCameraViewport = true;\n\n        this._reflectionRTT = new RenderTargetTexture(name + \"_reflection\", { width: renderTargetSize.x, height: renderTargetSize.y }, scene, false, true);\n        this._reflectionRTT.wrapU = BABYLON.Texture.MIRROR_ADDRESSMODE;\n        this._reflectionRTT.wrapV = BABYLON.Texture.MIRROR_ADDRESSMODE;\n        this._reflectionRTT.ignoreCameraViewport = true;\n\n        var isVisible: boolean;\n        var clipPlane: Nullable<Plane> = null;\n        var savedViewMatrix: Matrix;\n        var mirrorMatrix = Matrix.Zero();\n\n        this._refractionRTT.onBeforeRender = () => {\n            if (this._mesh) {\n                isVisible = this._mesh.isVisible;\n                this._mesh.isVisible = false;\n            }\n            // Clip plane\n            clipPlane = scene.clipPlane;\n\n            var positiony = this._mesh ? this._mesh.position.y : 0.0;\n            scene.clipPlane = Plane.FromPositionAndNormal(new Vector3(0, positiony + 0.05, 0), new Vector3(0, 1, 0));\n        };\n\n        this._refractionRTT.onAfterRender = () => {\n            if (this._mesh) {\n                this._mesh.isVisible = isVisible;\n            }\n\n            // Clip plane\n            scene.clipPlane = clipPlane;\n        };\n\n        this._reflectionRTT.onBeforeRender = () => {\n            if (this._mesh) {\n                isVisible = this._mesh.isVisible;\n                this._mesh.isVisible = false;\n            }\n\n            // Clip plane\n            clipPlane = scene.clipPlane;\n\n            var positiony = this._mesh ? this._mesh.position.y : 0.0;\n            scene.clipPlane = Plane.FromPositionAndNormal(new Vector3(0, positiony - 0.05, 0), new Vector3(0, -1, 0));\n\n            // Transform\n            Matrix.ReflectionToRef(scene.clipPlane, mirrorMatrix);\n            savedViewMatrix = scene.getViewMatrix();\n\n            mirrorMatrix.multiplyToRef(savedViewMatrix, this._reflectionTransform);\n            scene.setTransformMatrix(this._reflectionTransform, scene.getProjectionMatrix());\n            scene.getEngine().cullBackFaces = false;\n            scene._mirroredCameraPosition = Vector3.TransformCoordinates((<Camera>scene.activeCamera).position, mirrorMatrix);\n        };\n\n        this._reflectionRTT.onAfterRender = () => {\n            if (this._mesh) {\n                this._mesh.isVisible = isVisible;\n            }\n\n            // Clip plane\n            scene.clipPlane = clipPlane;\n\n            // Transform\n            scene.setTransformMatrix(savedViewMatrix, scene.getProjectionMatrix());\n            scene.getEngine().cullBackFaces = true;\n            scene._mirroredCameraPosition = null;\n        };\n    }\n\n    public getAnimatables(): IAnimatable[] {\n        var results = [];\n\n        if (this.bumpTexture && this.bumpTexture.animations && this.bumpTexture.animations.length > 0) {\n            results.push(this.bumpTexture);\n        }\n        if (this._reflectionRTT && this._reflectionRTT.animations && this._reflectionRTT.animations.length > 0) {\n            results.push(this._reflectionRTT);\n        }\n        if (this._refractionRTT && this._refractionRTT.animations && this._refractionRTT.animations.length > 0) {\n            results.push(this._refractionRTT);\n        }\n\n        return results;\n    }\n\n    public getActiveTextures(): BaseTexture[] {\n        var activeTextures = super.getActiveTextures();\n\n        if (this._bumpTexture) {\n            activeTextures.push(this._bumpTexture);\n        }\n\n        return activeTextures;\n    }\n\n    public hasTexture(texture: BaseTexture): boolean {\n        if (super.hasTexture(texture)) {\n            return true;\n        }\n\n        if (this._bumpTexture === texture) {\n            return true;\n        }\n\n        return false;\n    }\n\n    public dispose(forceDisposeEffect?: boolean): void {\n        if (this.bumpTexture) {\n            this.bumpTexture.dispose();\n        }\n\n        var index = this.getScene().customRenderTargets.indexOf(<RenderTargetTexture>this._refractionRTT);\n        if (index != -1) {\n            this.getScene().customRenderTargets.splice(index, 1);\n        }\n        index = -1;\n        index = this.getScene().customRenderTargets.indexOf(<RenderTargetTexture>this._reflectionRTT);\n        if (index != -1) {\n            this.getScene().customRenderTargets.splice(index, 1);\n        }\n\n        if (this._reflectionRTT) {\n            this._reflectionRTT.dispose();\n        }\n        if (this._refractionRTT) {\n            this._refractionRTT.dispose();\n        }\n\n        super.dispose(forceDisposeEffect);\n    }\n\n    public clone(name: string): WaterMaterial {\n        return SerializationHelper.Clone(() => new WaterMaterial(name, this.getScene()), this);\n    }\n\n    public serialize(): any {\n        var serializationObject = SerializationHelper.Serialize(this);\n        serializationObject.customType = \"BABYLON.WaterMaterial\";\n\n        serializationObject.renderList = [];\n        if (this._refractionRTT && this._refractionRTT.renderList) {\n            for (var i = 0; i < this._refractionRTT.renderList.length; i++) {\n                serializationObject.renderList.push(this._refractionRTT.renderList[i].id);\n            }\n        }\n\n        return serializationObject;\n    }\n\n    public getClassName(): string {\n        return \"WaterMaterial\";\n    }\n\n    // Statics\n    public static Parse(source: any, scene: Scene, rootUrl: string): WaterMaterial {\n        var mat = SerializationHelper.Parse(() => new WaterMaterial(source.name, scene), source, scene, rootUrl);\n        mat._waitingRenderList = source.renderList;\n\n        return mat;\n    }\n\n    public static CreateDefaultMesh(name: string, scene: Scene): Mesh {\n        var mesh = Mesh.CreateGround(name, 512, 512, 32, scene, false);\n        return mesh;\n    }\n}","module.exports = \"#ifdef LOGARITHMICDEPTH\\n#extension GL_EXT_frag_depth : enable\\n#endif\\nprecision highp float;\\n\\nuniform vec3 vEyePosition;\\nuniform vec4 vDiffuseColor;\\n#ifdef SPECULARTERM\\nuniform vec4 vSpecularColor;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n\\n#include<helperFunctions>\\n\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n#include<lightsFragmentFunctions>\\n#include<shadowsFragmentFunctions>\\n\\n#ifdef BUMP\\nvarying vec2 vNormalUV;\\nvarying vec2 vNormalUV2;\\nuniform sampler2D normalSampler;\\nuniform vec2 vNormalInfos;\\n#endif\\nuniform sampler2D refractionSampler;\\nuniform sampler2D reflectionSampler;\\n\\nconst float LOG2=1.442695;\\nuniform vec3 cameraPosition;\\nuniform vec4 waterColor;\\nuniform float colorBlendFactor;\\nuniform vec4 waterColor2;\\nuniform float colorBlendFactor2;\\nuniform float bumpHeight;\\nuniform float time;\\n\\nvarying vec3 vRefractionMapTexCoord;\\nvarying vec3 vReflectionMapTexCoord;\\nvarying vec3 vPosition;\\n#include<clipPlaneFragmentDeclaration>\\n#include<logDepthDeclaration>\\n\\n#include<fogFragmentDeclaration>\\nvoid main(void) {\\n\\n#include<clipPlaneFragment>\\nvec3 viewDirectionW=normalize(vEyePosition-vPositionW);\\n\\nvec4 baseColor=vec4(1.,1.,1.,1.);\\nvec3 diffuseColor=vDiffuseColor.rgb;\\n\\nfloat alpha=vDiffuseColor.a;\\n#ifdef BUMP\\n#ifdef BUMPSUPERIMPOSE\\nbaseColor=0.6*texture2D(normalSampler,vNormalUV)+0.4*texture2D(normalSampler,vec2(vNormalUV2.x,vNormalUV2.y));\\n#else\\nbaseColor=texture2D(normalSampler,vNormalUV);\\n#endif\\nvec3 bumpColor=baseColor.rgb;\\n#ifdef ALPHATEST\\nif (baseColor.a<0.4)\\ndiscard;\\n#endif\\nbaseColor.rgb*=vNormalInfos.y;\\n#else\\nvec3 bumpColor=vec3(1.0);\\n#endif\\n#ifdef VERTEXCOLOR\\nbaseColor.rgb*=vColor.rgb;\\n#endif\\n\\n#ifdef NORMAL\\nvec2 perturbation=bumpHeight*(baseColor.rg-0.5);\\n#ifdef BUMPAFFECTSREFLECTION\\nvec3 normalW=normalize(vNormalW+vec3(perturbation.x*8.0,0.0,perturbation.y*8.0));\\nif (normalW.y<0.0) {\\nnormalW.y=-normalW.y;\\n}\\n#else\\nvec3 normalW=normalize(vNormalW);\\n#endif\\n#else\\nvec3 normalW=vec3(1.0,1.0,1.0);\\nvec2 perturbation=bumpHeight*(vec2(1.0,1.0)-0.5);\\n#endif\\n#ifdef FRESNELSEPARATE\\n#ifdef REFLECTION\\n\\nvec3 eyeVector=normalize(vEyePosition-vPosition);\\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation*0.5,0.0,1.0);\\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\\nvec2 projectedReflectionTexCoords=clamp(vec2(\\nvReflectionMapTexCoord.x/vReflectionMapTexCoord.z+perturbation.x*0.3,\\nvReflectionMapTexCoord.y/vReflectionMapTexCoord.z+perturbation.y\\n),0.0,1.0);\\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\\nvec3 upVector=vec3(0.0,1.0,0.0);\\nfloat fresnelTerm=clamp(abs(pow(dot(eyeVector,upVector),3.0)),0.05,0.65);\\nfloat IfresnelTerm=1.0-fresnelTerm;\\nrefractiveColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*refractiveColor;\\nreflectiveColor=IfresnelTerm*colorBlendFactor2*waterColor+(1.0-colorBlendFactor2*IfresnelTerm)*reflectiveColor;\\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*IfresnelTerm;\\nbaseColor=combinedColor;\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\n#ifdef SPECULARTERM\\nfloat glossiness=vSpecularColor.a;\\nvec3 specularBase=vec3(0.,0.,0.);\\nvec3 specularColor=vSpecularColor.rgb;\\n#else\\nfloat glossiness=0.;\\n#endif\\n#include<lightFragment>[0..maxSimultaneousLights]\\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\n#ifdef SPECULARTERM\\nvec3 finalSpecular=specularBase*specularColor;\\n#else\\nvec3 finalSpecular=vec3(0.0);\\n#endif\\n#else \\n#ifdef REFLECTION\\n\\nvec3 eyeVector=normalize(vEyePosition-vPosition);\\nvec2 projectedRefractionTexCoords=clamp(vRefractionMapTexCoord.xy/vRefractionMapTexCoord.z+perturbation,0.0,1.0);\\nvec4 refractiveColor=texture2D(refractionSampler,projectedRefractionTexCoords);\\nvec2 projectedReflectionTexCoords=clamp(vReflectionMapTexCoord.xy/vReflectionMapTexCoord.z+perturbation,0.0,1.0);\\nvec4 reflectiveColor=texture2D(reflectionSampler,projectedReflectionTexCoords);\\nvec3 upVector=vec3(0.0,1.0,0.0);\\nfloat fresnelTerm=max(dot(eyeVector,upVector),0.0);\\nvec4 combinedColor=refractiveColor*fresnelTerm+reflectiveColor*(1.0-fresnelTerm);\\nbaseColor=colorBlendFactor*waterColor+(1.0-colorBlendFactor)*combinedColor;\\n#endif\\n\\nvec3 diffuseBase=vec3(0.,0.,0.);\\nlightingInfo info;\\nfloat shadow=1.;\\n#ifdef SPECULARTERM\\nfloat glossiness=vSpecularColor.a;\\nvec3 specularBase=vec3(0.,0.,0.);\\nvec3 specularColor=vSpecularColor.rgb;\\n#else\\nfloat glossiness=0.;\\n#endif\\n#include<lightFragment>[0..maxSimultaneousLights]\\nvec3 finalDiffuse=clamp(baseColor.rgb,0.0,1.0);\\n#ifdef VERTEXALPHA\\nalpha*=vColor.a;\\n#endif\\n#ifdef SPECULARTERM\\nvec3 finalSpecular=specularBase*specularColor;\\n#else\\nvec3 finalSpecular=vec3(0.0);\\n#endif\\n#endif\\n\\nvec4 color=vec4(finalDiffuse+finalSpecular,alpha);\\n#include<logDepthFragment>\\n#include<fogFragment>\\ngl_FragColor=color;\\n}\\n\"","module.exports = \"precision highp float;\\n\\nattribute vec3 position;\\n#ifdef NORMAL\\nattribute vec3 normal;\\n#endif\\n#ifdef UV1\\nattribute vec2 uv;\\n#endif\\n#ifdef UV2\\nattribute vec2 uv2;\\n#endif\\n#ifdef VERTEXCOLOR\\nattribute vec4 color;\\n#endif\\n#include<bonesDeclaration>\\n\\n#include<instancesDeclaration>\\nuniform mat4 view;\\nuniform mat4 viewProjection;\\n#ifdef BUMP\\nvarying vec2 vNormalUV;\\n#ifdef BUMPSUPERIMPOSE\\nvarying vec2 vNormalUV2;\\n#endif\\nuniform mat4 normalMatrix;\\nuniform vec2 vNormalInfos;\\n#endif\\n#ifdef POINTSIZE\\nuniform float pointSize;\\n#endif\\n\\nvarying vec3 vPositionW;\\n#ifdef NORMAL\\nvarying vec3 vNormalW;\\n#endif\\n#ifdef VERTEXCOLOR\\nvarying vec4 vColor;\\n#endif\\n#include<clipPlaneVertexDeclaration>\\n#include<fogVertexDeclaration>\\n#include<__decl__lightFragment>[0..maxSimultaneousLights]\\n#include<logDepthDeclaration>\\n\\nuniform mat4 worldReflectionViewProjection;\\nuniform vec2 windDirection;\\nuniform float waveLength;\\nuniform float time;\\nuniform float windForce;\\nuniform float waveHeight;\\nuniform float waveSpeed;\\n\\nvarying vec3 vPosition;\\nvarying vec3 vRefractionMapTexCoord;\\nvarying vec3 vReflectionMapTexCoord;\\nvoid main(void) {\\n#include<instancesVertex>\\n#include<bonesVertex>\\nvec4 worldPos=finalWorld*vec4(position,1.0);\\nvPositionW=vec3(worldPos);\\n#ifdef NORMAL\\nvNormalW=normalize(vec3(finalWorld*vec4(normal,0.0)));\\n#endif\\n\\n#ifndef UV1\\nvec2 uv=vec2(0.,0.);\\n#endif\\n#ifndef UV2\\nvec2 uv2=vec2(0.,0.);\\n#endif\\n#ifdef BUMP\\nif (vNormalInfos.x == 0.)\\n{\\nvNormalUV=vec2(normalMatrix*vec4((uv*1.0)/waveLength+time*windForce*windDirection,1.0,0.0));\\n#ifdef BUMPSUPERIMPOSE\\nvNormalUV2=vec2(normalMatrix*vec4((uv*0.721)/waveLength+time*1.2*windForce*windDirection,1.0,0.0));\\n#endif\\n}\\nelse\\n{\\nvNormalUV=vec2(normalMatrix*vec4((uv2*1.0)/waveLength+time*windForce*windDirection ,1.0,0.0));\\n#ifdef BUMPSUPERIMPOSE\\nvNormalUV2=vec2(normalMatrix*vec4((uv2*0.721)/waveLength+time*1.2*windForce*windDirection ,1.0,0.0));\\n#endif\\n}\\n#endif\\n\\n#include<clipPlaneVertex>\\n\\n#include<fogVertex>\\n\\n#include<shadowsVertex>[0..maxSimultaneousLights]\\n\\n#ifdef VERTEXCOLOR\\nvColor=color;\\n#endif\\n\\n#ifdef POINTSIZE\\ngl_PointSize=pointSize;\\n#endif\\nvec3 p=position;\\nfloat newY=(sin(((p.x/0.05)+time*waveSpeed))*waveHeight*windDirection.x*5.0)\\n+(cos(((p.z/0.05)+time*waveSpeed))*waveHeight*windDirection.y*5.0);\\np.y+=abs(newY);\\ngl_Position=viewProjection*finalWorld*vec4(p,1.0);\\n#ifdef REFLECTION\\nworldPos=viewProjection*finalWorld*vec4(p,1.0);\\n\\nvPosition=position;\\nvRefractionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\\nvRefractionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\\nvRefractionMapTexCoord.z=worldPos.w;\\nworldPos=worldReflectionViewProjection*vec4(position,1.0);\\nvReflectionMapTexCoord.x=0.5*(worldPos.w+worldPos.x);\\nvReflectionMapTexCoord.y=0.5*(worldPos.w+worldPos.y);\\nvReflectionMapTexCoord.z=worldPos.w;\\n#endif\\n#include<logDepthVertex>\\n}\\n\""],"sourceRoot":""}